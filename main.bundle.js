(()=>{"use strict";var t={145:(t,e,n)=>{n.d(e,{Z:()=>o});var i=n(81),s=n.n(i),a=n(645),r=n.n(a)()(s());r.push([t.id,'html,\nbody {\n  margin: 0;\n  padding: 0;\n  font-family: sans-serif;\n  color: white;\n}\nbody {\n  background-color: #2a2a2a;\n}\n#root {\n  position: fixed;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n}\n#mainCanvas {\n  position: absolute;\n  display: block;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n}\n#textLayer {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n}\n#textLayer .text {\n  position: absolute;\n  user-select: none;\n  text-align: center;\n  animation: fade-in 0.5s ease-in;\n  text-shadow: 1px 1px black;\n  white-space: pre;\n}\n#textLayer .text.debug {\n  text-shadow: 1px 0px black;\n  font-size: 11px;\n  text-align: left;\n  color: #dddedf;\n  line-height: 11px;\n}\nbutton {\n  text-transform: uppercase;\n  white-space: nowrap;\n}\nbutton:not(:disabled) {\n  cursor: pointer;\n}\n@keyframes fade-in {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n#dialogLayer {\n  position: absolute;\n  inset: 0;\n  z-index: 100;\n  overflow: hidden;\n  display: none;\n  justify-content: center;\n  align-items: center;\n  background-color: rgba(32, 32, 32, 0.75);\n  animation: dialog-background-in 0.5s;\n}\n#dialogLayer.show {\n  display: flex;\n  backdrop-filter: blur(2px);\n}\n@keyframes dialog-background-in {\n  from {\n    background-color: transparent;\n  }\n  to {\n    background-color: rgba(32, 32, 32, 0.75);\n  }\n}\n.dialog-container {\n  position: relative;\n}\n.dialog-container .dialog-modal {\n  padding: 15px;\n  padding-top: 1.25em;\n  background-color: #404040;\n  color: white;\n  display: flex;\n  flex-direction: column;\n  align-items: stretch;\n  min-width: 550px;\n  max-width: 80vw;\n  min-height: 250px;\n  max-height: 80vh;\n  gap: 1em;\n  transform: scale(1, 1);\n  /* create new stacking context */\n  animation: dialog-modal-fly-in 0.3s;\n  /* modal border */\n}\n.dialog-container .dialog-modal .dialog-title {\n  font-size: 1.25em;\n  font-weight: bold;\n  flex-grow: 0;\n}\n.dialog-container .dialog-modal .dialog-content {\n  flex-grow: 1;\n  white-space: pre-line;\n}\n.dialog-container .dialog-modal .dialog-buttons {\n  flex-grow: 0;\n  display: flex;\n  flex-direction: row;\n  justify-content: end;\n  gap: 10px;\n}\n.dialog-container .dialog-modal .dialog-buttons button {\n  position: relative;\n  min-width: 80px;\n  min-height: 35px;\n  padding: 5px 8px;\n  font-weight: bold;\n  background-color: #8d8e8f;\n  color: white;\n  text-shadow: 1px 1px 0px black;\n  font-size: 1.15em;\n  border-radius: 2px;\n  border: 2px solid #202020;\n  border-bottom-left-radius: 20px 240px;\n  border-bottom-right-radius: 300px 20px;\n  border-top-left-radius: 300px 20px;\n  border-top-right-radius: 20px 220px;\n  transition: 0.25s;\n  transform-origin: center;\n  animation: dialog-button-in 0.4s;\n  animation-delay: 0.3s;\n  animation-fill-mode: backwards;\n}\n.dialog-container .dialog-modal .dialog-buttons button:hover:not(:active) {\n  transform: scale(1.05, 1.05);\n}\n.dialog-container .dialog-modal .dialog-buttons button:last-child {\n  background-color: #0c81ee;\n  border: 2px solid black;\n}\n.dialog-container .dialog-modal .dialog-buttons button:last-child:hover {\n  background-color: #148dff;\n}\n@keyframes dialog-button-in {\n  from {\n    opacity: 0;\n    transform: translateY(10px) scale(0.9, 0.9);\n  }\n  to {\n    opacity: 1;\n    transform: scale(1, 1);\n  }\n}\n.dialog-container .dialog-modal::after {\n  content: " ";\n  position: absolute;\n  inset: 0;\n  border: 2px solid white;\n  border-radius: 2px;\n  transform: scale(1.02, 1) rotate(1deg);\n  animation: dialog-border-in 0.5s;\n  pointer-events: none;\n}\n@keyframes dialog-border-in {\n  0% {\n    transform: scale(1, 0.98) rotate(0deg);\n    opacity: 0;\n  }\n  50% {\n    transform: translateY(-10px) rotate(0deg);\n  }\n  100% {\n    transform: scale(1.02, 1) rotate(1deg);\n    opacity: 1;\n  }\n}\n@keyframes dialog-modal-fly-in {\n  from {\n    transform: scale(0.5, 0.5);\n    opacity: 0;\n  }\n  to {\n    transform: scale(1, 1);\n    opacity: 1;\n  }\n}\n.dialog-container .dialog-shadow {\n  position: absolute;\n  inset: 0;\n  background-color: black;\n  transform: rotate(-3deg) scale(1.05, 1.03);\n  animation: dialog-shadow-in 0.5s;\n}\n@keyframes dialog-shadow-in {\n  0% {\n    transform: scale(0.9, 0.9);\n    opacity: 0;\n  }\n  60% {\n    transform: rotate(-4deg) scale(1.1, 1.06);\n  }\n  100% {\n    transform: rotate(-3deg) scale(1.05, 1.03);\n    opacity: 1;\n  }\n}\n#input-container {\n  position: fixed;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  --ring-radius: 200px;\n  --ring-width: 12px;\n}\n#input-viz-ring {\n  position: relative;\n  width: var(--ring-radius);\n  height: var(--ring-radius);\n  border-radius: 50%;\n  box-shadow: 0px 0px 0px var(--ring-width) rgba(128, 128, 128, 0.2);\n  transition: 0.33s;\n}\n#input-viz-ring.hide {\n  box-shadow: 0px 0px 0px 5px transparent;\n  transition: 0.64s;\n}\n#input-viz-marker {\n  position: absolute;\n  top: calc(0px - var(--ring-width));\n  left: calc(0px - var(--ring-width));\n  width: var(--ring-radius);\n  height: var(--ring-radius);\n  border-radius: 50%;\n  border: var(--ring-width) solid rgba(255, 255, 255, 0.85);\n  clip-path: polygon(50% 50%, 100% 40%, 100% 60%);\n  opacity: 1;\n  transition: opacity 0.5s;\n}\n#input-viz-ring.hide > #input-viz-marker {\n  opacity: 0;\n}\n#snake-info {\n  position: absolute;\n  left: 10px;\n  bottom: 10px;\n  padding: 5px;\n  min-width: 90px;\n  background-color: #404040;\n  color: white;\n  font-size: 14px;\n  animation: snake-info-in 0.3s ease-out;\n}\n#snake-info #snake-data {\n  display: grid;\n  grid-template-columns: max-content max-content;\n  gap: 0px 6px;\n  align-items: baseline;\n}\n#snake-info #snake-data > span {\n  line-height: 14px;\n}\n#snake-info #snake-data .label {\n  font-size: 12px;\n  color: #c8c8c8;\n}\n#snake-info #snake-data .value {\n  font-weight: bold;\n  font-size: 14px;\n  font-family: monospace;\n  text-align: right;\n}\n@keyframes snake-info-in {\n  from {\n    opacity: 0;\n    transform: translateX(-25px);\n  }\n  to {\n    opacity: 1;\n    transform: translateX(0px);\n  }\n}\n#fps-stats {\n  position: absolute;\n  top: 10px;\n  left: 10px;\n}\n#fps-stats #fps-text {\n  position: absolute;\n  bottom: 3px;\n  left: 2px;\n  color: #00c800;\n  font-family: monospace;\n  font-size: 14px;\n}\n#game-stats {\n  position: absolute;\n  right: 10px;\n  top: 10px;\n  padding: 5px;\n  min-width: 100px;\n  background-color: #404040;\n  color: white;\n  font-size: 12px;\n  animation: game-stats-in 0.33s ease-out;\n}\n@keyframes game-stats-in {\n  from {\n    opacity: 0;\n    transform: translateX(30px);\n  }\n  to {\n    opacity: 1;\n    transform: translateX(0px);\n  }\n}\n#leaderboard {\n  display: grid;\n  grid-template-columns: max-content 1fr max-content max-content;\n  grid-auto-rows: min-content;\n  gap: 2px 0;\n  align-items: stretch;\n  border-bottom: 1px solid #808080;\n  margin-bottom: 4px;\n  padding-bottom: 4px;\n  font-family: monospace;\n}\n#leaderboard span {\n  text-align: right;\n  padding: 1px 0.25em;\n}\n#leaderboard.multiple > span.target {\n  background-color: #5a5a5a;\n}\n#leaderboard span:nth-child(4n + 1) {\n  font-size: 0.9em;\n}\n#leaderboard span:nth-child(4n + 2) {\n  text-align: left;\n  font-size: 1em;\n  font-weight: bold;\n}\n#leaderboard span:nth-child(4n + 1),\n#leaderboard span:nth-child(4n + 4) {\n  color: #c8c8c8;\n}\n#player-numbers {\n  display: grid;\n  grid-template-columns: 1fr max-content;\n  font-size: 0.9em;\n}\n#player-numbers > div:nth-child(even) {\n  text-align: right;\n}\n',""]);const o=r},645:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n="",i=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),i&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),i&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n})).join("")},e.i=function(t,n,i,s,a){"string"==typeof t&&(t=[[null,t,void 0]]);var r={};if(i)for(var o=0;o<this.length;o++){var l=this[o][0];null!=l&&(r[l]=!0)}for(var c=0;c<t.length;c++){var d=[].concat(t[c]);i&&r[d[0]]||(void 0!==a&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=a),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),s&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=s):d[4]="".concat(s)),e.push(d))}},e}},81:t=>{t.exports=function(t){return t[1]}},379:t=>{var e=[];function n(t){for(var n=-1,i=0;i<e.length;i++)if(e[i].identifier===t){n=i;break}return n}function i(t,i){for(var a={},r=[],o=0;o<t.length;o++){var l=t[o],c=i.base?l[0]+i.base:l[0],d=a[c]||0,u="".concat(c," ").concat(d);a[c]=d+1;var h=n(u),f={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==h)e[h].references++,e[h].updater(f);else{var p=s(f,i);i.byIndex=o,e.splice(o,0,{identifier:u,updater:p,references:1})}r.push(u)}return r}function s(t,e){var n=e.domAPI(e);return n.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;n.update(t=e)}else n.remove()}}t.exports=function(t,s){var a=i(t=t||[],s=s||{});return function(t){t=t||[];for(var r=0;r<a.length;r++){var o=n(a[r]);e[o].references--}for(var l=i(t,s),c=0;c<a.length;c++){var d=n(a[c]);0===e[d].references&&(e[d].updater(),e.splice(d,1))}a=l}}},569:t=>{var e={};t.exports=function(t,n){var i=function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}(t);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},216:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},565:(t,e,n)=>{t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},795:t=>{t.exports=function(t){var e=t.insertStyleElement(t);return{update:function(n){!function(t,e,n){var i="";n.supports&&(i+="@supports (".concat(n.supports,") {")),n.media&&(i+="@media ".concat(n.media," {"));var s=void 0!==n.layer;s&&(i+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),i+=n.css,s&&(i+="}"),n.media&&(i+="}"),n.supports&&(i+="}");var a=n.sourceMap;a&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),e.styleTagTransform(i,t,e.options)}(e,t,n)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},589:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}}},e={};function n(i){var s=e[i];if(void 0!==s)return s.exports;var a=e[i]={id:i,exports:{}};return t[i](a,a.exports,n),a.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.nc=void 0,(()=>{var t,e,i,s,a,r={},o=[],l=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function c(t,e){for(var n in e)t[n]=e[n];return t}function d(t){var e=t.parentNode;e&&e.removeChild(t)}function u(e,n,i){var s,a,r,o={};for(r in n)"key"==r?s=n[r]:"ref"==r?a=n[r]:o[r]=n[r];if(arguments.length>2&&(o.children=arguments.length>3?t.call(arguments,2):i),"function"==typeof e&&null!=e.defaultProps)for(r in e.defaultProps)void 0===o[r]&&(o[r]=e.defaultProps[r]);return h(e,o,s,a,null)}function h(t,n,s,a,r){var o={type:t,props:n,key:s,ref:a,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:null==r?++i:r};return null==r&&null!=e.vnode&&e.vnode(o),o}function f(t){return t.children}function p(t,e){this.props=t,this.context=e}function m(t,e){if(null==e)return t.__?m(t.__,t.__.__k.indexOf(t)+1):null;for(var n;e<t.__k.length;e++)if(null!=(n=t.__k[e])&&null!=n.__e)return n.__e;return"function"==typeof t.type?m(t):null}function g(t){var e,n;if(null!=(t=t.__)&&null!=t.__c){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if(null!=(n=t.__k[e])&&null!=n.__e){t.__e=t.__c.base=n.__e;break}return g(t)}}function _(t){(!t.__d&&(t.__d=!0)&&s.push(t)&&!v.__r++||a!==e.debounceRendering)&&((a=e.debounceRendering)||setTimeout)(v)}function v(){for(var t;v.__r=s.length;)t=s.sort((function(t,e){return t.__v.__b-e.__v.__b})),s=[],t.some((function(t){var e,n,i,s,a,r;t.__d&&(a=(s=(e=t).__v).__e,(r=e.__P)&&(n=[],(i=c({},s)).__v=s.__v+1,S(r,s,i,e.__n,void 0!==r.ownerSVGElement,null!=s.__h?[a]:null,n,null==a?m(s):a,s.__h),C(n,s),s.__e!=a&&g(s)))}))}function k(t,e,n,i,s,a,l,c,d,u){var p,g,_,v,k,b,x,E=i&&i.__k||o,T=E.length;for(n.__k=[],p=0;p<e.length;p++)if(null!=(v=n.__k[p]=null==(v=e[p])||"boolean"==typeof v?null:"string"==typeof v||"number"==typeof v||"bigint"==typeof v?h(null,v,null,null,v):Array.isArray(v)?h(f,{children:v},null,null,null):v.__b>0?h(v.type,v.props,v.key,null,v.__v):v)){if(v.__=n,v.__b=n.__b+1,null===(_=E[p])||_&&v.key==_.key&&v.type===_.type)E[p]=void 0;else for(g=0;g<T;g++){if((_=E[g])&&v.key==_.key&&v.type===_.type){E[g]=void 0;break}_=null}S(t,v,_=_||r,s,a,l,c,d,u),k=v.__e,(g=v.ref)&&_.ref!=g&&(x||(x=[]),_.ref&&x.push(_.ref,null,v),x.push(g,v.__c||k,v)),null!=k?(null==b&&(b=k),"function"==typeof v.type&&v.__k===_.__k?v.__d=d=y(v,d,t):d=w(t,v,_,E,k,d),"function"==typeof n.type&&(n.__d=d)):d&&_.__e==d&&d.parentNode!=t&&(d=m(_))}for(n.__e=b,p=T;p--;)null!=E[p]&&("function"==typeof n.type&&null!=E[p].__e&&E[p].__e==n.__d&&(n.__d=m(i,p+1)),R(E[p],E[p]));if(x)for(p=0;p<x.length;p++)P(x[p],x[++p],x[++p])}function y(t,e,n){for(var i,s=t.__k,a=0;s&&a<s.length;a++)(i=s[a])&&(i.__=t,e="function"==typeof i.type?y(i,e,n):w(n,i,i,s,i.__e,e));return e}function w(t,e,n,i,s,a){var r,o,l;if(void 0!==e.__d)r=e.__d,e.__d=void 0;else if(null==n||s!=a||null==s.parentNode)t:if(null==a||a.parentNode!==t)t.appendChild(s),r=null;else{for(o=a,l=0;(o=o.nextSibling)&&l<i.length;l+=2)if(o==s)break t;t.insertBefore(s,a),r=a}return void 0!==r?r:s.nextSibling}function b(t,e,n){"-"===e[0]?t.setProperty(e,n):t[e]=null==n?"":"number"!=typeof n||l.test(e)?n:n+"px"}function x(t,e,n,i,s){var a;t:if("style"===e)if("string"==typeof n)t.style.cssText=n;else{if("string"==typeof i&&(t.style.cssText=i=""),i)for(e in i)n&&e in n||b(t.style,e,"");if(n)for(e in n)i&&n[e]===i[e]||b(t.style,e,n[e])}else if("o"===e[0]&&"n"===e[1])a=e!==(e=e.replace(/Capture$/,"")),e=e.toLowerCase()in t?e.toLowerCase().slice(2):e.slice(2),t.l||(t.l={}),t.l[e+a]=n,n?i||t.addEventListener(e,a?T:E,a):t.removeEventListener(e,a?T:E,a);else if("dangerouslySetInnerHTML"!==e){if(s)e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if("href"!==e&&"list"!==e&&"form"!==e&&"tabIndex"!==e&&"download"!==e&&e in t)try{t[e]=null==n?"":n;break t}catch(t){}"function"==typeof n||(null!=n&&(!1!==n||"a"===e[0]&&"r"===e[1])?t.setAttribute(e,n):t.removeAttribute(e))}}function E(t){this.l[t.type+!1](e.event?e.event(t):t)}function T(t){this.l[t.type+!0](e.event?e.event(t):t)}function S(t,n,i,s,a,r,o,l,d){var u,h,m,g,_,v,y,w,b,x,E,T,S,C=n.type;if(void 0!==n.constructor)return null;null!=i.__h&&(d=i.__h,l=n.__e=i.__e,n.__h=null,r=[l]),(u=e.__b)&&u(n);try{t:if("function"==typeof C){if(w=n.props,b=(u=C.contextType)&&s[u.__c],x=u?b?b.props.value:u.__:s,i.__c?y=(h=n.__c=i.__c).__=h.__E:("prototype"in C&&C.prototype.render?n.__c=h=new C(w,x):(n.__c=h=new p(w,x),h.constructor=C,h.render=L),b&&b.sub(h),h.props=w,h.state||(h.state={}),h.context=x,h.__n=s,m=h.__d=!0,h.__h=[]),null==h.__s&&(h.__s=h.state),null!=C.getDerivedStateFromProps&&(h.__s==h.state&&(h.__s=c({},h.__s)),c(h.__s,C.getDerivedStateFromProps(w,h.__s))),g=h.props,_=h.state,m)null==C.getDerivedStateFromProps&&null!=h.componentWillMount&&h.componentWillMount(),null!=h.componentDidMount&&h.__h.push(h.componentDidMount);else{if(null==C.getDerivedStateFromProps&&w!==g&&null!=h.componentWillReceiveProps&&h.componentWillReceiveProps(w,x),!h.__e&&null!=h.shouldComponentUpdate&&!1===h.shouldComponentUpdate(w,h.__s,x)||n.__v===i.__v){h.props=w,h.state=h.__s,n.__v!==i.__v&&(h.__d=!1),h.__v=n,n.__e=i.__e,n.__k=i.__k,n.__k.forEach((function(t){t&&(t.__=n)})),h.__h.length&&o.push(h);break t}null!=h.componentWillUpdate&&h.componentWillUpdate(w,h.__s,x),null!=h.componentDidUpdate&&h.__h.push((function(){h.componentDidUpdate(g,_,v)}))}if(h.context=x,h.props=w,h.__v=n,h.__P=t,E=e.__r,T=0,"prototype"in C&&C.prototype.render)h.state=h.__s,h.__d=!1,E&&E(n),u=h.render(h.props,h.state,h.context);else do{h.__d=!1,E&&E(n),u=h.render(h.props,h.state,h.context),h.state=h.__s}while(h.__d&&++T<25);h.state=h.__s,null!=h.getChildContext&&(s=c(c({},s),h.getChildContext())),m||null==h.getSnapshotBeforeUpdate||(v=h.getSnapshotBeforeUpdate(g,_)),S=null!=u&&u.type===f&&null==u.key?u.props.children:u,k(t,Array.isArray(S)?S:[S],n,i,s,a,r,o,l,d),h.base=n.__e,n.__h=null,h.__h.length&&o.push(h),y&&(h.__E=h.__=null),h.__e=!1}else null==r&&n.__v===i.__v?(n.__k=i.__k,n.__e=i.__e):n.__e=A(i.__e,n,i,s,a,r,o,d);(u=e.diffed)&&u(n)}catch(t){n.__v=null,(d||null!=r)&&(n.__e=l,n.__h=!!d,r[r.indexOf(l)]=null),e.__e(t,n,i)}}function C(t,n){e.__c&&e.__c(n,t),t.some((function(n){try{t=n.__h,n.__h=[],t.some((function(t){t.call(n)}))}catch(t){e.__e(t,n.__v)}}))}function A(e,n,i,s,a,o,l,c){var u,h,f,p=i.props,g=n.props,_=n.type,v=0;if("svg"===_&&(a=!0),null!=o)for(;v<o.length;v++)if((u=o[v])&&"setAttribute"in u==!!_&&(_?u.localName===_:3===u.nodeType)){e=u,o[v]=null;break}if(null==e){if(null===_)return document.createTextNode(g);e=a?document.createElementNS("http://www.w3.org/2000/svg",_):document.createElement(_,g.is&&g),o=null,c=!1}if(null===_)p===g||c&&e.data===g||(e.data=g);else{if(o=o&&t.call(e.childNodes),h=(p=i.props||r).dangerouslySetInnerHTML,f=g.dangerouslySetInnerHTML,!c){if(null!=o)for(p={},v=0;v<e.attributes.length;v++)p[e.attributes[v].name]=e.attributes[v].value;(f||h)&&(f&&(h&&f.__html==h.__html||f.__html===e.innerHTML)||(e.innerHTML=f&&f.__html||""))}if(function(t,e,n,i,s){var a;for(a in n)"children"===a||"key"===a||a in e||x(t,a,null,n[a],i);for(a in e)s&&"function"!=typeof e[a]||"children"===a||"key"===a||"value"===a||"checked"===a||n[a]===e[a]||x(t,a,e[a],n[a],i)}(e,g,p,a,c),f)n.__k=[];else if(v=n.props.children,k(e,Array.isArray(v)?v:[v],n,i,s,a&&"foreignObject"!==_,o,l,o?o[0]:i.__k&&m(i,0),c),null!=o)for(v=o.length;v--;)null!=o[v]&&d(o[v]);c||("value"in g&&void 0!==(v=g.value)&&(v!==e.value||"progress"===_&&!v||"option"===_&&v!==p.value)&&x(e,"value",v,p.value,!1),"checked"in g&&void 0!==(v=g.checked)&&v!==e.checked&&x(e,"checked",v,p.checked,!1))}return e}function P(t,n,i){try{"function"==typeof t?t(n):t.current=n}catch(t){e.__e(t,i)}}function R(t,n,i){var s,a;if(e.unmount&&e.unmount(t),(s=t.ref)&&(s.current&&s.current!==t.__e||P(s,null,n)),null!=(s=t.__c)){if(s.componentWillUnmount)try{s.componentWillUnmount()}catch(t){e.__e(t,n)}s.base=s.__P=null}if(s=t.__k)for(a=0;a<s.length;a++)s[a]&&R(s[a],n,"function"!=typeof t.type);i||null==t.__e||d(t.__e),t.__e=t.__d=void 0}function L(t,e,n){return this.constructor(t,n)}function U(n,i,s){var a,o,l;e.__&&e.__(n,i),o=(a="function"==typeof s)?null:s&&s.__k||i.__k,l=[],S(i,n=(!a&&s||i).__k=u(f,null,[n]),o||r,r,void 0!==i.ownerSVGElement,!a&&s?[s]:o?null:i.firstChild?t.call(i.childNodes):null,l,!a&&s?s:o?o.__e:i.firstChild,a),C(l,n)}t=o.slice,e={__e:function(t,e,n,i){for(var s,a,r;e=e.__;)if((s=e.__c)&&!s.__)try{if((a=s.constructor)&&null!=a.getDerivedStateFromError&&(s.setState(a.getDerivedStateFromError(t)),r=s.__d),null!=s.componentDidCatch&&(s.componentDidCatch(t,i||{}),r=s.__d),r)return s.__E=s}catch(e){t=e}throw t}},i=0,p.prototype.setState=function(t,e){var n;n=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=c({},this.state),"function"==typeof t&&(t=t(c({},n),this.props)),t&&c(n,t),null!=t&&this.__v&&(e&&this.__h.push(e),_(this))},p.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),_(this))},p.prototype.render=f,s=[],v.__r=0;var I=0;function M(t,n,i,s,a){var r,o,l={};for(o in n)"ref"==o?r=n[o]:l[o]=n[o];var c={type:t,props:l,key:i,ref:r,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:--I,__source:a,__self:s};if("function"==typeof t&&(r=t.defaultProps))for(o in r)void 0===l[o]&&(l[o]=r[o]);return e.vnode&&e.vnode(c),c}const F=Symbol("Comlink.proxy"),D=Symbol("Comlink.endpoint"),O=Symbol("Comlink.releaseProxy"),N=Symbol("Comlink.thrown"),B=t=>"object"==typeof t&&null!==t||"function"==typeof t,H=new Map([["proxy",{canHandle:t=>B(t)&&t[F],serialize(t){const{port1:e,port2:n}=new MessageChannel;return V(t,e),[n,[n]]},deserialize:t=>(t.start(),Y(t))}],["throw",{canHandle:t=>B(t)&&N in t,serialize({value:t}){let e;return e=t instanceof Error?{isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:{isError:!1,value:t},[e,[]]},deserialize(t){if(t.isError)throw Object.assign(new Error(t.value.message),t.value);throw t.value}}]]);function V(t,e=self){e.addEventListener("message",(function n(i){if(!i||!i.data)return;const{id:s,type:a,path:r}=Object.assign({path:[]},i.data),o=(i.data.argumentList||[]).map(q);let l;try{const e=r.slice(0,-1).reduce(((t,e)=>t[e]),t),n=r.reduce(((t,e)=>t[e]),t);switch(a){case"GET":l=n;break;case"SET":e[r.slice(-1)[0]]=q(i.data.value),l=!0;break;case"APPLY":l=n.apply(e,o);break;case"CONSTRUCT":l=$(new n(...o));break;case"ENDPOINT":{const{port1:e,port2:n}=new MessageChannel;V(t,n),l=function(t,e){return G.set(t,e),t}(e,[e])}break;case"RELEASE":l=void 0;break;default:return}}catch(t){l={value:t,[N]:0}}Promise.resolve(l).catch((t=>({value:t,[N]:0}))).then((t=>{const[i,r]=K(t);e.postMessage(Object.assign(Object.assign({},i),{id:s}),r),"RELEASE"===a&&(e.removeEventListener("message",n),X(e))}))})),e.start&&e.start()}function X(t){(function(t){return"MessagePort"===t.constructor.name})(t)&&t.close()}function Y(t,e){return z(t,[],e)}function W(t){if(t)throw new Error("Proxy has been released and is not useable")}function z(t,e=[],n=function(){}){let i=!1;const s=new Proxy(n,{get(n,a){if(W(i),a===O)return()=>Z(t,{type:"RELEASE",path:e.map((t=>t.toString()))}).then((()=>{X(t),i=!0}));if("then"===a){if(0===e.length)return{then:()=>s};const n=Z(t,{type:"GET",path:e.map((t=>t.toString()))}).then(q);return n.then.bind(n)}return z(t,[...e,a])},set(n,s,a){W(i);const[r,o]=K(a);return Z(t,{type:"SET",path:[...e,s].map((t=>t.toString())),value:r},o).then(q)},apply(n,s,a){W(i);const r=e[e.length-1];if(r===D)return Z(t,{type:"ENDPOINT"}).then(q);if("bind"===r)return z(t,e.slice(0,-1));const[o,l]=j(a);return Z(t,{type:"APPLY",path:e.map((t=>t.toString())),argumentList:o},l).then(q)},construct(n,s){W(i);const[a,r]=j(s);return Z(t,{type:"CONSTRUCT",path:e.map((t=>t.toString())),argumentList:a},r).then(q)}});return s}function j(t){const e=t.map(K);return[e.map((t=>t[0])),(n=e.map((t=>t[1])),Array.prototype.concat.apply([],n))];var n}const G=new WeakMap;function $(t){return Object.assign(t,{[F]:!0})}function K(t){for(const[e,n]of H)if(n.canHandle(t)){const[i,s]=n.serialize(t);return[{type:"HANDLER",name:e,value:i},s]}return[{type:"RAW",value:t},G.get(t)||[]]}function q(t){switch(t.type){case"HANDLER":return H.get(t.name).deserialize(t.value);case"RAW":return t.value}}function Z(t,e,n){return new Promise((i=>{const s=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");t.addEventListener("message",(function e(n){n.data&&n.data.id&&n.data.id===s&&(t.removeEventListener("message",e),i(n.data))})),t.start&&t.start(),t.postMessage(Object.assign({id:s},e),n)}))}const J=function(t){return!0};async function Q(t,e={}){const n=e.allowCache??!1,i=e.guard??J,s=await fetch(t,{method:"GET",cache:n?"default":"no-store"});if(!s.ok)return Promise.reject(new Error(`Request failed (${t})`));const a=await s.json();return i(a)?a:Promise.reject(new Error("Invalid data."))}const tt={server:{wss:!1,host:"127.0.0.1",port:8080}},et=Q("client-config.json",{guard:function(t){if(!t||!t.server)return!1;const e=t.server;return void 0!==e.wss&&e.host&&e.port}}).catch((t=>(console.warn("Loading client config failed: "+t),tt))),nt=new Intl.NumberFormat("en-US",{maximumSignificantDigits:2});class it{x;y;constructor(t,e){this.x=t,this.y=e}static fromObject(t){return new it(t.x,t.y)}static distance(t,e){const n=t.x-e.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)}static lerp(t,e,n){const i=1-n;return new it(i*t.x+n*e.x,i*t.y+n*e.y)}static equals(t,e,n){const i=t.x-e.x,s=t.y-e.y;return i*i+s*s<n*n}addPolar(t,e){this.x+=e*Math.cos(t),this.y+=e*Math.sin(t)}createTransferable(){return this}set(t){this.x=t.x,this.y=t.y}clone(){return new it(this.x,this.y)}toString(){const t=nt.format;return`<${t(this.x)},${t(this.y)}>`}}class st{data;constructor(t){if(this.data=new Float32Array(9),t)for(let t=0;t<3;t++)this.data[4*t]=1}setEntry(t,e,n){this.data[t+3*e]=n}getEntry(t,e){return this.data[t+3*e]}multiply(t,e=new it(0,0)){const n=this.data;return e.x=n[0]*t.x+n[3]*t.y+n[6],e.y=n[1]*t.x+n[4]*t.y+n[7],e}static compose(t,e,n){void 0===n&&(n=new st(!1));for(let i=0;i<3;i++)for(let s=0;s<3;s++){let a=0;for(let n=0;n<3;n++)a+=t.data[i+3*n]*e.data[n+3*s];n.data[i+3*s]=a}return n}}class at{minX;maxX;minY;maxY;constructor(t,e,n,i){this.minX=t,this.maxX=e,this.minY=n,this.maxY=i}static fromTransferable(t){return new at(t.minX,t.maxX,t.minY,t.maxY)}static createAt(t,e,n){const i=.5*e,s=.5*n;return new at(t.x-i,t.x+i,t.y-s,t.y+s)}static distance2(t,e){let n=0,i=0;return t.maxX<e.minX?n=e.minX-t.maxX:e.maxX<t.minX&&(n=t.minX-e.maxX),t.maxY<e.minY?i=e.minY-t.maxY:e.maxY<t.minY&&(i=t.minY-e.maxY),n*n+i*i}get width(){return this.maxX-this.minX}get height(){return this.maxY-this.minY}createTransferable(t=0){return{minX:this.minX-t,maxX:this.maxX+t,minY:this.minY-t,maxY:this.maxY+t}}extendTo(t,e=Number.EPSILON){return new at(Math.min(this.minX,t.x-e),Math.max(this.maxX,t.x+e),Math.min(this.minY,t.y-e),Math.max(this.maxY,t.y+e))}contains(t){const e=this.minX<=t.x&&t.x<this.maxX,n=this.minY<=t.y&&t.y<this.maxY;return e&&n}}const rt=.042,ot=new st(!0);ot.setEntry(0,0,rt),ot.setEntry(1,1,rt);class lt{#t=new it(0,0);#e=new st(!0);#n=new st(!0);#i=null;setRatio(t,e){this.#e.setEntry(0,0,e/t)}moveToSnake(t){this.moveTo(t.position)}moveTo(t){this.#t.set(t),this.#i=null}computeScreenCoordinates(t,e){const n=e.clientWidth,i=e.clientHeight,s=this.transformMatrix.multiply(t);return s.y*=-1,s.x+=1,s.x=.5*n*s.x,s.y+=1,s.y=.5*i*s.y,s}get position(){return this.#t}get transformMatrix(){if(null===this.#i){const t=this.#t;this.#n.setEntry(0,2,-t.x),this.#n.setEntry(1,2,-t.y),this.#i=st.compose(st.compose(this.#e,ot),this.#n)}return this.#i}get viewBox(){const t=this.#t,e=2/(this.#e.getEntry(0,0)*rt),n=2/rt;return new at(t.x-.5*e,t.x+.5*e,t.y-.5*n,t.y+.5*n)}}let ct=0;function dt(){return ct}function ut(t=performance.now()){ct=t}function ht(t){if(!Number.isFinite(t))return 0;for(;Math.abs(t)>Math.PI;)t-=2*Math.sign(t)*Math.PI;return t}const ft=2*Math.PI;function pt(t,e){const n=e-t,i=n-Math.sign(n)*ft;return Math.abs(i)<Math.abs(n)?i:n}function mt(t,e,n){return Math.max(t,Math.min(e,n))}const gt=65535;class _t{id;skin;headChunk=null;#s;#a=[];#r=new Set;#o;#l;#c;#d;#u;#h;#f;#p;#m=!1;#g;#_;#v;#k;#y;constructor(t,e){this.id=t.id,this.skin=t.skin,this.#s=e,this.#l=dt(),this.#_=it.fromObject(t.headPosition),this.#k=t.headDirection[0],this.#h=t.fast?1:0,this.update(t,0)}update(t,e){this.#o=dt(),this.#d=t.length,this.#c=t.headChunkId,this.#g=it.fromObject(t.headPosition),this.#v=t.headDirection[0],this.#y=t.headDirection[1],this.#u=t.fast,this.#f=t.width,t.name&&(this.#p=t.name),this.#m&&(this.#_=it.fromObject(t.headPosition),this.#k=t.headDirection[0],this.#l=dt(),this.#m=!1),this.#w(e,t.fastHistory)}predict(){this.#b(),this.#x();for(const t of this.#a)t.predict();this.headChunk&&this.headChunk.connectMeshToHead(),this.#E(),this.#l=dt()}registerSnakeChunk(t){if(this.#r.has(t.id))return;if(this.#r.add(t.id),t.id===this.#c)return this.#a.push(t),null!==this.headChunk&&this.headChunk.resetMesh(),void(this.headChunk=t);if(0===this.#a.length)return void this.#a.push(t);const e=gt-(this.#c&gt),n=vt(t,e);let i=this.#a.length-1;for(;0<=i&&!(vt(this.#a[i],e)<n);i--);this.#a.splice(i+1,0,t)}unregisterSnakeChunk(t){const e=this.#a.findIndex((e=>e===t));if(e<0)throw new Error(`Cannot unregister: Snake ${this.id} has no chunk with id ${t.id}.`);this.#r.delete(t.id),this.#a.splice(e,1)}getSnakeChunksIterator(){return this.#a.values()}hasChunks(){return this.#a.length>0}toString(){return`Snake ${this.id} with ${this.#a.length} chunks`}couldBeVisible(t,e=0){for(const n of this.#a)if(n.couldBeVisible(t,e))return!0;return this.isHeadVisible(t,e)}isHeadVisible(t,e=0){const n=5*this.#f,i=at.createAt(this.#_,n,n);return at.distance2(i,t.viewBox)<=e*e}destroy(){}pause(){this.#m=!0}get name(){return this.#p}get fast(){return this.#u}get smoothedFastValue(){return this.#h}get length(){return this.#d}get speed(){if(this.#m)return 0;const t=this.#s;return(this.#u?t.snakes.fastSpeed:t.snakes.speed)/t.tickDuration}get position(){return this.#_}get direction(){return this.#k}get width(){return this.#f}#b(){const t=this.speed,e=dt(),n=t*(e-this.#l)/1e3,i=t*(e-this.#o)/1e3;this.#_.addPolar(this.#k,n);const s=this.#g.clone();s.addPolar(this.#k,i),this.#_=it.lerp(this.#_,s,.15)}#x(){const t=dt(),e=this.#s.snakes.maxTurnDelta/this.#s.tickDuration,n=pt(this.#k,this.#y),i=pt(this.#v,this.#y),s=e*(t-this.#l)/1e3,a=e*(t-this.#o)/1e3,r=ht(this.#k+mt(-s,n,s)),o=ht(this.#v+mt(-a,i,a));this.#k=ht(r+.15*pt(r,o))}#E(){const t=(dt()-this.#l)/1e3,e=this.fast?1:0,n=mt(0,5*t,1);this.#h=n*e+(1-n)*this.#h}#w(t,e){if(0===t)return;const n=this.#s.snakes.fastSpeed,i=this.#s.snakes.speed;let s=0;const a=Math.min(t,e.length);for(let t=0;t<a;t++)s+=e[t]?n:i;for(let e=a;e<t;e++)s+=i;for(const t of this.#a)t.id!==this.#c&&t.updateOffset(s)}}function vt(t,e){return(t.id&gt)+e&gt}class kt{snake;id;gpuData;#T=!1;#S;#C=dt();#o;#d;#A;#l=dt();#P;#R;constructor(t,e){this.snake=t,this.id=e.id,t.registerSnakeChunk(this),this.update(e),this.#R=e.offset}update(t){if(this.#T=t.full,this.#S=at.fromTransferable(t.boundingBox),this.gpuData={buffer:t.data,vertices:t.vertices},this.#P=t.offset,0===this.#P){const e=t.length-this.#d;this.#R-=e}this.#d=t.length,this.#A=dt(),this.#o=dt()}updateOffset(t){this.#P+=t,this.#A=dt()}predict(){const t=this.snake.speed,e=dt(),n=t*(e-this.#l)/1e3,i=t*(e-this.#A)/1e3,s=this.#R+n,a=this.#P+i;this.#R=.85*s+.15*a,this.#l=dt()}connectMeshToHead(){const t=this.snake.position,e=this.gpuData.buffer;let n=6*(this.gpuData.vertices-2);e[n+0]=t.x,e[n+1]=t.y,e[n+5]=-this.#R,n+=6,e[n+0]=t.x,e[n+1]=t.y,e[n+5]=-this.#R}resetMesh(){const t=this.gpuData.buffer;let e=6*(this.gpuData.vertices-2),n=e-12;t[e+0]=t[n+0],t[e+1]=t[n+1],t[e+5]=t[n+5],e+=6,n+=6,t[e+0]=t[n+0],t[e+1]=t[n+1],t[e+5]=t[n+5]}couldBeVisible(t,e=0){const n=at.distance2(t.viewBox,this.#S),i=.5*this.snake.width+e;return n<=i*i}destroy(){this.snake.unregisterSnakeChunk(this)}toString(){return`SnakeChunk ${this.id} of snake ${this.snake.id}`}get offset(){return this.#R}get boundingBox(){return this.#S}get junk(){return this.#P>=this.snake.length}get final(){return this.#T}get shortId(){return 65535&this.id}get clientAge(){return.001*(dt()-this.#C)}get debugInfo(){throw new Error}}class yt{listeners=new Set;_deviceName;constructor(t){this._deviceName=t}addListener(t){this.listeners.add(t)}set(t){this.notifyListeners(t)}notifyListeners(t){this.listeners.forEach((e=>e(t)))}getDeviceName(){return this._deviceName}}const wt=new Set,bt=new class{id;defaultValue;label;#L;#U=!1;#I=[];constructor(t,e,n){this.id=t,this.defaultValue=e,this.label=n;try{const t=window.localStorage.getItem(this.#M);null!==t&&(this.#L=JSON.parse(t),this.#U=!0)}catch(t){console.warn("Failed to load value from local storage.")}}setValue(t){const e=this.#F;this.#U&&e===t||(this.#L=t,this.#U=!0,this.#D(),this.#O(t))}resetValue(){if(!this.#U)return;const t=this.#L;this.#L=null,this.#U=!1,this.#D(),t!==this.defaultValue&&this.#O(this.defaultValue)}subscribe(t){this.#I.push(t),t(this.#F)}get#F(){return this.#U?this.#L:this.defaultValue}#O(t){this.#I.forEach((e=>e(t)))}get#M(){return"settings."+this.id}#D(){const t=this.#M;this.#U?window.localStorage.setItem(t,JSON.stringify(this.#F)):window.localStorage.removeItem(t)}static resetForTests(){wt.clear()}}("input.pointerLock",!1,"Lock pointer");class xt extends yt{clickCatcher=null;lockPointer=!1;constructor(t){super("pointer"),this.pointerDownHandler=this.pointerDownHandler.bind(this),this.pointerUpHandler=this.pointerUpHandler.bind(this),window.addEventListener("pointermove",(e=>{if(null!==this.clickCatcher&&document.pointerLockElement===this.clickCatcher){const n=t().direction;let i=2*Math.cos(n),s=2*Math.sin(n);i+=.01*e.movementX,s-=.01*e.movementY,0===i&&0===s||this.set({direction:Math.atan2(s,i)})}else{const t=e.pageX-.5*window.innerWidth,n=.5*window.innerHeight-e.pageY;if(t*t+n*n>1){const e=Math.atan2(n,t);this.set({direction:e})}}})),bt.subscribe((t=>this.lockPointer=t))}pointerDownHandler(t){t.stopPropagation(),this.lockPointer&&document.pointerLockElement!==this.clickCatcher&&this.clickCatcher?.requestPointerLock(),this.set({wantsFast:!0})}pointerUpHandler(t){t.stopPropagation(),this.set({wantsFast:!1})}setClickCatcher(t){null!==this.clickCatcher&&(this.clickCatcher.removeEventListener("pointerdown",this.pointerDownHandler),this.clickCatcher.removeEventListener("pointerup",this.pointerUpHandler),this.clickCatcher.removeEventListener("pointercancel",this.pointerUpHandler)),t.addEventListener("pointerdown",this.pointerDownHandler),t.addEventListener("pointerup",this.pointerUpHandler),t.addEventListener("pointercancel",this.pointerUpHandler),this.clickCatcher=t}}class Et extends yt{pressed=new Set;keyMappings=new Map;trackedKeys=new Set;stateProvider;previousTickAnyPressed=!1;lastTick=dt();constructor(t){super("keyboard"),this.stateProvider=t,this.addMappings("left",["a","ArrowLeft"]),this.addMappings("right",["d","ArrowRight"]),this.addMappings("fast",["w","ArrowUp","Shift"," "]),window.addEventListener("keydown",(t=>{this.pressed.add(t.key.toLowerCase())})),window.addEventListener("keyup",(t=>{this.pressed.delete(t.key.toLowerCase())})),window.addEventListener("blur",(()=>{this.pressed.clear()}))}addMappings(t,e){const n=this.keyMappings.get(t)??new Set;e.forEach((t=>{const e=t.toLowerCase();n.add(e),this.trackedKeys.add(e)})),this.keyMappings.set(t,n)}tick(){const t=2.5*(dt()-this.lastTick)/1e3;this.lastTick=dt();const e=this.anyPressed();if(!e&&!this.previousTickAnyPressed)return;this.previousTickAnyPressed=e;const n=this.isPressed("fast"),i=this.stateProvider().direction;let s=0;this.isPressed("left")&&(s+=t),this.isPressed("right")&&(s-=t),this.set({wantsFast:n,direction:i+s})}isPressed(t){const e=this.keyMappings.get(t);if(void 0===e)return!1;for(const t of e)if(this.pressed.has(t.toLowerCase()))return!0;return!1}anyPressed(){for(const t of this.pressed)if(this.trackedKeys.has(t))return!0;return!1}}const Tt=new Set,St=new Set,Ct=[];let At,Pt=!1,Rt=0;function Lt(t){Tt.add(t)}function Ut(t){var e;t instanceof Et&&Ct.push(t),t.addListener((e=t,t=>{const n=void 0!==t.direction?ht(t.direction):Rt,i=t.wantsFast??Pt;if(Pt===i&&Rt===n)return;Rt=n,Pt=i,Tt.forEach((t=>t(i,n)));const s=e.getDeviceName();At!==s&&(At=s,St.forEach((t=>t(s))))}))}class It{snakeId;#N;#B;#H=!0;#V;constructor(t,e,n){this.snakeId=e,this.#N=t,this.#B=n,this.#V=(t,e)=>{this.alive&&this.#N.sendUserInput(e,t,this.#B.camera.viewBox)},Lt(this.#V),n.events.snakeDeath.addListener((({deadSnakeId:t})=>{var e;t===this.snakeId&&(this.#H=!1,e=this.#V,Tt.delete(e))}))}get alive(){return this.#H}}class Mt extends p{render(){const t=this.props.options,e=t.buttons??[];return M("div",{class:"dialog-container",children:[M("div",{class:"dialog-shadow"}),M("div",{class:"dialog-modal",children:[t.title?M("div",{class:"dialog-title",children:t.title}):null,M("div",{class:"dialog-content",children:t.content}),M("div",{class:"dialog-buttons",children:e.map((t=>M("button",{onClick:()=>{const e=t.action?t.action():t.value;void 0!==e&&this.props.onExit(e)},children:t.label},t.label)))})]})]})}}const Ft=[],Dt=document.createElement("div");let Ot=null;function Nt(t){return new Promise((e=>{Ft.push({options:{buttons:[{label:"Ok",value:"ok"}],...t},onExit:t=>{Ot=null,e(t),Bt()}}),Bt()}))}function Bt(){if(null!==Ot)return;const t=Ft.shift();U(null,Dt),t?(Ot=t,U(u(Mt,t),Dt),Dt.classList.add("show")):Dt.classList.remove("show")}class Ht{#X=!1;#Y=void 0;#W=void 0;set(){if(this.#X=!0,this.#W){const t=this.#W;this.#W=void 0,this.#Y=void 0,t()}}clear(){this.#X=!1}isSet(){return this.#X}wait(t=0){return this.#X?Promise.resolve():(void 0===this.#Y&&(this.#Y=new Promise((t=>this.#W=t))),t>0?Promise.race([this.#Y,new Promise(((e,n)=>{window.setTimeout(n,t)}))]):this.#Y)}}const Vt={alpha:!0,depth:!1,antialias:!0,preserveDrawingBuffer:!1,premultipliedAlpha:!1},Xt=new Ht;let Yt=null;function Wt(){if(!Yt)throw new Error("No WebGL context available");return Yt}async function zt(){return Xt.isSet()||await Xt.wait(),Wt()}const jt=[];function Gt(t){const e=t.createBuffer();if(null===e)throw new Error("Failed to create buffer.");return e}(async()=>{{const t=await zt();for(let e=0;e<16;e++)jt.push(Gt(t))}})();const $t=[{snakeBody:[128,191,255],food:[0,128,255]},{snakeBody:[255,184,114],food:[255,134,14]},{snakeBody:[191,255,128],food:[25,255,42]},{snakeBody:[250,255,80],food:[255,255,22]},{snakeBody:[230,67,197],food:[255,0,255]},{snakeBody:[255,81,55],food:[255,25,12]},{snakeBody:[112,111,110],food:[128,182,222]}];function Kt(){return $t}const qt=(()=>{const t=Kt(),e=new Uint8Array(8*t.length);return t.forEach(((t,n)=>{const i=4*n,s=e.length/2+i;e[i]=t.snakeBody[0],e[i+1]=t.snakeBody[1],e[i+2]=t.snakeBody[2],e[i+3]=255,e[s]=t.food[0],e[s+1]=t.food[1],e[s+2]=t.food[2],e[s+3]=255})),e})();let Zt;function Jt(t,e,n){t.setUniform(e,Qt(n))}function Qt(t){const e=Kt();return(t%e.length+.5)/e.length}(async()=>{const t=await zt();Zt=t.createTexture(),t.bindTexture(t.TEXTURE_2D,Zt),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);const e=t.RGBA;t.texImage2D(t.TEXTURE_2D,0,e,Kt().length,2,0,e,t.UNSIGNED_BYTE,qt)})();const te=[[-1,1],[1,1],[-1,-1],[-1,-1],[1,1],[1,-1]];class ee{static FOOD_VERTEX_SIZE=5;id;box;#z;#j=new Float32Array(32*te.length);#G;#o;constructor(t){this.id=t.id,this.box=at.fromTransferable(t.bounds),this.#z=jt.length>0?jt.pop():Gt(Wt()),this.update(t)}update(t){this.#G=t.items.length,this.#j=function(t,e){const n=ee.FOOD_VERTEX_SIZE*te.length,i=t.length*n,s=ee.FOOD_VERTEX_SIZE;(void 0===e||e.length<i)&&(e=new Float32Array(i));for(let i=0;i<t.length;i++){const a=t[i],r=i*n,o=Qt(a.color);for(let t=0;t<te.length;t++){const[n,i]=te[t];e[r+s*t+0]=a.size*n+a.x,e[r+s*t+1]=a.size*i+a.y,e[r+s*t+2]=n,e[r+s*t+3]=i,e[r+s*t+4]=o}}return e}(t.items,this.#j),this.#o=dt()}destroy(){!function(t){jt.length<128&&jt.push(t)}(this.#z)}useBuffer(t){t.bindBuffer(t.ARRAY_BUFFER,this.#z),this.#j&&(t.bufferData(t.ARRAY_BUFFER,this.#j,t.STATIC_DRAW),this.#j=void 0)}isVisible(t,e=0){return at.distance2(this.box,t.viewBox)<=e*e}get numberOfVertices(){return this.#G*te.length}get age(){return.001*(dt()-this.#o)}}class ne{#$=new Map;#K;constructor(t){this.#K=t}add(t,e){const n=this.#$.get(t.id);if(n)n.update(t,e);else{const e=this.#K(t);t.id,e.id,this.#$.set(t.id,e)}}addMultiple(t,e){for(const n of t)this.add(n,e)}get(t){return this.#$.get(t)}has(t){return this.#$.has(t)}runIfPresent(t,e){const n=this.#$.get(t);return n&&e(n),void 0!==n}remove(t){const e=this.#$.get(t);return e&&(this.#$.delete(t),e.destroy&&e.destroy()),e}removeIf(t){const e=[];for(const n of this.#$.values())t(n)&&e.push(n);for(const t of e)t.destroy&&t.destroy(),this.#$.delete(t.id);return e}forEach(t){this.#$.forEach(t)}values(){return this.#$.values()}entries(){return this.#$.entries()}clear(){this.#$.clear()}get size(){return this.#$.size}}class ie{#I=new Set;addListener(t){this.#I.add(t)}trigger(t){this.#I.forEach((e=>e(t)))}}class se{snakes;snakeChunks;foodChunks;events={snakeDeath:new ie,gameEnd:new ie};camera=new lt;statistics={leaderboard:[],numPlayers:0,numBots:0};heatMap;#N;#q;#Z=!1;#J;#Q=0;#tt=!1;constructor(){this.#N=Y(new Worker("worker.bundle.js",{name:"SnakeWorker"})),this.snakes=new ne((t=>new _t(t,this.#q))),this.snakeChunks=new ne((t=>{const e=this.snakes.get(t.snakeId);if(void 0===e)throw new Error(`SnakeChunk for unknown snake ${t.snakeId}.`);return new kt(e,t)})),this.foodChunks=new ne((t=>new ee(t))),this.events.snakeDeath.addListener((({deadSnakeId:t,killer:e})=>{t!==this.#J?e&&e.snakeId===this.#J&&this.#Q++:this.#J=void 0}))}static async joinAsPlayer(){const t=await et,e=new se,n=e.#N,i=await n.init(t).catch((async t=>(await Nt({title:"Error",content:"Failed to connect to the game server."}),Promise.reject(t))));e.#q=i.config,e.camera.moveTo(it.fromObject(i.startPosition)),e.#J=i.targetSnakeId,e.heatMap=new Uint8Array(i.config.chunks.rows*i.config.chunks.columns),n.addEventListener("serverUpdate",$((()=>{e.#Z=!0}))),n.addEventListener("disconnect",$((()=>{e.#tt=!0,e.events.gameEnd.trigger({reason:"disconnect"})}))),n.addEventListener("spectatorChange",$((t=>{const n=t;n.followSnake?e.#J=n.targetSnakeId:(e.#J=void 0,e.camera.moveTo(it.fromObject(n.position)))})));const s=new It(n,i.targetSnakeId,e);return[e,s]}static joinAsSpectator(){throw new Error("not implemented")}async update(){if(!this.#Z)return;const t=await this.#N.getDataChanges();this.#Z=t.moreUpdates;const e=t.ticksSinceLastUpdate;t.leaderboard&&(this.statistics=t.leaderboard),t.heatMap&&(this.heatMap=t.heatMap),this.foodChunks.addMultiple(t.foodChunks),this.snakes.addMultiple(t.snakes,e),this.snakeChunks.addMultiple(t.snakeChunks);for(const{deadSnakeId:e,killer:n}of t.snakeDeaths){const t=this.snakes.get(e);if(this.events.snakeDeath.trigger({deadSnakeId:e,killer:n,snake:t}),!t)continue;const i=Array.from(t.getSnakeChunksIterator());for(const t of i)this.snakeChunks.remove(t.id);this.snakes.remove(e)}const n=new Set(t.snakes.map((t=>t.id)));n.size>0&&this.snakes.forEach((t=>{n.has(t.id)||t.pause()})),t.moreUpdates?await this.update():this.#et()}predict(){if(!this.#tt){for(const t of this.snakes.values())t.predict();this.targetSnake&&this.camera.moveToSnake(this.targetSnake)}}quit(){this.#N.quit(),this.#tt=!0}get config(){return this.#q}get targetSnake(){if(void 0!==this.#J)return this.snakes.get(this.#J)}get targetSnakeKills(){return this.#Q}#et(){const t=this.camera,e=2*this.#q.snakes.fastSpeed;this.snakeChunks.removeIf((n=>n.junk||!n.couldBeVisible(t,e)&&n.clientAge>1)),this.foodChunks.removeIf((n=>!n.isVisible(t,e)&&n.age>1)),this.snakes.removeIf((n=>n.id!==this.#J&&!n.hasChunks()&&!n.couldBeVisible(t,e)))}}class ae extends p{#nt={current:null};#it;#st;#at=0;#rt=0;#ot;#lt;#ct;constructor(t){super(t),this.#ct=t.maxFPS??60}componentDidMount(){const t=this.#nt.current.getContext("2d",{alpha:!1});this.#it=t,this.#ot=performance.now(),this.#lt=this.#ot,t.fillStyle="black",t.fillRect(0,0,t.canvas.width,t.canvas.height),this.#st=window.requestAnimationFrame(this.#dt.bind(this))}#dt(){const t=performance.now(),e=t-this.#ot,n=t-this.#lt,i=1e3/3;if(e>=i&&(this.#ut(),this.#ot=t-(e-i),this.#at=0),n>=1e3){const e=this.#rt;this.#rt=0,this.#lt=t-(n-1e3),this.setState({fps:e})}this.#at++,this.#rt++,this.#st=window.requestAnimationFrame(this.#dt.bind(this))}#ut(){const t=this.#it,e=t.canvas,n=3*this.#at;if(n>this.#ct){const i=Math.round(e.height*this.#ct/n);t.drawImage(e,0,e.height-i,e.width,i),t.fillStyle="black",t.fillRect(0,0,e.width,e.height-i),this.#ct=n}const i=e.width-2;t.drawImage(e,2,0,i,e.height,0,0,i,e.height),t.fillStyle="black",t.fillRect(e.width-2,e.height,2,e.height);const s=Math.floor(e.height*n/this.#ct);t.fillStyle="white",t.fillRect(e.width-2,e.height-s,2,s)}componentWillUnmount(){window.cancelAnimationFrame(this.#st)}render(){return M("div",{id:"fps-stats",children:[M("canvas",{ref:this.#nt,width:100,height:42}),M("div",{id:"fps-text",children:`FPS: ${this.state.fps??"-"}`})]})}}class re extends p{render(){const t=this.props.data;if(!t||0===t.leaderboard.length)return null;const e=this.props.targetId;return M("div",{id:"game-stats",children:[M("div",{id:"leaderboard",class:t.leaderboard.length>1?"multiple":"",children:t.leaderboard.map(((t,n)=>M(oe,{data:t,index:n,isTarget:t.id===e},t.name)))}),M("div",{id:"player-numbers",children:[M("div",{children:"Players"}),M("div",{children:t.numPlayers}),M("div",{children:"Bots"}),M("div",{children:t.numBots})]})]})}}function oe(t){const e=t.data,n=t.index,i=t.isTarget?"target":"";return M(f,{children:[M("span",{class:i,children:[n+1,"."]}),M("span",{class:i,children:e.name}),M("span",{class:i,title:"length",children:e.length}),M("span",{class:i,title:"kills",children:0===e.kills?"-":e.kills+"K"})]})}class le extends p{render(){const t=this.props.snake;if(!t)return null;const e=this.props.kills??0;return M("div",{id:"snake-info",children:[M("div",{id:"snake-name",children:t.name}),M("div",{id:"snake-data",children:[M("span",{class:"label",children:"Length:"}),M("span",{class:"value",children:Math.round(t.length)}),e>0?M(f,{children:[M("span",{class:"label",children:"Kills:"}),M("span",{class:"value",children:e})]}):null]})]})}}class ce extends p{#ht;componentDidMount(){this.#ht=window.setInterval((()=>{this.forceUpdate()}),500)}componentWillUnmount(){window.clearInterval(this.#ht)}render(){const t=this.props.game;return M(f,{children:[M(re,{data:t.statistics,targetId:t.targetSnake?.id}),M(ae,{}),M(le,{snake:t.targetSnake,kills:t.targetSnakeKills})]})}}function de(t){return M(f,{children:t.texts.map((t=>{let e=`top:${t.y}px;left:${t.x}px;color:${t.color};`;return t.minWidth&&(e+=`min-width:${t.minWidth};`),t.color&&(e+=`color:${t.color};`),M("div",{class:t.debug?"text debug":"text",style:e,children:t.text},t.key)}))})}let ue=null;const he=[];function fe(t,e,n){he.push({text:t,key:e,size:12,...n})}class pe{gl;program;uniforms=new Map;attribs=new Map;attribOrder;autoStride=0;constructor(t,e,n,i){this.gl=t;const s=ge(t,t.VERTEX_SHADER,e),a=ge(t,t.FRAGMENT_SHADER,n),r=t.createProgram();if(t.attachShader(r,s),t.attachShader(r,a),t.linkProgram(r),!t.getProgramParameter(r,t.LINK_STATUS))throw new Error("Shader linking failed: "+t.getProgramInfoLog(r));this.program=r;const o=t.getProgramParameter(r,t.ACTIVE_ATTRIBUTES),l=[];for(let e=0;e<o;e++){const n=t.getActiveAttrib(r,e),i=t.getAttribLocation(r,n.name);this.attribs.set(n.name,new me(n,i)),l.push(n.name)}this.attribOrder=void 0!==i?[...i]:l,this.computeStride();const c=t.getProgramParameter(r,t.ACTIVE_UNIFORMS);for(let e=0;e<c;e++){const n=t.getActiveUniform(r,e),i=t.getUniformLocation(r,n.name);this.uniforms.set(n.name,new me(n,i))}}computeStride(){const t=Array.from(this.attribs.values()).filter((t=>null===t.value)).reduce(((t,e)=>t+e.size),0);this.autoStride=t*Float32Array.BYTES_PER_ELEMENT}use(){this.gl.useProgram(this.program)}run(t,e){const n=this.gl,{mode:i,start:s,stride:a}=Object.assign({mode:this.gl.TRIANGLES,start:0,stride:this.autoStride},e);let r=0;for(const t of this.attribOrder){const e=this.attribs.get(t);if(null===e.value)n.enableVertexAttribArray(e.location),n.vertexAttribPointer(e.location,e.size,n.FLOAT,!1,a,r*Float32Array.BYTES_PER_ELEMENT),r+=e.size;else{if(e.type!==n.FLOAT)throw new Error("Constant values for attributes not yet implemented!");n.vertexAttrib1f(e.location,e.value)}}this.uniforms.forEach((t=>{if(null!==t.value)if(t.type===n.FLOAT)n.uniform1f(t.location,t.value);else if(t.type===n.SAMPLER_2D)n.uniform1i(t.location,t.value);else if(t.type===n.FLOAT_VEC2)n.uniform2fv(t.location,t.value);else if(t.type===n.FLOAT_VEC3)n.uniform3fv(t.location,t.value);else if(t.type===n.FLOAT_VEC4)n.uniform4fv(t.location,t.value);else if(t.type===n.FLOAT_MAT3)n.uniformMatrix3fv(t.location,!1,t.value);else{if(t.type!==n.FLOAT_MAT4)throw new Error(`Uniform type ${t.type} not implemented.`);n.uniformMatrix4fv(t.location,!1,t.value)}})),n.drawArrays(i,s,t)}get context(){return this.gl}setAttribute(t,e){const n=this.attribs.get(t);if(void 0===n)throw new Error(`Attribute ${t} does not exist.`);const i=null===n.value!=(null===e);n.value=e,i&&this.computeStride()}setUniform(t,e){const n=this.uniforms.get(t);if(void 0===n)throw new Error(`Uniform ${t} does not exist.`);n.value=e}}class me{name;type;location;size;value=null;constructor(t,e){this.name=t.name,this.type=t.type,this.size=_e.get(t.type)*t.size,this.location=e}}function ge(t,e,n){const i=t.createShader(e);if(t.shaderSource(i,n),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS))throw new Error("Shader compile error "+t.getShaderInfoLog(i));return i}const _e=new Map([[WebGLRenderingContext.FLOAT,1],[WebGLRenderingContext.FLOAT_VEC2,2],[WebGLRenderingContext.FLOAT_VEC3,3],[WebGLRenderingContext.FLOAT_VEC4,4],[WebGLRenderingContext.FLOAT_MAT3,9],[WebGLRenderingContext.FLOAT_MAT4,16]]),ve=new Map,ke=new Ht;async function ye(t){return await ke.wait(),ve.has(t)?ve.get(t):Promise.reject(new Error(`Shader ${t} not found.`))}async function we(t,e,n){const i=await ye(e+".vert"),s=await ye(e+".frag");try{return new pe(t,i,s,n)}catch(t){return console.error(t),await Nt({title:"Error",content:`Failed to compile shader "${e}".`}),Promise.reject(t)}}let be,xe;(async()=>{const t=await Q("shaders.json?h=879eafe6b3",{guard:function(t){if("object"!=typeof t)return!1;for(const[e,n]of Object.entries(t))if("string"!=typeof e||"string"!=typeof n)return!1;return!0}});for(const[e,n]of Object.entries(t))ve.set(e,n);ke.set()})();const Ee=function(t){const e=new Float32Array(2*t.length*2);let n=0;for(const[i,s]of t)e[n++]=-i,e[n++]=s,e[n++]=i,e[n++]=s;return e}([[.5,-1],[1,0],[.4,2]]),Te=-.5*Math.PI;let Se,Ce;(async()=>{const t=await zt();be=t.createBuffer(),xe=await we(t,"head"),xe.use(),t.bindBuffer(t.ARRAY_BUFFER,be),t.bufferData(t.ARRAY_BUFFER,Ee,t.STATIC_DRAW)})(),new Float32Array(8),(async()=>{const t=await zt();Se=await we(t,"solidcolor"),Ce=t.createBuffer()})();const Ae=new WeakMap,Pe=new WeakMap;let Re,Le;function Ue(){const t=Wt().createBuffer();if(null===t)throw new Error("Failed to create WebGL buffer.");return t}(async()=>{const t=await zt();Re=await we(t,"snake",["aPosition","aNormal","aNormalOffset","aRelativePathOffset"])})();const Ie=ee.FOOD_VERTEX_SIZE,Me=new it(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);(async()=>{const t=await zt();Le=await we(t,"food",["aPosition","aLocalPos","aColorIndex"])})();const Fe=document.createElement("canvas").getContext("2d");function De(t,e){return Fe.font=`sans-serif ${e}px`,Fe.measureText(t).width}const Oe=new st(!0);let Ne,Be,He,Ve,Xe=0,Ye=!0,We=null;const ze=new Float32Array([0,1,1,1,0,0,1,0]);async function je(t){const e=await zt();Ne.use(),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.bindBuffer(e.ARRAY_BUFFER,Be),function(t){const{width:e,height:n}=t.canvas,i=2/e,s=2/n;Oe.setEntry(0,0,128*i),Oe.setEntry(1,1,128*s),Oe.setEntry(0,2,1-138*i),Oe.setEntry(1,2,10*s-1)}(e);const n=t.camera.position;!function(t,e){const{columns:n,rows:i}=e.config.chunks;if(Xe=.8*Xe+.2*(Ye?0:1),We===e.heatMap)return;Ye&&null!==We?t.activeTexture(WebGLRenderingContext.TEXTURE3):t.activeTexture(WebGLRenderingContext.TEXTURE2),Ye?t.bindTexture(t.TEXTURE_2D,Ve):t.bindTexture(t.TEXTURE_2D,He);const s=t.LUMINANCE;t.texImage2D(t.TEXTURE_2D,0,s,n,i,0,s,t.UNSIGNED_BYTE,e.heatMap),null!==We&&(Ye=!Ye,Xe=Ye?1:0),We=e.heatMap}(e,t),Ne.setUniform("uHeatMapTexture1",2),Ne.setUniform("uHeatMapTexture2",3),Ne.setUniform("uTextureMix",Xe),Ne.setUniform("uCameraPosition",function(t,e){const n=t.config.chunks,i=n.columns*n.size,s=n.rows*n.size;return[(.5*i+e.x)/i,(.5*s+e.y)/s]}(t,n)),Ne.setUniform("uTransform",Oe.data),Ne.run(4,{mode:e.TRIANGLE_STRIP})}function Ge(t){const e=t.createTexture();return t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),e}(async()=>{const t=await zt();Ne=await we(t,"heatmap"),Be=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,Be),t.bufferData(t.ARRAY_BUFFER,ze.buffer,t.STATIC_DRAW),He=Ge(t),Ve=Ge(t)})();const $e=document.createElement("div"),Ke=document.createElement("div"),qe=document.createElement("div");var Ze;Ke.append(qe),$e.append(Ke),$e.id="input-container",Ke.id="input-viz-ring",Ke.classList.add("hide"),qe.id="input-viz-marker",Lt(((t,e)=>{qe.style.transform=`rotate(${-e}rad)`})),Ze=t=>{"keyboard"===t?Ke.classList.remove("hide"):Ke.classList.add("hide")},St.add(Ze),document.addEventListener("pointerlockchange",(()=>{null!==document.pointerLockElement?Ke.classList.remove("hide"):Ke.classList.add("hide")}));var Je=n(379),Qe=n.n(Je),tn=n(795),en=n.n(tn),nn=n(569),sn=n.n(nn),an=n(565),rn=n.n(an),on=n(216),ln=n.n(on),cn=n(589),dn=n.n(cn),un=n(145),hn={};hn.styleTagTransform=dn(),hn.setAttributes=rn(),hn.insert=sn().bind(null,"head"),hn.domAPI=en(),hn.insertStyleElement=ln(),Qe()(un.Z,hn),un.Z&&un.Z.locals&&un.Z.locals;const fn=document.createElement("canvas");fn.id="mainCanvas",document.body.append(fn),function(t){const e=t.getContext("webgl",Vt);if(null===e)throw new Error("Failed to create WebGL context.");e.disable(WebGLRenderingContext.DEPTH_TEST),e.enable(WebGLRenderingContext.BLEND),e.pixelStorei(WebGLRenderingContext.UNPACK_ALIGNMENT,1),t.addEventListener("webglcontextlost",(t=>{console.error("WebGL context lost.",t),Nt({title:"Error",content:"The WebGL context has been lost. Reload the page should fix the issue.",buttons:[{label:"Reload",action:()=>window.location.reload()}]})})),Yt=e,Xt.set()}(fn);const pn=document.createElement("div");pn.id="textLayer",document.body.append(pn),function(t){ue=t}(pn),document.body.append($e);const mn=document.createElement("div");async function gn(){const[t,e]=await se.joinAsPlayer(),n=new Ht;return window.requestAnimationFrame((function n(i){ut(i),t.predict(),function(t){const e=Wt();!function(t){const e=t.canvas,n=e.clientWidth,i=e.clientHeight;e.width===n&&e.height===i||(e.width=n,e.height=i,t.viewport(0,0,n,i))}(e);const n=e.canvas;t.camera.setRatio(n.clientWidth,n.clientHeight),e.clearColor(.1,.1,.1,1),e.clear(e.COLOR_BUFFER_BIT);const i=t.camera.transformMatrix;!function(){const t=Wt(),e=WebGLRenderingContext.TEXTURE0;t.activeTexture(e),t.bindTexture(t.TEXTURE_2D,Zt)}(),function(t,e){const n=Wt(),i=t.targetSnake;Le.use(),n.blendFunc(n.SRC_ALPHA,n.ONE),Le.setUniform("uColorSampler",0),Le.setUniform("uTransform",e.data);const s=i?i.position:Me;Le.setUniform("uAttractorPosition",[s.x,s.y]);for(const e of t.foodChunks.values())e.isVisible(t.camera)&&(e.useBuffer(n),Le.run(e.numberOfVertices,{stride:Ie*Float32Array.BYTES_PER_ELEMENT}))}(t,i),function(t,e){const n=Wt(),i=t.camera,s=Re;s.use(),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),s.setUniform("uTransform",e.data),s.setUniform("uColorSampler",0);for(const e of t.snakes.values())if(e.hasChunks()){Jt(s,"uSkin",e.skin),s.setUniform("uSnakeFast",e.smoothedFastValue),s.setUniform("uSnakeLength",e.length),s.setUniform("uSnakeMaxWidth",e.width),s.setUniform("uSnakeThinningStart",Math.min(.75,.025*e.length)*e.length);for(const t of e.getSnakeChunksIterator()){if(!t.couldBeVisible(i))continue;s.setUniform("uChunkPathOffset",t.offset);const e=t.gpuData;if(t.final)if(Ae.has(t))n.bindBuffer(n.ARRAY_BUFFER,Ae.get(t));else{const i=Pe.get(t)??Ue();Ae.set(t,i),Pe.delete(t),n.bindBuffer(n.ARRAY_BUFFER,i),n.bufferData(n.ARRAY_BUFFER,e.buffer,n.STATIC_DRAW)}else{const i=Pe.get(t)??Ue();Pe.set(t,i),n.bindBuffer(n.ARRAY_BUFFER,i),n.bufferData(n.ARRAY_BUFFER,e.buffer,n.STREAM_DRAW)}s.run(e.vertices,{mode:n.TRIANGLE_STRIP})}}}(t,i),function(t,e){const n=Wt();xe.use(),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),n.bindBuffer(n.ARRAY_BUFFER,be),xe.setUniform("uTransform",e.data);for(const e of t.snakes.values()){if(!e.hasChunks()||!e.isHeadVisible(t.camera))continue;const{x:i,y:s}=e.position;xe.setUniform("uSnakeWidth",1.25*e.width),xe.setUniform("uHeadPosition",[i,s]),xe.setUniform("uHeadRotation",e.direction+Te),xe.setUniform("uSnakeFast",e.smoothedFastValue),Jt(xe,"uSkin",e.skin),xe.run(Ee.length/2,{mode:n.TRIANGLE_STRIP})}}(t,i),function(t){const e=Wt().canvas,n=t.targetSnake;for(const a of t.snakes.values()){if(a===n||!a.hasChunks()||(i=t.camera,s=a.position,!i.viewBox.contains(s)))continue;const r=t.camera.computeScreenCoordinates(a.position,e),o=10+.5*a.width,l=a.name;l&&fe(l,`snake${a.id}`,{color:"white",x:r.x,y:r.y+o,size:12,minWidth:De(l,12)})}var i,s}(t),function(){if(null===ue)throw new Error("Text renderer not initialized.");U(u(de,{texts:he}),ue),he.length=0}(),je(t)}(t),e.alive&&Ct.forEach((t=>t.tick())),setTimeout((()=>t.update())),window.requestAnimationFrame(n)})),U(u(ce,{game:t}),mn),window.addEventListener("error",(e=>{t.quit(),console.error("Stopped due to unhandled error.",e)})),t.events.snakeDeath.addListener((async t=>{t.deadSnakeId===e.snakeId&&(document.exitPointerLock(),"try-again"===await Nt({title:"Game over",content:t.killer?`You are dead because you crashed into ${t.killer.name}.`:"You are dead.",buttons:[{label:"Spectate",value:"spectate"},{label:"Try again",value:"try-again"}]})&&n.set())})),t.events.gameEnd.addListener((async t=>{"disconnect"===t.reason&&(await Nt({title:"Disconnected",content:"You have been disconnected from the server.",buttons:[{label:"Try again",value:"try-again"}]}),n.set())})),n.wait()}mn.id="root",document.body.append(mn),function(t){Ct.length=0;const e=new xt((()=>({wantsFast:Pt,direction:Rt})));e.setClickCatcher(t),Ut(e),Ut(new Et((()=>({wantsFast:Pt,direction:Rt}))))}(mn),Dt.id="dialogLayer",document.body.append(Dt),document.title="Ring of Snakes 0.9.1",(async()=>{if("https:"!==window.location.protocol)for(ut(performance.now());;)await gn();else{const{host:t,pathname:e}=window.location,n=`http://${t}${e}`;await Nt({title:"Error",content:M(f,{children:["Unfortunately ",M("b",{children:"HTTPS"})," is not yet supported.","\n","Please use HTTP instead:"," ",M("pre",{children:n})]}),buttons:[{label:"Switch to HTTP",action:()=>window.location.replace(n)}]})}})()})()})();