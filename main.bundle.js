/*! For license information please see main.bundle.js.LICENSE.txt */
(()=>{"use strict";var t,e,n,i,s,r,a,o,l,c,u,h={},d=[],f=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,p=Array.isArray;function m(t,e){for(var n in e)t[n]=e[n];return t}function _(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function g(e,n,i){var s,r,a,o={};for(a in n)"key"==a?s=n[a]:"ref"==a?r=n[a]:o[a]=n[a];if(arguments.length>2&&(o.children=arguments.length>3?t.call(arguments,2):i),"function"==typeof e&&null!=e.defaultProps)for(a in e.defaultProps)void 0===o[a]&&(o[a]=e.defaultProps[a]);return v(e,o,s,r,null)}function v(t,i,s,r,a){var o={type:t,props:i,key:s,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:null==a?++n:a,__i:-1,__u:0};return null==a&&null!=e.vnode&&e.vnode(o),o}function w(t){return t.children}function k(t,e){this.props=t,this.context=e}function y(t,e){if(null==e)return t.__?y(t.__,t.__i+1):null;for(var n;e<t.__k.length;e++)if(null!=(n=t.__k[e])&&null!=n.__e)return n.__e;return"function"==typeof t.type?y(t):null}function b(t){var e,n;if(null!=(t=t.__)&&null!=t.__c){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if(null!=(n=t.__k[e])&&null!=n.__e){t.__e=t.__c.base=n.__e;break}return b(t)}}function E(t){(!t.__d&&(t.__d=!0)&&i.push(t)&&!T.__r++||s!==e.debounceRendering)&&((s=e.debounceRendering)||r)(T)}function T(){for(var t,n,s,r,o,l,c,u=1;i.length;)i.length>u&&i.sort(a),t=i.shift(),u=i.length,t.__d&&(s=void 0,o=(r=(n=t).__v).__e,l=[],c=[],n.__P&&((s=m({},r)).__v=r.__v+1,e.vnode&&e.vnode(s),R(n.__P,s,r,n.__n,n.__P.namespaceURI,32&r.__u?[o]:null,l,null==o?y(r):o,!!(32&r.__u),c),s.__v=r.__v,s.__.__k[s.__i]=s,I(l,s,c),s.__e!=o&&b(s)));T.__r=0}function x(t,e,n,i,s,r,a,o,l,c,u){var f,p,m,_,g,v,w=i&&i.__k||d,k=e.length;for(l=S(n,e,w,l,k),f=0;f<k;f++)null!=(m=n.__k[f])&&(p=-1===m.__i?h:w[m.__i]||h,m.__i=f,v=R(t,m,p,s,r,a,o,l,c,u),_=m.__e,m.ref&&p.ref!=m.ref&&(p.ref&&D(p.ref,null,m),u.push(m.ref,m.__c||_,m)),null==g&&null!=_&&(g=_),4&m.__u||p.__k===m.__k?l=A(m,l,t):"function"==typeof m.type&&void 0!==v?l=v:_&&(l=_.nextSibling),m.__u&=-7);return n.__e=g,l}function S(t,e,n,i,s){var r,a,o,l,c,u=n.length,h=u,d=0;for(t.__k=new Array(s),r=0;r<s;r++)null!=(a=e[r])&&"boolean"!=typeof a&&"function"!=typeof a?(l=r+d,(a=t.__k[r]="string"==typeof a||"number"==typeof a||"bigint"==typeof a||a.constructor==String?v(null,a,null,null,null):p(a)?v(w,{children:a},null,null,null):void 0===a.constructor&&a.__b>0?v(a.type,a.props,a.key,a.ref?a.ref:null,a.__v):a).__=t,a.__b=t.__b+1,o=null,-1!==(c=a.__i=P(a,n,l,h))&&(h--,(o=n[c])&&(o.__u|=2)),null==o||null===o.__v?(-1==c&&(s>u?d--:s<u&&d++),"function"!=typeof a.type&&(a.__u|=4)):c!=l&&(c==l-1?d--:c==l+1?d++:(c>l?d--:d++,a.__u|=4))):t.__k[r]=null;if(h)for(r=0;r<u;r++)null!=(o=n[r])&&0==(2&o.__u)&&(o.__e==i&&(i=y(o)),N(o,o));return i}function A(t,e,n){var i,s;if("function"==typeof t.type){for(i=t.__k,s=0;i&&s<i.length;s++)i[s]&&(i[s].__=t,e=A(i[s],e,n));return e}t.__e!=e&&(e&&t.type&&!n.contains(e)&&(e=y(t)),n.insertBefore(t.__e,e||null),e=t.__e);do{e=e&&e.nextSibling}while(null!=e&&8==e.nodeType);return e}function P(t,e,n,i){var s,r,a=t.key,o=t.type,l=e[n];if(null===l&&null==t.key||l&&a==l.key&&o===l.type&&0==(2&l.__u))return n;if(i>(null!=l&&0==(2&l.__u)?1:0))for(s=n-1,r=n+1;s>=0||r<e.length;){if(s>=0){if((l=e[s])&&0==(2&l.__u)&&a==l.key&&o===l.type)return s;s--}if(r<e.length){if((l=e[r])&&0==(2&l.__u)&&a==l.key&&o===l.type)return r;r++}}return-1}function C(t,e,n){"-"==e[0]?t.setProperty(e,null==n?"":n):t[e]=null==n?"":"number"!=typeof n||f.test(e)?n:n+"px"}function U(t,e,n,i,s){var r;t:if("style"==e)if("string"==typeof n)t.style.cssText=n;else{if("string"==typeof i&&(t.style.cssText=i=""),i)for(e in i)n&&e in n||C(t.style,e,"");if(n)for(e in n)i&&n[e]===i[e]||C(t.style,e,n[e])}else if("o"==e[0]&&"n"==e[1])r=e!=(e=e.replace(o,"$1")),e=e.toLowerCase()in t||"onFocusOut"==e||"onFocusIn"==e?e.toLowerCase().slice(2):e.slice(2),t.l||(t.l={}),t.l[e+r]=n,n?i?n.t=i.t:(n.t=l,t.addEventListener(e,r?u:c,r)):t.removeEventListener(e,r?u:c,r);else{if("http://www.w3.org/2000/svg"==s)e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if("width"!=e&&"height"!=e&&"href"!=e&&"list"!=e&&"form"!=e&&"tabIndex"!=e&&"download"!=e&&"rowSpan"!=e&&"colSpan"!=e&&"role"!=e&&"popover"!=e&&e in t)try{t[e]=null==n?"":n;break t}catch(t){}"function"==typeof n||(null==n||!1===n&&"-"!=e[4]?t.removeAttribute(e):t.setAttribute(e,"popover"==e&&1==n?"":n))}}function L(t){return function(n){if(this.l){var i=this.l[n.type+t];if(null==n.u)n.u=l++;else if(n.u<i.t)return;return i(e.event?e.event(n):n)}}}function R(t,n,i,s,r,a,o,l,c,u){var h,d,f,g,v,y,b,E,T,S,A,P,C,U,L,R,I,D=n.type;if(void 0!==n.constructor)return null;128&i.__u&&(c=!!(32&i.__u),a=[l=n.__e=i.__e]),(h=e.__b)&&h(n);t:if("function"==typeof D)try{if(E=n.props,T="prototype"in D&&D.prototype.render,S=(h=D.contextType)&&s[h.__c],A=h?S?S.props.value:h.__:s,i.__c?b=(d=n.__c=i.__c).__=d.__E:(T?n.__c=d=new D(E,A):(n.__c=d=new k(E,A),d.constructor=D,d.render=O),S&&S.sub(d),d.props=E,d.state||(d.state={}),d.context=A,d.__n=s,f=d.__d=!0,d.__h=[],d._sb=[]),T&&null==d.__s&&(d.__s=d.state),T&&null!=D.getDerivedStateFromProps&&(d.__s==d.state&&(d.__s=m({},d.__s)),m(d.__s,D.getDerivedStateFromProps(E,d.__s))),g=d.props,v=d.state,d.__v=n,f)T&&null==D.getDerivedStateFromProps&&null!=d.componentWillMount&&d.componentWillMount(),T&&null!=d.componentDidMount&&d.__h.push(d.componentDidMount);else{if(T&&null==D.getDerivedStateFromProps&&E!==g&&null!=d.componentWillReceiveProps&&d.componentWillReceiveProps(E,A),!d.__e&&(null!=d.shouldComponentUpdate&&!1===d.shouldComponentUpdate(E,d.__s,A)||n.__v==i.__v)){for(n.__v!=i.__v&&(d.props=E,d.state=d.__s,d.__d=!1),n.__e=i.__e,n.__k=i.__k,n.__k.some((function(t){t&&(t.__=n)})),P=0;P<d._sb.length;P++)d.__h.push(d._sb[P]);d._sb=[],d.__h.length&&o.push(d);break t}null!=d.componentWillUpdate&&d.componentWillUpdate(E,d.__s,A),T&&null!=d.componentDidUpdate&&d.__h.push((function(){d.componentDidUpdate(g,v,y)}))}if(d.context=A,d.props=E,d.__P=t,d.__e=!1,C=e.__r,U=0,T){for(d.state=d.__s,d.__d=!1,C&&C(n),h=d.render(d.props,d.state,d.context),L=0;L<d._sb.length;L++)d.__h.push(d._sb[L]);d._sb=[]}else do{d.__d=!1,C&&C(n),h=d.render(d.props,d.state,d.context),d.state=d.__s}while(d.__d&&++U<25);d.state=d.__s,null!=d.getChildContext&&(s=m(m({},s),d.getChildContext())),T&&!f&&null!=d.getSnapshotBeforeUpdate&&(y=d.getSnapshotBeforeUpdate(g,v)),R=h,null!=h&&h.type===w&&null==h.key&&(R=M(h.props.children)),l=x(t,p(R)?R:[R],n,i,s,r,a,o,l,c,u),d.base=n.__e,n.__u&=-161,d.__h.length&&o.push(d),b&&(d.__E=d.__=null)}catch(t){if(n.__v=null,c||null!=a)if(t.then){for(n.__u|=c?160:128;l&&8==l.nodeType&&l.nextSibling;)l=l.nextSibling;a[a.indexOf(l)]=null,n.__e=l}else for(I=a.length;I--;)_(a[I]);else n.__e=i.__e,n.__k=i.__k;e.__e(t,n,i)}else null==a&&n.__v==i.__v?(n.__k=i.__k,n.__e=i.__e):l=n.__e=F(i.__e,n,i,s,r,a,o,c,u);return(h=e.diffed)&&h(n),128&n.__u?void 0:l}function I(t,n,i){for(var s=0;s<i.length;s++)D(i[s],i[++s],i[++s]);e.__c&&e.__c(n,t),t.some((function(n){try{t=n.__h,n.__h=[],t.some((function(t){t.call(n)}))}catch(t){e.__e(t,n.__v)}}))}function M(t){return"object"!=typeof t||null==t?t:p(t)?t.map(M):m({},t)}function F(n,i,s,r,a,o,l,c,u){var d,f,m,g,v,w,k,b=s.props,E=i.props,T=i.type;if("svg"==T?a="http://www.w3.org/2000/svg":"math"==T?a="http://www.w3.org/1998/Math/MathML":a||(a="http://www.w3.org/1999/xhtml"),null!=o)for(d=0;d<o.length;d++)if((v=o[d])&&"setAttribute"in v==!!T&&(T?v.localName==T:3==v.nodeType)){n=v,o[d]=null;break}if(null==n){if(null==T)return document.createTextNode(E);n=document.createElementNS(a,T,E.is&&E),c&&(e.__m&&e.__m(i,o),c=!1),o=null}if(null===T)b===E||c&&n.data===E||(n.data=E);else{if(o=o&&t.call(n.childNodes),b=s.props||h,!c&&null!=o)for(b={},d=0;d<n.attributes.length;d++)b[(v=n.attributes[d]).name]=v.value;for(d in b)if(v=b[d],"children"==d);else if("dangerouslySetInnerHTML"==d)m=v;else if(!(d in E)){if("value"==d&&"defaultValue"in E||"checked"==d&&"defaultChecked"in E)continue;U(n,d,null,v,a)}for(d in E)v=E[d],"children"==d?g=v:"dangerouslySetInnerHTML"==d?f=v:"value"==d?w=v:"checked"==d?k=v:c&&"function"!=typeof v||b[d]===v||U(n,d,v,b[d],a);if(f)c||m&&(f.__html===m.__html||f.__html===n.innerHTML)||(n.innerHTML=f.__html),i.__k=[];else if(m&&(n.innerHTML=""),x("template"===i.type?n.content:n,p(g)?g:[g],i,s,r,"foreignObject"==T?"http://www.w3.org/1999/xhtml":a,o,l,o?o[0]:s.__k&&y(s,0),c,u),null!=o)for(d=o.length;d--;)_(o[d]);c||(d="value","progress"==T&&null==w?n.removeAttribute("value"):void 0!==w&&(w!==n[d]||"progress"==T&&!w||"option"==T&&w!==b[d])&&U(n,d,w,b[d],a),d="checked",void 0!==k&&k!==n[d]&&U(n,d,k,b[d],a))}return n}function D(t,n,i){try{if("function"==typeof t){var s="function"==typeof t.__u;s&&t.__u(),s&&null==n||(t.__u=t(n))}else t.current=n}catch(t){e.__e(t,i)}}function N(t,n,i){var s,r;if(e.unmount&&e.unmount(t),(s=t.ref)&&(s.current&&s.current!==t.__e||D(s,null,n)),null!=(s=t.__c)){if(s.componentWillUnmount)try{s.componentWillUnmount()}catch(t){e.__e(t,n)}s.base=s.__P=null}if(s=t.__k)for(r=0;r<s.length;r++)s[r]&&N(s[r],n,i||"function"!=typeof t.type);i||_(t.__e),t.__c=t.__=t.__e=void 0}function O(t,e,n){return this.constructor(t,n)}function B(n,i,s){var r,a,o,l;i==document&&(i=document.documentElement),e.__&&e.__(n,i),a=(r="function"==typeof s)?null:s&&s.__k||i.__k,o=[],l=[],R(i,n=(!r&&s||i).__k=g(w,null,[n]),a||h,h,i.namespaceURI,!r&&s?[s]:a?null:i.firstChild?t.call(i.childNodes):null,o,!r&&s?s:a?a.__e:i.firstChild,r,l),I(o,n,l)}t=d.slice,e={__e:function(t,e,n,i){for(var s,r,a;e=e.__;)if((s=e.__c)&&!s.__)try{if((r=s.constructor)&&null!=r.getDerivedStateFromError&&(s.setState(r.getDerivedStateFromError(t)),a=s.__d),null!=s.componentDidCatch&&(s.componentDidCatch(t,i||{}),a=s.__d),a)return s.__E=s}catch(e){t=e}throw t}},n=0,k.prototype.setState=function(t,e){var n;n=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=m({},this.state),"function"==typeof t&&(t=t(m({},n),this.props)),t&&m(n,t),null!=t&&this.__v&&(e&&this._sb.push(e),E(this))},k.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),E(this))},k.prototype.render=w,i=[],r="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,a=function(t,e){return t.__v.__b-e.__v.__b},T.__r=0,o=/(PointerCapture)$|Capture$/i,l=0,c=L(!1),u=L(!0);const V=Symbol("Comlink.proxy"),H=Symbol("Comlink.endpoint"),X=Symbol("Comlink.releaseProxy"),W=Symbol("Comlink.finalizer"),Y=Symbol("Comlink.thrown"),G=t=>"object"==typeof t&&null!==t||"function"==typeof t,$=new Map([["proxy",{canHandle:t=>G(t)&&t[V],serialize(t){const{port1:e,port2:n}=new MessageChannel;return j(t,e),[n,[n]]},deserialize:t=>(t.start(),K(t))}],["throw",{canHandle:t=>G(t)&&Y in t,serialize({value:t}){let e;return e=t instanceof Error?{isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:{isError:!1,value:t},[e,[]]},deserialize(t){if(t.isError)throw Object.assign(new Error(t.value.message),t.value);throw t.value}}]]);function j(t,e=globalThis,n=["*"]){e.addEventListener("message",(function i(s){if(!s||!s.data)return;if(!function(t,e){for(const n of t){if(e===n||"*"===n)return!0;if(n instanceof RegExp&&n.test(e))return!0}return!1}(n,s.origin))return void console.warn(`Invalid origin '${s.origin}' for comlink proxy`);const{id:r,type:a,path:o}=Object.assign({path:[]},s.data),l=(s.data.argumentList||[]).map(rt);let c;try{const e=o.slice(0,-1).reduce(((t,e)=>t[e]),t),n=o.reduce(((t,e)=>t[e]),t);switch(a){case"GET":c=n;break;case"SET":e[o.slice(-1)[0]]=rt(s.data.value),c=!0;break;case"APPLY":c=n.apply(e,l);break;case"CONSTRUCT":c=it(new n(...l));break;case"ENDPOINT":{const{port1:e,port2:n}=new MessageChannel;j(t,n),c=function(t,e){return nt.set(t,e),t}(e,[e])}break;case"RELEASE":c=void 0;break;default:return}}catch(t){c={value:t,[Y]:0}}Promise.resolve(c).catch((t=>({value:t,[Y]:0}))).then((n=>{const[s,o]=st(n);e.postMessage(Object.assign(Object.assign({},s),{id:r}),o),"RELEASE"===a&&(e.removeEventListener("message",i),z(e),W in t&&"function"==typeof t[W]&&t[W]())})).catch((t=>{const[n,i]=st({value:new TypeError("Unserializable return value"),[Y]:0});e.postMessage(Object.assign(Object.assign({},n),{id:r}),i)}))})),e.start&&e.start()}function z(t){(function(t){return"MessagePort"===t.constructor.name})(t)&&t.close()}function K(t,e){const n=new Map;return t.addEventListener("message",(function(t){const{data:e}=t;if(!e||!e.id)return;const i=n.get(e.id);if(i)try{i(e)}finally{n.delete(e.id)}})),tt(t,n,[],e)}function q(t){if(t)throw new Error("Proxy has been released and is not useable")}function J(t){return at(t,new Map,{type:"RELEASE"}).then((()=>{z(t)}))}const Q=new WeakMap,Z="FinalizationRegistry"in globalThis&&new FinalizationRegistry((t=>{const e=(Q.get(t)||0)-1;Q.set(t,e),0===e&&J(t)}));function tt(t,e,n=[],i=function(){}){let s=!1;const r=new Proxy(i,{get(i,a){if(q(s),a===X)return()=>{!function(t){Z&&Z.unregister(t)}(r),J(t),e.clear(),s=!0};if("then"===a){if(0===n.length)return{then:()=>r};const i=at(t,e,{type:"GET",path:n.map((t=>t.toString()))}).then(rt);return i.then.bind(i)}return tt(t,e,[...n,a])},set(i,r,a){q(s);const[o,l]=st(a);return at(t,e,{type:"SET",path:[...n,r].map((t=>t.toString())),value:o},l).then(rt)},apply(i,r,a){q(s);const o=n[n.length-1];if(o===H)return at(t,e,{type:"ENDPOINT"}).then(rt);if("bind"===o)return tt(t,e,n.slice(0,-1));const[l,c]=et(a);return at(t,e,{type:"APPLY",path:n.map((t=>t.toString())),argumentList:l},c).then(rt)},construct(i,r){q(s);const[a,o]=et(r);return at(t,e,{type:"CONSTRUCT",path:n.map((t=>t.toString())),argumentList:a},o).then(rt)}});return function(t,e){const n=(Q.get(e)||0)+1;Q.set(e,n),Z&&Z.register(t,e,t)}(r,t),r}function et(t){const e=t.map(st);return[e.map((t=>t[0])),(n=e.map((t=>t[1])),Array.prototype.concat.apply([],n))];var n}const nt=new WeakMap;function it(t){return Object.assign(t,{[V]:!0})}function st(t){for(const[e,n]of $)if(n.canHandle(t)){const[i,s]=n.serialize(t);return[{type:"HANDLER",name:e,value:i},s]}return[{type:"RAW",value:t},nt.get(t)||[]]}function rt(t){switch(t.type){case"HANDLER":return $.get(t.name).deserialize(t.value);case"RAW":return t.value}}function at(t,e,n,i){return new Promise((s=>{const r=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");e.set(r,s),t.start&&t.start(),t.postMessage(Object.assign({id:r},n),i)}))}const ot=new Intl.NumberFormat("en-US",{maximumSignificantDigits:2});class lt{x;y;constructor(t,e){this.x=t,this.y=e}static fromObject(t){return new lt(t.x,t.y)}static distance(t,e){const n=t.x-e.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)}static lerp(t,e,n){const i=1-n;return new lt(i*t.x+n*e.x,i*t.y+n*e.y)}static equals(t,e,n){const i=t.x-e.x,s=t.y-e.y;return i*i+s*s<n*n}addPolar(t,e){this.x+=e*Math.cos(t),this.y+=e*Math.sin(t)}createTransferable(){return this}set(t){this.x=t.x,this.y=t.y}clone(){return new lt(this.x,this.y)}toString(){const t=ot.format;return`<${t(this.x)},${t(this.y)}>`}}const ct=()=>{};class ut{data;constructor(t){if(this.data=new Float32Array(9),t)for(let t=0;t<3;t++)this.data[4*t]=1}setEntry(t,e,n){this.data[t+3*e]=n}getEntry(t,e){return this.data[t+3*e]}multiply(t,e=new lt(0,0)){const n=this.data;return e.x=n[0]*t.x+n[3]*t.y+n[6],e.y=n[1]*t.x+n[4]*t.y+n[7],e}det(){const t=this.data;return t[3]*t[7]*t[2]+t[6]*t[1]*t[5]+t[0]*t[4]*t[8]-t[6]*t[4]*t[2]-t[0]*t[7]*t[5]-t[3]*t[1]*t[8]}static compose(t,e,n=new ut(!1)){for(let i=0;i<3;i++)for(let s=0;s<3;s++){let r=0;for(let n=0;n<3;n++)r+=t.data[i+3*n]*e.data[n+3*s];n.data[i+3*s]=r}return n}static inverse(t,e=new ut(!1)){const n=t.det();ct(0!==n);const i=1/n,s=t.data,r=e.data;return r[0]=i*(s[4]*s[8]-s[7]*s[5]),r[1]=i*(s[7]*s[2]-s[1]*s[8]),r[2]=i*(s[1]*s[5]-s[4]*s[2]),r[3]=i*(s[6]*s[5]-s[3]*s[8]),r[4]=i*(s[0]*s[8]-s[6]*s[2]),r[5]=i*(s[3]*s[2]-s[0]*s[5]),r[6]=i*(s[3]*s[7]-s[6]*s[4]),r[7]=i*(s[6]*s[1]-s[0]*s[7]),r[8]=i*(s[0]*s[4]-s[3]*s[1]),e}}class ht{minX;maxX;minY;maxY;constructor(t,e,n,i){this.minX=t,this.maxX=e,this.minY=n,this.maxY=i}static fromTransferable(t){return new ht(t.minX,t.maxX,t.minY,t.maxY)}static createAt(t,e,n){const i=.5*e,s=.5*n;return new ht(t.x-i,t.x+i,t.y-s,t.y+s)}static distance2(t,e){let n=0,i=0;return t.maxX<e.minX?n=e.minX-t.maxX:e.maxX<t.minX&&(n=t.minX-e.maxX),t.maxY<e.minY?i=e.minY-t.maxY:e.maxY<t.minY&&(i=t.minY-e.maxY),n*n+i*i}get width(){return this.maxX-this.minX}get height(){return this.maxY-this.minY}createTransferable(t=0){return{minX:this.minX-t,maxX:this.maxX+t,minY:this.minY-t,maxY:this.maxY+t}}extendTo(t,e=Number.EPSILON){return new ht(Math.min(this.minX,t.x-e),Math.max(this.maxX,t.x+e),Math.min(this.minY,t.y-e),Math.max(this.maxY,t.y+e))}contains(t){const e=this.minX<=t.x&&t.x<this.maxX,n=this.minY<=t.y&&t.y<this.maxY;return e&&n}}const dt=.042,ft=new ut(!0);ft.setEntry(0,0,dt),ft.setEntry(1,1,dt);class pt{#t=new lt(0,0);#e=new ut(!0);#n=new ut(!0);#i=null;setRatio(t,e){this.#e.setEntry(0,0,e/t)}moveToSnake(t){this.moveTo(t.position)}moveTo(t){this.#t.set(t),this.#i=null}computeScreenCoordinates(t,e){const n=e.clientWidth,i=e.clientHeight,s=this.transformMatrix.multiply(t);return s.y*=-1,s.x+=1,s.x=.5*n*s.x,s.y+=1,s.y=.5*i*s.y,s}get position(){return this.#t}get transformMatrix(){if(null===this.#i){const t=this.#t;this.#n.setEntry(0,2,-t.x),this.#n.setEntry(1,2,-t.y),this.#i=ut.compose(ut.compose(this.#e,ft),this.#n)}return this.#i}get viewBox(){const t=this.#t,e=2/(this.#e.getEntry(0,0)*dt),n=2/dt;return new ht(t.x-.5*e,t.x+.5*e,t.y-.5*n,t.y+.5*n)}}let mt=0;function _t(){return mt}function gt(t=performance.now()){0!==t&&ct(t>=mt,`Time cannot go backwards (${t} < ${mt})`),mt=t}function vt(t){if(!Number.isFinite(t))return 0;for(;Math.abs(t)>Math.PI;)t-=2*Math.sign(t)*Math.PI;return t}const wt=2*Math.PI;function kt(t,e){const n=e-t,i=n-Math.sign(n)*wt;return Math.abs(i)<Math.abs(n)?i:n}function yt(t,e,n){return Math.max(t,Math.min(e,n))}const bt=65535;class Et{id;skin;headChunk=null;#s;#r=[];#a=new Set;#o;#l;#c;#u;#h;#d;#f;#p;#m=!1;#_;#g;#v;#w;#k;constructor(t,e){this.id=t.id,this.skin=t.skin,this.#s=e,this.#l=_t(),this.#g=lt.fromObject(t.headPosition),this.#w=t.headDirection[0],this.#d=t.fast?1:0,this.update(t,0)}update(t,e){this.#o=_t(),this.#u=t.length,this.#c=t.headChunkId,this.#_=lt.fromObject(t.headPosition),this.#v=t.headDirection[0],this.#k=t.headDirection[1],this.#h=t.fast,this.#f=t.width,t.name&&(this.#p=t.name),this.#m&&(this.#g=lt.fromObject(t.headPosition),this.#w=t.headDirection[0],this.#l=_t(),this.#m=!1),this.#y(e,t.fastHistory)}predict(){this.#b(),this.#E();for(const t of this.#r)t.predict();this.headChunk&&this.headChunk.connectMeshToHead(),this.#T(),this.#l=_t()}registerSnakeChunk(t){if(this.#a.has(t.id))return;if(this.#a.add(t.id),t.id===this.#c)return this.#r.push(t),null!==this.headChunk&&this.headChunk.resetMesh(),void(this.headChunk=t);if(0===this.#r.length)return void this.#r.push(t);const e=bt-(this.#c&bt),n=Tt(t,e);let i=this.#r.length-1;for(;0<=i&&!(Tt(this.#r[i],e)<n);i--);this.#r.splice(i+1,0,t)}unregisterSnakeChunk(t){const e=this.#r.findIndex((e=>e===t));if(e<0)throw new Error(`Cannot unregister: Snake ${this.id} has no chunk with id ${t.id}.`);this.#a.delete(t.id),this.#r.splice(e,1)}getSnakeChunksIterator(){return this.#r.values()}hasChunks(){return this.#r.length>0}toString(){return`Snake ${this.id} with ${this.#r.length} chunks`}couldBeVisible(t,e=0){for(const n of this.#r)if(n.couldBeVisible(t,e))return!0;return this.isHeadVisible(t,e)}isHeadVisible(t,e=0){const n=5*this.#f,i=ht.createAt(this.#g,n,n);return ht.distance2(i,t.viewBox)<=e*e}destroy(){}pause(){this.#m=!0}get name(){return this.#p}get fast(){return this.#h}get smoothedFastValue(){return this.#d}get length(){return this.#u}get speed(){if(this.#m)return 0;const t=this.#s;return(this.#h?t.snakes.fastSpeed:t.snakes.speed)/t.tickDuration}get position(){return this.#g}get direction(){return this.#w}get width(){return this.#f}#b(){const t=this.speed,e=_t(),n=t*(e-this.#l)/1e3,i=t*(e-this.#o)/1e3;this.#g.addPolar(this.#w,n);const s=this.#_.clone();s.addPolar(this.#w,i),this.#g=lt.lerp(this.#g,s,.15)}#E(){const t=_t(),e=this.#s.snakes.maxTurnDelta/this.#s.tickDuration,n=kt(this.#w,this.#k),i=kt(this.#v,this.#k),s=e*(t-this.#l)/1e3,r=e*(t-this.#o)/1e3,a=vt(this.#w+yt(-s,n,s)),o=vt(this.#v+yt(-r,i,r));this.#w=vt(a+.15*kt(a,o))}#T(){const t=(_t()-this.#l)/1e3,e=this.fast?1:0,n=yt(0,5*t,1);this.#d=n*e+(1-n)*this.#d}#y(t,e){if(0===t)return;const n=this.#s.snakes.fastSpeed,i=this.#s.snakes.speed;let s=0;const r=Math.min(t,e.length);for(let t=0;t<r;t++)s+=e[t]?n:i;for(let e=r;e<t;e++)s+=i;for(const t of this.#r)t.id!==this.#c&&t.updateOffset(s)}}function Tt(t,e){return(t.id&bt)+e&bt}class xt{snake;id;gpuData;#x=!1;#S;#A=_t();#o;#u;#P;#l=_t();#C;#U;constructor(t,e){this.snake=t,this.id=e.id,t.registerSnakeChunk(this),this.update(e),this.#U=e.offset}update(t){if(this.#x=t.full,this.#S=ht.fromTransferable(t.boundingBox),this.gpuData={buffer:t.data,vertices:t.vertices},this.#C=t.offset,0===this.#C){const e=t.length-this.#u;this.#U-=e}this.#u=t.length,this.#P=_t(),this.#o=_t()}updateOffset(t){this.#C+=t,this.#P=_t()}predict(){const t=this.snake.speed,e=_t(),n=t*(e-this.#l)/1e3,i=t*(e-this.#P)/1e3,s=this.#U+n,r=this.#C+i;this.#U=.85*s+.15*r,this.#l=_t()}connectMeshToHead(){const t=this.snake.position,e=this.gpuData.buffer;let n=6*(this.gpuData.vertices-2);e[n+0]=t.x,e[n+1]=t.y,e[n+5]=-this.#U,n+=6,e[n+0]=t.x,e[n+1]=t.y,e[n+5]=-this.#U}resetMesh(){const t=this.gpuData.buffer;let e=6*(this.gpuData.vertices-2),n=e-12;t[e+0]=t[n+0],t[e+1]=t[n+1],t[e+5]=t[n+5],e+=6,n+=6,t[e+0]=t[n+0],t[e+1]=t[n+1],t[e+5]=t[n+5]}couldBeVisible(t,e=0){const n=ht.distance2(t.viewBox,this.#S),i=.5*this.snake.width+e;return n<=i*i}destroy(){this.snake.unregisterSnakeChunk(this)}toString(){return`SnakeChunk ${this.id} of snake ${this.snake.id}`}get offset(){return this.#U}get boundingBox(){return this.#S}get junk(){return this.#C>=this.snake.length}get final(){return this.#x}get shortId(){return 65535&this.id}get clientAge(){return.001*(_t()-this.#A)}get debugInfo(){throw new Error}}class St{listeners=new Set;_deviceName;constructor(t){this._deviceName=t}addListener(t){this.listeners.add(t)}set(t){this.notifyListeners(t)}notifyListeners(t){this.listeners.forEach((e=>e(t)))}getDeviceName(){return this._deviceName}}const At=new Set,Pt=new class{id;defaultValue;label;#L;#R=!1;#I=[];constructor(t,e,n){this.id=t,this.defaultValue=e,this.label=n;try{const t=window.localStorage.getItem(this.#M);null!==t&&(this.#L=JSON.parse(t),this.#R=!0)}catch(t){console.warn("Failed to load value from local storage.")}}setValue(t){const e=this.#F;this.#R&&e===t||(this.#L=t,this.#R=!0,this.#D(),this.#N(t))}resetValue(){if(!this.#R)return;const t=this.#L;this.#L=null,this.#R=!1,this.#D(),t!==this.defaultValue&&this.#N(this.defaultValue)}subscribe(t){this.#I.push(t),t(this.#F)}get#F(){return this.#R?this.#L:this.defaultValue}#N(t){this.#I.forEach((e=>e(t)))}get#M(){return"settings."+this.id}#D(){const t=this.#M;this.#R?window.localStorage.setItem(t,JSON.stringify(this.#F)):window.localStorage.removeItem(t)}static resetForTests(){At.clear()}}("input.pointerLock",!1,"Lock pointer");class Ct extends St{clickCatcher=null;lockPointer=!1;constructor(t){super("pointer"),this.pointerDownHandler=this.pointerDownHandler.bind(this),this.pointerUpHandler=this.pointerUpHandler.bind(this),window.addEventListener("pointermove",(e=>{if(null!==this.clickCatcher&&document.pointerLockElement===this.clickCatcher){const n=t().direction;let i=2*Math.cos(n),s=2*Math.sin(n);i+=.01*e.movementX,s-=.01*e.movementY,0===i&&0===s||this.set({direction:Math.atan2(s,i)})}else{const t=e.pageX-.5*window.innerWidth,n=.5*window.innerHeight-e.pageY;if(t*t+n*n>1){const e=Math.atan2(n,t);this.set({direction:e})}}})),Pt.subscribe((t=>this.lockPointer=t))}pointerDownHandler(t){t.stopPropagation(),this.lockPointer&&document.pointerLockElement!==this.clickCatcher&&this.clickCatcher?.requestPointerLock(),this.set({wantsFast:!0})}pointerUpHandler(t){t.stopPropagation(),this.set({wantsFast:!1})}setClickCatcher(t){ct(null!==t),null!==this.clickCatcher&&(this.clickCatcher.removeEventListener("pointerdown",this.pointerDownHandler),this.clickCatcher.removeEventListener("pointerup",this.pointerUpHandler),this.clickCatcher.removeEventListener("pointercancel",this.pointerUpHandler)),t.addEventListener("pointerdown",this.pointerDownHandler),t.addEventListener("pointerup",this.pointerUpHandler),t.addEventListener("pointercancel",this.pointerUpHandler),this.clickCatcher=t}}class Ut extends St{pressed=new Set;keyMappings=new Map;trackedKeys=new Set;stateProvider;previousTickAnyPressed=!1;lastTick=_t();constructor(t){super("keyboard"),this.stateProvider=t,this.addMappings("left",["a","ArrowLeft"]),this.addMappings("right",["d","ArrowRight"]),this.addMappings("fast",["w","ArrowUp","Shift"," "]),window.addEventListener("keydown",(t=>{this.pressed.add(t.key.toLowerCase())})),window.addEventListener("keyup",(t=>{this.pressed.delete(t.key.toLowerCase())})),window.addEventListener("blur",(()=>{this.pressed.clear()}))}addMappings(t,e){const n=this.keyMappings.get(t)??new Set;e.forEach((t=>{const e=t.toLowerCase();n.add(e),this.trackedKeys.add(e)})),this.keyMappings.set(t,n)}tick(){const t=2.5*(_t()-this.lastTick)/1e3;this.lastTick=_t();const e=this.anyPressed();if(!e&&!this.previousTickAnyPressed)return;this.previousTickAnyPressed=e;const n=this.isPressed("fast"),i=this.stateProvider().direction;let s=0;this.isPressed("left")&&(s+=t),this.isPressed("right")&&(s-=t),this.set({wantsFast:n,direction:i+s})}isPressed(t){const e=this.keyMappings.get(t);if(void 0===e)return!1;for(const t of e)if(this.pressed.has(t.toLowerCase()))return!0;return!1}anyPressed(){for(const t of this.pressed)if(this.trackedKeys.has(t))return!0;return!1}}const Lt=new Set,Rt=new Set,It=[];let Mt,Ft=!1,Dt=0;function Nt(t){Lt.add(t)}function Ot(t){var e;t instanceof Ut&&It.push(t),t.addListener((e=t,t=>{const n=void 0!==t.direction?vt(t.direction):Dt,i=t.wantsFast??Ft;if(Ft===i&&Dt===n)return;Dt=n,Ft=i,Lt.forEach((t=>t(i,n)));const s=e.getDeviceName();Mt!==s&&(Mt=s,Rt.forEach((t=>t(s))))}))}class Bt{snakeId;#O;#B;#V=!0;#H;constructor(t,e,n){this.snakeId=e,this.#O=t,this.#B=n,this.#H=(t,e)=>{this.alive&&this.#O.sendUserInput(e,t,this.#B.camera.viewBox)},Nt(this.#H),n.events.snakeDeath.addListener((({deadSnakeId:t})=>{var e;t===this.snakeId&&(this.#V=!1,e=this.#H,Lt.delete(e))}))}get alive(){return this.#V}}class Vt{id;box;#X;#W;#o;#A;constructor(t){this.id=t.id,this.box=ht.fromTransferable(t.bounds),this.#A=_t(),this.update(t)}get length(){return this.#W}get timeSinceLastUpdate(){return.001*(_t()-this.#o)}get age(){return.001*(_t()-this.#A)}update(t){this.#W=t.count,this.#X=t.vertexBuffer,this.#o=_t()}destroy(){}isVisible(t,e=0){return ht.distance2(this.box,t.viewBox)<=e*e}moveVertexData(t){if(void 0===this.#X)return;const e=this.#X;this.#X=void 0,t(e)}}class Ht{#I=new Set;#Y=!1;addListener(t){this.#Y||this.#I.add(t)}trigger(t){this.#I.forEach((e=>e(t)))}done(){this.#I.clear(),this.#Y=!0}}const Xt=new Map;class Wt{#G=null;#$=0;#j=0;#z=Promise.resolve();#K=new Ht;constructor(t){this.#G=t??null}loadJSON(t,e){return this.#q(t,(async t=>{e=e??jt;const n=await t.json();if(e(n))return n;throw new Error("Invalid JSON data.")}))}loadImage(t,e,n){return void 0!==e&&void 0===n&&(n=e),this.#q(t,(async t=>{const i=await t.blob(),s=URL.createObjectURL(i),r=new Image(e,n);return await new Promise(((t,e)=>{r.onload=t,r.onerror=e,r.src=s})),URL.revokeObjectURL(s),r}))}loadBlob(t){return this.#q(t,(t=>t.blob()))}get progress(){return 0===this.#$?0:this.#j/this.#$}async waitForCompletion(){if(0===this.#$){if(await $t(),0===this.#$)throw console.error(this),new Error("Loading failed.");return await this.waitForCompletion()}for(;this.#j<this.#$;)await this.#z,await $t();this.#K.done()}addChangeListener(t){this.#K.addListener(t)}#J(){return null===this.#G?Promise.resolve():this.#G.waitForCompletion()}#q(t,e){const n=(async()=>{await this.#J(),this.#$++;const n=await async function(t){let e=Xt.get(t);void 0===e&&(e=fetch(t+"?v="+encodeURIComponent("0.15.0"),{method:"GET",cache:"force-cache"}),Xt.set(t,e));const n=await e;if(!n.ok)throw new Error(`Failed to load (status ${n.status}): ${t}`);return n}(t),i=await e(n);return this.#j++,i})();return this.#z=Promise.all([this.#z,n]).then((()=>{})),n.then((()=>$t())).then((()=>this.#K.trigger(this.progress))),n}}const Yt=new Wt,Gt=new Wt;function $t(){return new Promise((t=>window.setTimeout(t,0)))}function jt(t){return!0}const zt=(async()=>{const t=await Gt.loadBlob("worker.bundle.js");return URL.createObjectURL(t)})();class Kt{#Q=new Map;#Z;constructor(t){this.#Z=t}add(t,e){const n=this.#Q.get(t.id);if(n)n.update(t,e);else{const e=this.#Z(t);ct(t.id===e.id),this.#Q.set(t.id,e)}}addMultiple(t,e){for(const n of t)this.add(n,e)}get(t){return this.#Q.get(t)}has(t){return this.#Q.has(t)}runIfPresent(t,e){const n=this.#Q.get(t);return n&&e(n),void 0!==n}remove(t){const e=this.#Q.get(t);return e&&(this.#Q.delete(t),e.destroy&&e.destroy()),e}removeIf(t){const e=[];for(const n of this.#Q.values())t(n)&&e.push(n);for(const t of e)t.destroy&&t.destroy(),this.#Q.delete(t.id);return e}forEach(t){this.#Q.forEach(t)}values(){return this.#Q.values()}entries(){return this.#Q.entries()}clear(){this.#Q.clear()}get size(){return this.#Q.size}}var qt=0;function Jt(t,n,i,s,r,a){n||(n={});var o,l,c=n;if("ref"in c)for(l in c={},n)"ref"==l?o=n[l]:c[l]=n[l];var u={type:t,props:c,key:i,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--qt,__i:-1,__u:0,__source:r,__self:a};if("function"==typeof t&&(o=t.defaultProps))for(l in o)void 0===c[l]&&(c[l]=o[l]);return e.vnode&&e.vnode(u),u}Array.isArray;class Qt extends k{render(){const t=this.props.options,e=t.buttons??[];return Jt("div",{class:"dialog-container",children:[Jt("div",{class:"dialog-shadow"}),Jt("div",{class:"dialog-modal",children:[t.title?Jt("div",{class:"dialog-title",children:t.title}):null,Jt("div",{class:"dialog-content",children:t.content}),Jt("div",{class:"dialog-buttons",children:e.map((t=>Jt("button",{onClick:()=>{const e=t.action?t.action():t.value;void 0!==e&&this.props.onExit(e)},children:t.label},t.label)))})]})]})}}const Zt=[],te=document.createElement("div");let ee=null;function ne(t){return new Promise((e=>{Zt.push({options:{buttons:[{label:"Ok",value:"ok"}],...t},onExit:t=>{ee=null,e(t),ie()}}),ie()}))}function ie(){if(null!==ee)return;const t=Zt.shift();B(null,te),t?(ee=t,B(g(Qt,t),te),te.classList.add("show")):te.classList.remove("show")}class se{snakes;snakeChunks;foodChunks;events={snakeDeath:new Ht,gameEnd:new Ht};camera=new pt;statistics={leaderboard:[],numPlayers:0,numBots:0};heatMap;#O;#tt;#et=!1;#nt;#it=0;#st=!1;constructor(t){this.#O=t,this.snakes=new Kt((t=>new Et(t,this.#tt))),this.snakeChunks=new Kt((t=>{const e=this.snakes.get(t.snakeId);if(void 0===e)throw new Error(`SnakeChunk for unknown snake ${t.snakeId}.`);return new xt(e,t)})),this.foodChunks=new Kt((t=>new Vt(t))),this.events.snakeDeath.addListener((({deadSnakeId:t,killer:e})=>{t!==this.#nt?e&&e.snakeId===this.#nt&&this.#it++:this.#nt=void 0}))}static async joinAsPlayer(){const t=await async function(){const t=await zt;return K(new Worker(t,{name:"SnakeWorker"}))}(),e=new se(t),n=await t.init("wss://serpent.ringofsnakes.io:443/game").catch((async t=>(await ne({title:"Error",content:"Failed to connect to the game server."}),Promise.reject(t))));e.#tt=n.config,e.camera.moveTo(lt.fromObject(n.startPosition)),e.#nt=n.targetSnakeId,e.heatMap=new Uint8Array(n.config.chunks.rows*n.config.chunks.columns),t.addEventListener("serverUpdate",it((()=>{e.#et=!0}))),t.addEventListener("disconnect",it((()=>{e.#st=!0,e.events.gameEnd.trigger({reason:"disconnect"})}))),t.onSpectatorChange(it((t=>{const n=t;n.followSnake?e.#nt=n.targetSnakeId:(e.#nt=void 0,e.camera.moveTo(lt.fromObject(n.position)))})));const i=new Bt(t,n.targetSnakeId,e);return[e,i]}static joinAsSpectator(){throw new Error("not implemented")}async update(){if(!this.#et)return;const t=await this.#O.getDataChanges();this.#et=t.moreUpdates;const e=t.ticksSinceLastUpdate;t.leaderboard&&(this.statistics=t.leaderboard),t.heatMap&&(this.heatMap=t.heatMap),this.foodChunks.addMultiple(t.foodChunks),this.snakes.addMultiple(t.snakes,e),this.snakeChunks.addMultiple(t.snakeChunks);for(const{deadSnakeId:e,killer:n}of t.snakeDeaths){const t=this.snakes.get(e);if(this.events.snakeDeath.trigger({deadSnakeId:e,killer:n,snake:t}),!t)continue;const i=Array.from(t.getSnakeChunksIterator());for(const t of i)this.snakeChunks.remove(t.id);this.snakes.remove(e)}const n=new Set(t.snakes.map((t=>t.id)));n.size>0&&this.snakes.forEach((t=>{n.has(t.id)||t.pause()})),t.moreUpdates?await this.update():this.#rt()}predict(){if(!this.#st){for(const t of this.snakes.values())t.predict();this.targetSnake&&this.camera.moveToSnake(this.targetSnake)}}quit(){this.#O.quit(),this.#st=!0}get config(){return this.#tt}get targetSnake(){if(void 0!==this.#nt)return this.snakes.get(this.#nt)}get targetSnakeKills(){return this.#it}#rt(){const t=this.camera,e=2*this.#tt.snakes.fastSpeed;this.snakeChunks.removeIf((n=>n.junk||!n.couldBeVisible(t,e)&&n.clientAge>1)),this.foodChunks.removeIf((n=>!n.isVisible(t,e)&&n.timeSinceLastUpdate>1)),this.snakes.removeIf((n=>n.id!==this.#nt&&!n.hasChunks()&&!n.couldBeVisible(t,e)))}}class re extends k{#at={current:null};#ot;#lt;#ct=0;#ut=0;#ht;#dt;#ft;constructor(t){super(t),this.#ft=t.maxFPS??60}componentDidMount(){const t=this.#at.current.getContext("2d",{alpha:!1});this.#ot=t,this.#ht=performance.now(),this.#dt=this.#ht,t.fillStyle="black",t.fillRect(0,0,t.canvas.width,t.canvas.height),this.#lt=window.requestAnimationFrame(this.#pt.bind(this))}#pt(){const t=performance.now(),e=t-this.#ht,n=t-this.#dt,i=1e3/3;if(e>=i&&(this.#mt(),this.#ht=t-(e-i),this.#ct=0),n>=1e3){const e=this.#ut;this.#ut=0,this.#dt=t-(n-1e3),this.setState({fps:e})}this.#ct++,this.#ut++,this.#lt=window.requestAnimationFrame(this.#pt.bind(this))}#mt(){const t=this.#ot,e=t.canvas,n=3*this.#ct;if(n>this.#ft){const i=Math.round(e.height*this.#ft/n);t.drawImage(e,0,e.height-i,e.width,i),t.fillStyle="black",t.fillRect(0,0,e.width,e.height-i),this.#ft=n}const i=e.width-2;t.drawImage(e,2,0,i,e.height,0,0,i,e.height),t.fillStyle="black",t.fillRect(e.width-2,e.height,2,e.height);const s=Math.floor(e.height*n/this.#ft);t.fillStyle="white",t.fillRect(e.width-2,e.height-s,2,s)}componentWillUnmount(){window.cancelAnimationFrame(this.#lt)}render(){return Jt("div",{id:"fps-stats",children:[Jt("canvas",{ref:this.#at,width:100,height:42}),Jt("div",{id:"fps-text",children:`FPS: ${this.state.fps??"-"}`})]})}}class ae extends k{render(){const t=this.props.data;if(!t||0===t.leaderboard.length)return null;const e=this.props.targetId;return Jt("div",{id:"game-stats",children:[Jt("div",{id:"leaderboard",class:t.leaderboard.length>1?"multiple":"",children:t.leaderboard.map(((t,n)=>Jt(oe,{data:t,index:n,isTarget:t.id===e},t.name)))}),Jt("div",{id:"player-numbers",children:[Jt("div",{children:"Players"}),Jt("div",{children:t.numPlayers}),Jt("div",{children:"Bots"}),Jt("div",{children:t.numBots})]})]})}}function oe(t){const e=t.data,n=t.index,i=t.isTarget?"target":"";return Jt(w,{children:[Jt("span",{class:i,children:[n+1,"."]}),Jt("span",{class:i,children:e.name}),Jt("span",{class:i,title:"length",children:e.length}),Jt("span",{class:i,title:"kills",children:0===e.kills?"-":e.kills+"K"})]})}class le extends k{render(){const t=this.props.snake;if(!t)return null;const e=this.props.kills??0;return Jt("div",{id:"snake-info",children:[Jt("div",{id:"snake-name",children:t.name}),Jt("div",{id:"snake-data",children:[Jt("span",{class:"label",children:"Length:"}),Jt("span",{class:"value",children:Math.round(t.length)}),e>0?Jt(w,{children:[Jt("span",{class:"label",children:"Kills:"}),Jt("span",{class:"value",children:e})]}):null]})]})}}class ce extends k{#_t;componentDidMount(){this.#_t=window.setInterval((()=>{this.forceUpdate()}),500)}componentWillUnmount(){window.clearInterval(this.#_t)}render(){const t=this.props.game;return Jt(w,{children:[Jt(ae,{data:t.statistics,targetId:t.targetSnake?.id}),Jt(re,{}),Jt(le,{snake:t.targetSnake,kills:t.targetSnakeKills})]})}}class ue{#gt=!1;#vt=void 0;#wt=void 0;set(){if(this.#gt=!0,this.#wt){const t=this.#wt;this.#wt=void 0,this.#vt=void 0,t()}}clear(){this.#gt=!1}isSet(){return this.#gt}wait(t=0){return this.#gt?Promise.resolve():(void 0===this.#vt&&(this.#vt=new Promise((t=>this.#wt=t))),t>0?Promise.race([this.#vt,new Promise(((e,n)=>{window.setTimeout(n,t)}))]):this.#vt)}}function he(t,e){if(null==t)throw new Error(e??"Value is "+t);return t}const de={alpha:!0,depth:!1,antialias:!0,preserveDrawingBuffer:!1,premultipliedAlpha:!1,powerPreference:"high-performance"},fe=new ue;let pe=null;function me(){if(!pe)throw new Error("No WebGL context available");return pe}async function _e(){return fe.isSet()||await fe.wait(),me()}function ge(t){return Jt(w,{children:t.texts.map((t=>{let e=`top:${t.y}px;left:${t.x}px;color:${t.color};`;return t.minWidth&&(e+=`min-width:${t.minWidth};`),t.color&&(e+=`color:${t.color};`),Jt("div",{class:t.debug?"text debug":"text",style:e,children:t.text},t.key)}))})}let ve=null;const we=[];function ke(t,e,n){we.push({text:t,key:e,size:12,...n})}const ye=[{snakeBody:[128,191,255],food:[0,128,255]},{snakeBody:[255,184,114],food:[255,134,14]},{snakeBody:[191,255,128],food:[25,255,42]},{snakeBody:[250,255,80],food:[255,255,22]},{snakeBody:[230,67,197],food:[255,0,255]},{snakeBody:[255,81,55],food:[255,25,12]},{snakeBody:[112,111,110],food:[128,182,222]}];function be(){return ye}const Ee=new Map;function Te(t,e,n){ct(t>=0);const i=me(),s=he(i.createTexture(),`Failed to create texture ${t}.`);if(Ee.set(t,s),i.activeTexture(WebGL2RenderingContext.TEXTURE0+t),i.bindTexture(i.TEXTURE_2D,s),void 0!==e.wrap&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,e.wrap),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,e.wrap)),void 0!==e.minFilter&&i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,e.minFilter),void 0!==e.magFilter&&i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,e.magFilter),void 0!==e.anisotropy){const t=he(i.getExtension("EXT_texture_filter_anisotropic"),"No anisotropic filtering");i.texParameterf(i.TEXTURE_2D,t.TEXTURE_MAX_ANISOTROPY_EXT,e.anisotropy)}return n&&n(i,s,t),s}const xe=(()=>{const t=be(),e=new Uint8Array(8*t.length);return t.forEach(((t,n)=>{const i=4*n,s=e.length/2+i;e[i]=t.snakeBody[0],e[i+1]=t.snakeBody[1],e[i+2]=t.snakeBody[2],e[i+3]=255,e[s]=t.food[0],e[s+1]=t.food[1],e[s+2]=t.food[2],e[s+3]=255})),e})();function Se(t,e,n){t.setUniform(e,function(t){return t%be().length}(n))}const Ae=WebGL2RenderingContext;class Pe{static#kt=new Map([[Ae.FLOAT,1],[Ae.FLOAT_VEC2,2],[Ae.FLOAT_VEC3,3],[Ae.FLOAT_VEC4,4],[Ae.FLOAT_MAT3,9],[Ae.FLOAT_MAT4,16],[Ae.INT,1],[Ae.SAMPLER_2D,1]]);name;type;location;components;constructor(t,e){if(this.name=t.name,this.type=t.type,!Pe.#kt.has(t.type))throw new Error(`Type ${t.type} not implemented.`);this.components=Pe.#kt.get(t.type)*t.size,this.location=e}}class Ce extends Pe{static#yt=new Map([[Ae.FLOAT,Ae.prototype.uniform1f],[Ae.SAMPLER_2D,Ae.prototype.uniform1i],[Ae.FLOAT_VEC2,Ae.prototype.uniform2fv],[Ae.FLOAT_VEC3,Ae.prototype.uniform3fv],[Ae.FLOAT_VEC4,Ae.prototype.uniform4fv],[Ae.INT,Ae.prototype.uniform1i],[Ae.UNSIGNED_INT,Ae.prototype.uniform1ui]]);#bt;constructor(t,e,n){if(super(e,n),e.type===t.FLOAT_MAT3)this.#bt=e=>t.uniformMatrix3fv(n,!1,e);else if(e.type===t.FLOAT_MAT4)this.#bt=e=>t.uniformMatrix4fv(n,!1,e);else{const i=Ce.#yt.get(e.type);if(void 0===i)throw new Error(`Uniform type ${e.type} (${e.name}) not implemented.`);this.#bt=e=>i.call(t,n,e)}}apply(t){this.#bt(t)}}class Ue extends Pe{byteSize;value=null;constructor(t,e){if(super(t,e),t.type===WebGL2RenderingContext.SAMPLER_2D)throw new Error;this.byteSize=4*this.components}}const Le=WebGL2RenderingContext;class Re{#Et;#Tt;#xt=new Map;#St=new Map;#At=0;#Pt=null;#Ct;#Ut=[Le.SRC_ALPHA,Le.ONE_MINUS_SRC_ALPHA];#Lt=!1;#Rt=!1;constructor(t,e,n,i){this.#Et=t,this.#Tt=function(t,e,n){function i(t,e,n){const i=t.createShader(e);if(t.shaderSource(i,n),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS))throw new Error("Shader compile error "+t.getShaderInfoLog(i));return i}const s=i(t,t.VERTEX_SHADER,e),r=i(t,t.FRAGMENT_SHADER,n),a=he(t.createProgram());if(t.attachShader(a,s),t.attachShader(a,r),t.linkProgram(a),!t.getProgramParameter(a,t.LINK_STATUS))throw new Error("Shader linking failed: "+t.getProgramInfoLog(a));return a}(t,e,n),this.#It(i),this.#At=this.computeAttributeStride(this.#Ct),this.#Mt()}use(t){const e=this.#Et;e.useProgram(this.#Tt),e.blendFunc(...this.#Ut),e.bindVertexArray(this.#Pt),this.#Lt=!0,t(e),this.#Lt=!1,e.bindVertexArray(null)}run(t,e){ct(this.#Lt);const n=this.#Et;ct(this.#Rt===(void 0!==e?.instances));const{mode:i,start:s}={mode:this.#Et.TRIANGLES,start:0,...e};null===this.#Pt&&this.#Ft(this.#Ct,this.#At),this.#Rt?n.drawArraysInstanced(i,s,t,e.instances):n.drawArrays(i,s,t)}setFixedBuffer(t,e){ct(null===this.#Pt);const n=this.#Et;n.useProgram(this.#Tt),this.#Pt=he(n.createVertexArray()),n.bindVertexArray(this.#Pt);const i=he(n.createBuffer());n.bindBuffer(n.ARRAY_BUFFER,i),n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW),void 0!==e&&(this.#Dt(e),this.#Ct=[...e],this.#At=this.computeAttributeStride(e)),this.#Ft(this.#Ct,this.#At)}useAttributesForInstancedDrawing(t,e){ct(this.#Lt),ct(t.length>0),this.#Dt(t);const n=this.computeAttributeStride(t);this.#Ft(t,n);for(const n of t){const t=this.#St.get(n);this.#Et.vertexAttribDivisor(t.location,e)}this.#Rt=!0}setBlendFunction(t,e){this.#Ut=[t,e]}setAttribute(t,e){const n=this.#St.get(t);if(void 0===n)throw new Error(`Attribute ${t} does not exist.`);const i=null===n.value!=(null===e);n.value=e,i&&(this.#At=this.computeAttributeStride(this.#Ct))}setUniform(t,e){ct(this.#Lt);const n=this.#xt.get(t);ct(void 0!==n,`Uniform ${t} does not exist.`),n.apply(e)}computeAttributeStride(t){return t.map((t=>this.#St.get(t))).filter((t=>null===t.value)).reduce(((t,e)=>t+e.byteSize),0)}#It(t){const e=this.#Et,n=e.getProgramParameter(this.#Tt,e.ACTIVE_ATTRIBUTES),i=[];for(let t=0;t<n;t++){const n=e.getActiveAttrib(this.#Tt,t),s=e.getAttribLocation(this.#Tt,n.name);this.#St.set(n.name,new Ue(n,s)),i.push(n.name)}void 0!==t?(this.#Dt(t),this.#Ct=[...t]):this.#Ct=i}#Dt(t){}#Mt(){const t=this.#Et,e=t.getProgramParameter(this.#Tt,t.ACTIVE_UNIFORMS);for(let n=0;n<e;n++){const e=t.getActiveUniform(this.#Tt,n),i=t.getUniformLocation(this.#Tt,e.name);this.#xt.set(e.name,new Ce(t,e,i))}}#Ft(t,e){const n=this.#Et;let i=0;for(const s of t){const t=this.#St.get(s);if(null===t.value)n.enableVertexAttribArray(t.location),t.type===n.INT?n.vertexAttribIPointer(t.location,t.components,n.INT,e,i):n.vertexAttribPointer(t.location,t.components,n.FLOAT,!1,e,i),i+=t.byteSize;else{if(t.type!==n.FLOAT)throw new Error("Constant values for attributes not yet implemented!");n.vertexAttrib1f(t.location,t.value)}}}}const Ie=new Map,Me=new ue;async function Fe(t){return await Me.wait(),Ie.has(t)?Ie.get(t):Promise.reject(new Error(`Shader ${t} not found.`))}async function De(t,e){const n=await Fe(t+".vert"),i=await Fe(t+".frag"),s=await _e();try{return new Re(s,n,i,e)}catch(e){return console.error(e),await ne({title:"Error",content:`Failed to compile shader "${t}".`}),Promise.reject(e)}}let Ne;(async()=>{const t=await Yt.loadJSON("shaders.json?h=12a573f662",(t=>{if("object"!=typeof t)return!1;for(const[e,n]of Object.entries(t))if("string"!=typeof e||"string"!=typeof n)return!1;return!0}));for(const[e,n]of Object.entries(t))Ie.set(e,n);Me.set()})();const Oe=2,Be=function(t){const e=new Float32Array(Oe*t.length*2);let n=0;for(const[i,s]of t)e[n++]=-i,e[n++]=s,e[n++]=i,e[n++]=s;return e}([[.5,-1],[1,0],[.4,2]]),Ve=-.5*Math.PI;let He,Xe;(async()=>{Ne=await De("head"),Ne.setFixedBuffer(Be)})(),new Float32Array(8),(async()=>{const t=await _e();He=await De("solidcolor"),Xe=he(t.createBuffer())})();const We=new WeakMap,Ye=new WeakMap;let Ge;function $e(){const t=me().createBuffer();if(null===t)throw new Error("Failed to create WebGL buffer.");return t}(async()=>{const t=WebGL2RenderingContext,[e,n]=await Promise.all([De("snake",["aPosition","aNormal","aNormalOffset","aRelativePathOffset"]),Yt.loadImage("assets/scales.svg",128)]);Ge=e,Te(1,{wrap:t.REPEAT,minFilter:t.LINEAR_MIPMAP_LINEAR,anisotropy:4},(t=>{t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n),t.generateMipmap(t.TEXTURE_2D)}))})();const je=new lt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),ze=new Float32Array([-1,1,1,1,-1,-1,-1,-1,1,1,1,-1]);let Ke;const qe=new WeakMap;function Je(t,e){let n=qe.get(e);void 0===n&&(n=he(t.createBuffer()),qe.set(e,n)),t.bindBuffer(t.ARRAY_BUFFER,n),e.moveVertexData((e=>t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW)))}(async()=>{const t=WebGL2RenderingContext;Ke=await De("food"),Ke.setFixedBuffer(ze,["aLocalPos"]),Ke.setBlendFunction(t.SRC_ALPHA,t.ONE)})();const Qe=document.createElement("canvas").getContext("2d"),Ze=12;function tn(t,e){return Qe.font=`sans-serif ${e}px`,Qe.measureText(t).width}const en=new ut(!0);let nn,sn,rn,an=0,on=!0,ln=null;const cn=128;function un(t){nn.use((e=>{!function(t){const{width:e,height:n}=t.canvas,i=2/e,s=2/n;en.setEntry(0,0,i*cn),en.setEntry(1,1,s*cn),en.setEntry(0,2,1-i*(cn+10)),en.setEntry(1,2,10*s-1)}(e);const n=t.camera.position;!function(t,e){const{columns:n,rows:i}=e.config.chunks;if(an=.8*an+.2*(on?0:1),ln===e.heatMap)return;on&&null!==ln?t.activeTexture(t.TEXTURE3):t.activeTexture(t.TEXTURE2),on?t.bindTexture(t.TEXTURE_2D,rn):t.bindTexture(t.TEXTURE_2D,sn);const s=t.LUMINANCE;t.texImage2D(t.TEXTURE_2D,0,s,n,i,0,s,t.UNSIGNED_BYTE,e.heatMap),null!==ln&&(on=!on,an=on?1:0),ln=e.heatMap}(e,t),nn.setUniform("uHeatMapTexture1",2),nn.setUniform("uHeatMapTexture2",3),nn.setUniform("uTextureMix",an),nn.setUniform("uCameraPosition",function(t,e){const n=t.config.chunks,i=n.columns*n.size,s=n.rows*n.size;return[(.5*i+e.x)/i,(.5*s+e.y)/s]}(t,n)),nn.setUniform("uTransform",en.data),nn.run(4,{mode:e.TRIANGLE_STRIP})}))}let hn;(async()=>{const t=await _e();nn=await De("heatmap"),nn.setFixedBuffer(new Float32Array([0,1,1,1,0,0,1,0]).buffer),sn=Te(2,{wrap:t.CLAMP_TO_EDGE,minFilter:t.LINEAR,magFilter:t.LINEAR}),rn=Te(3,{wrap:t.CLAMP_TO_EDGE,minFilter:t.LINEAR,magFilter:t.LINEAR})})();const dn=4,fn=new ut(!1);(async()=>{const t=WebGL2RenderingContext,[e,n]=await Promise.all([De("background"),Yt.loadImage("assets/background.svg",128)]);hn=e,hn.setFixedBuffer(new Float32Array([0,1,1,1,0,0,1,0]).buffer),Te(dn,{wrap:t.REPEAT,minFilter:t.LINEAR_MIPMAP_LINEAR,magFilter:t.LINEAR},(t=>{t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n),t.generateMipmap(t.TEXTURE_2D)}))})(),async function(){const t=await _e();Te(0,{wrap:t.CLAMP_TO_EDGE,minFilter:t.NEAREST,magFilter:t.NEAREST},(t=>{const e=t.RGBA;t.texImage2D(t.TEXTURE_2D,0,e,be().length,2,0,e,t.UNSIGNED_BYTE,xe)}))}();const pn=document.createElement("div"),mn=document.createElement("div"),_n=document.createElement("div");var gn;mn.append(_n),pn.append(mn),pn.id="input-container",mn.id="input-viz-ring",mn.classList.add("hide"),_n.id="input-viz-marker",Nt(((t,e)=>{_n.style.transform=`rotate(${-e}rad)`})),gn=t=>{"keyboard"===t?mn.classList.remove("hide"):mn.classList.add("hide")},Rt.add(gn),document.addEventListener("pointerlockchange",(()=>{null!==document.pointerLockElement?mn.classList.remove("hide"):mn.classList.add("hide")}));const vn=document.createElement("canvas");vn.id="mainCanvas",document.body.append(vn),function(t){const e=he(t.getContext("webgl2",de),"Failed to create WebGL context.");e.disable(e.DEPTH_TEST),e.enable(e.BLEND),e.pixelStorei(e.UNPACK_ALIGNMENT,1),t.addEventListener("webglcontextlost",(t=>{console.error("WebGL context lost.",t),ne({title:"Error",content:"The WebGL context has been lost. Reloading the page should fix the issue.",buttons:[{label:"Reload",action:()=>window.location.reload()}]})})),e.hint(e.GENERATE_MIPMAP_HINT,e.NICEST),pe=e,fe.set()}(vn);const wn=document.createElement("div");wn.id="textLayer",document.body.append(wn),function(t){ve=t}(wn),document.body.append(pn);const kn=document.createElement("div");async function yn(){const[t,e]=await se.joinAsPlayer(),n=new ue;return window.requestAnimationFrame((function n(i){gt(i),t.predict(),function(t){const e=me();!function(t){const e=t.canvas,n=e.clientWidth,i=e.clientHeight;e.width===n&&e.height===i||(e.width=n,e.height=i,t.viewport(0,0,n,i))}(e);const n=e.canvas;t.camera.setRatio(n.clientWidth,n.clientHeight),e.clearColor(.1,.1,.1,1),e.clear(e.COLOR_BUFFER_BIT);const i=t.camera.transformMatrix;!function(t){ut.inverse(t,fn),hn.use((t=>{hn.setUniform("uTexture",dn),hn.setUniform("uInvTransform",fn.data),hn.run(4,{mode:t.TRIANGLE_STRIP})}))}(i),function(t,e){const n=t.targetSnake,i=n?n.position:je;Ke.use((n=>{Ke.setUniform("uColorSampler",0),Ke.setUniform("uTransform",e.data),Ke.setUniform("uAttractorPosition",[i.x,i.y]);for(const e of t.foodChunks.values())e.isVisible(t.camera)&&(Ke.setUniform("uTime",e.age),Je(n,e),Ke.useAttributesForInstancedDrawing(["aPosition","aWiggleParams","aSize","aColorIndex"],1),Ke.run(ze.length/2,{instances:e.length}))}))}(t,i),function(t,e){const n=t.camera;Ge.use((i=>{Ge.setUniform("uTransform",e.data),Ge.setUniform("uColorSampler",0),Ge.setUniform("uScalesTexture",1);for(const e of t.snakes.values())if(e.hasChunks()){Se(Ge,"uSkin",e.skin),Ge.setUniform("uSnakeFast",e.smoothedFastValue),Ge.setUniform("uSnakeLength",e.length),Ge.setUniform("uSnakeMaxWidth",e.width),Ge.setUniform("uSnakeThinningStart",Math.min(.75,.025*e.length)*e.length);for(const t of e.getSnakeChunksIterator()){if(!t.couldBeVisible(n))continue;Ge.setUniform("uChunkPathOffset",t.offset);const e=t.gpuData;if(t.final)if(We.has(t))i.bindBuffer(i.ARRAY_BUFFER,We.get(t));else{const n=Ye.get(t)??$e();We.set(t,n),Ye.delete(t),i.bindBuffer(i.ARRAY_BUFFER,n),i.bufferData(i.ARRAY_BUFFER,e.buffer,i.STATIC_DRAW)}else{const n=Ye.get(t)??$e();Ye.set(t,n),i.bindBuffer(i.ARRAY_BUFFER,n),i.bufferData(i.ARRAY_BUFFER,e.buffer,i.STREAM_DRAW)}Ge.run(e.vertices,{mode:i.TRIANGLE_STRIP})}}}))}(t,i),function(t,e){Ne.use((n=>{Ne.setUniform("uTransform",e.data);for(const e of t.snakes.values()){if(!e.hasChunks()||!e.isHeadVisible(t.camera))continue;const{x:i,y:s}=e.position;Ne.setUniform("uSnakeWidth",1.25*e.width),Ne.setUniform("uHeadPosition",[i,s]),Ne.setUniform("uHeadRotation",e.direction+Ve),Ne.setUniform("uSnakeFast",e.smoothedFastValue),Se(Ne,"uSkin",e.skin),Ne.run(Be.length/Oe,{mode:n.TRIANGLE_STRIP})}}))}(t,i),function(t){const e=me().canvas,n=t.targetSnake;for(const r of t.snakes.values()){if(r===n||!r.hasChunks()||(i=t.camera,s=r.position,!i.viewBox.contains(s)))continue;const a=t.camera.computeScreenCoordinates(r.position,e),o=10+.5*r.width,l=r.name;l&&ke(l,`snake${r.id}`,{color:"white",x:a.x,y:a.y+o,size:Ze,minWidth:tn(l,Ze)})}var i,s}(t),function(){if(null===ve)throw new Error("Text renderer not initialized.");B(g(ge,{texts:we}),ve),we.length=0}(),un(t)}(t),e.alive&&It.forEach((t=>t.tick())),setTimeout((()=>t.update())),window.requestAnimationFrame(n)})),B(g(ce,{game:t}),kn),window.addEventListener("error",(e=>{t.quit(),console.error("Stopped due to unhandled error.",e)})),t.events.snakeDeath.addListener((async t=>{t.deadSnakeId===e.snakeId&&(document.exitPointerLock(),"try-again"===await ne({title:"Game over",content:t.killer?`You are dead because you crashed into ${t.killer.name}.`:"You are dead.",buttons:[{label:"Spectate",value:"spectate"},{label:"Try again",value:"try-again"}]})&&n.set())})),t.events.gameEnd.addListener((async t=>{"disconnect"===t.reason&&(await ne({title:"Disconnected",content:"You have been disconnected from the server.",buttons:[{label:"Try again",value:"try-again"}]}),n.set())})),n.wait()}kn.id="root",document.body.append(kn),B(g(class extends k{state={progress:this.props.stage.progress};render(){return Jt("div",{id:"loading-screen",children:Jt("div",{class:"progress-bar",style:"--progress:"+this.state.progress})})}componentWillMount(){this.props.stage.addChangeListener((()=>this.setState({progress:this.props.stage.progress})))}},{stage:Yt}),kn),function(t){It.length=0;const e=new Ct((()=>({wantsFast:Ft,direction:Dt})));e.setClickCatcher(t),Ot(e),Ot(new Ut((()=>({wantsFast:Ft,direction:Dt}))))}(kn),te.id="dialogLayer",document.body.append(te),(async()=>{for(await Yt.waitForCompletion(),console.log("Loading completed."),gt(performance.now());;)await yn()})()})();