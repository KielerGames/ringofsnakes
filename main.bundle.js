(()=>{"use strict";var t={145:(t,e,n)=>{n.d(e,{Z:()=>s});var i=n(645),r=n.n(i)()((function(t){return t[1]}));r.push([t.id,"html,\nbody {\n  margin: 0;\n  padding: 0;\n  font-family: sans-serif;\n  color: white;\n}\nbody {\n  background-color: #2a2a2a;\n}\n#root {\n  position: fixed;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n}\n#mainCanvas {\n  position: absolute;\n  display: block;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n}\n#textLayer {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n}\n#textLayer .text {\n  position: absolute;\n  user-select: none;\n  text-align: center;\n  animation: fade-in 0.5s ease-in;\n  text-shadow: 1px 1px black;\n  white-space: pre-line;\n}\n#textLayer .text.debug {\n  text-shadow: 1px 0px black;\n  font-size: 11px;\n  text-align: left;\n  color: #dddedf;\n  line-height: 11px;\n}\n@keyframes fade-in {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n#input-container {\n  position: fixed;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  --ring-radius: 200px;\n  --ring-width: 12px;\n}\n#input-viz-ring {\n  position: relative;\n  width: var(--ring-radius);\n  height: var(--ring-radius);\n  border-radius: 50%;\n  box-shadow: 0px 0px 0px var(--ring-width) rgba(128, 128, 128, 0.2);\n  transition: 0.33s;\n}\n#input-viz-ring.hide {\n  box-shadow: 0px 0px 0px 5px transparent;\n  transition: 0.64s;\n}\n#input-viz-marker {\n  position: absolute;\n  top: calc(0px - var(--ring-width));\n  left: calc(0px - var(--ring-width));\n  width: var(--ring-radius);\n  height: var(--ring-radius);\n  border-radius: 50%;\n  border: var(--ring-width) solid rgba(255, 255, 255, 0.85);\n  clip-path: polygon(50% 50%, 100% 40%, 100% 60%);\n  opacity: 1;\n  transition: opacity 0.5s;\n}\n#input-viz-ring.hide > #input-viz-marker {\n  opacity: 0;\n}\n#snake-info {\n  position: absolute;\n  left: 10px;\n  bottom: 10px;\n  padding: 5px;\n  min-width: 100px;\n  background-color: #404040;\n  color: white;\n  font-size: 12px;\n}\n#snake-info #snake-length .label {\n  margin-right: 6px;\n}\n#snake-info #snake-length .value {\n  font-weight: bold;\n  font-size: 14px;\n  font-family: monospace;\n}\n#fps-stats {\n  position: absolute;\n  top: 10px;\n  left: 10px;\n}\n#fps-stats #fps-text {\n  position: absolute;\n  bottom: 3px;\n  left: 2px;\n  color: #00c800;\n  font-family: monospace;\n  font-size: 14px;\n}\n#leaderboard {\n  position: absolute;\n  right: 10px;\n  top: 10px;\n  padding: 5px;\n  min-width: 100px;\n  background-color: #404040;\n  color: white;\n  font-size: 12px;\n}\n#leaderboard .entry {\n  display: flex;\n  flex-direction: row;\n  padding: 3px;\n  font-weight: bold;\n  font-size: 12px;\n  font-family: monospace;\n}\n",""]);const s=r},645:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n=t(e);return e[2]?"@media ".concat(e[2]," {").concat(n,"}"):n})).join("")},e.i=function(t,n,i){"string"==typeof t&&(t=[[null,t,""]]);var r={};if(i)for(var s=0;s<this.length;s++){var o=this[s][0];null!=o&&(r[o]=!0)}for(var a=0;a<t.length;a++){var l=[].concat(t[a]);i&&r[l[0]]||(n&&(l[2]?l[2]="".concat(n," and ").concat(l[2]):l[2]=n),e.push(l))}},e}},379:(t,e,n)=>{var i,r=function(){var t={};return function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}t[e]=n}return t[e]}}(),s=[];function o(t){for(var e=-1,n=0;n<s.length;n++)if(s[n].identifier===t){e=n;break}return e}function a(t,e){for(var n={},i=[],r=0;r<t.length;r++){var a=t[r],l=e.base?a[0]+e.base:a[0],c=n[l]||0,d="".concat(l," ").concat(c);n[l]=c+1;var h=o(d),u={css:a[1],media:a[2],sourceMap:a[3]};-1!==h?(s[h].references++,s[h].updater(u)):s.push({identifier:d,updater:m(u,e),references:1}),i.push(d)}return i}function l(t){var e=document.createElement("style"),i=t.attributes||{};if(void 0===i.nonce){var s=n.nc;s&&(i.nonce=s)}if(Object.keys(i).forEach((function(t){e.setAttribute(t,i[t])})),"function"==typeof t.insert)t.insert(e);else{var o=r(t.insert||"head");if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(e)}return e}var c,d=(c=[],function(t,e){return c[t]=e,c.filter(Boolean).join("\n")});function h(t,e,n,i){var r=n?"":i.media?"@media ".concat(i.media," {").concat(i.css,"}"):i.css;if(t.styleSheet)t.styleSheet.cssText=d(e,r);else{var s=document.createTextNode(r),o=t.childNodes;o[e]&&t.removeChild(o[e]),o.length?t.insertBefore(s,o[e]):t.appendChild(s)}}function u(t,e,n){var i=n.css,r=n.media,s=n.sourceMap;if(r?t.setAttribute("media",r):t.removeAttribute("media"),s&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}var f=null,p=0;function m(t,e){var n,i,r;if(e.singleton){var s=p++;n=f||(f=l(e)),i=h.bind(null,n,s,!1),r=h.bind(null,n,s,!0)}else n=l(e),i=u.bind(null,n,e),r=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(n)};return i(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;i(t=e)}else r()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=(void 0===i&&(i=Boolean(window&&document&&document.all&&!window.atob)),i));var n=a(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var i=0;i<n.length;i++){var r=o(n[i]);s[r].references--}for(var l=a(t,e),c=0;c<n.length;c++){var d=o(n[c]);0===s[d].references&&(s[d].updater(),s.splice(d,1))}n=l}}}}},e={};function n(i){var r=e[i];if(void 0!==r)return r.exports;var s=e[i]={id:i,exports:{}};return t[i](s,s.exports,n),s.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t,e,i,r,s,o,a={},l=[],c=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function d(t,e){for(var n in e)t[n]=e[n];return t}function h(t){var e=t.parentNode;e&&e.removeChild(t)}function u(e,n,i){var r,s,o,a={};for(o in n)"key"==o?r=n[o]:"ref"==o?s=n[o]:a[o]=n[o];if(arguments.length>2&&(a.children=arguments.length>3?t.call(arguments,2):i),"function"==typeof e&&null!=e.defaultProps)for(o in e.defaultProps)void 0===a[o]&&(a[o]=e.defaultProps[o]);return f(e,a,r,s,null)}function f(t,n,r,s,o){var a={type:t,props:n,key:r,ref:s,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:null==o?++i:o};return null==o&&null!=e.vnode&&e.vnode(a),a}function p(t){return t.children}function m(t,e){this.props=t,this.context=e}function _(t,e){if(null==e)return t.__?_(t.__,t.__.__k.indexOf(t)+1):null;for(var n;e<t.__k.length;e++)if(null!=(n=t.__k[e])&&null!=n.__e)return n.__e;return"function"==typeof t.type?_(t):null}function v(t){var e,n;if(null!=(t=t.__)&&null!=t.__c){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if(null!=(n=t.__k[e])&&null!=n.__e){t.__e=t.__c.base=n.__e;break}return v(t)}}function g(t){(!t.__d&&(t.__d=!0)&&r.push(t)&&!y.__r++||o!==e.debounceRendering)&&((o=e.debounceRendering)||s)(y)}function y(){for(var t;y.__r=r.length;)t=r.sort((function(t,e){return t.__v.__b-e.__v.__b})),r=[],t.some((function(t){var e,n,i,r,s,o;t.__d&&(s=(r=(e=t).__v).__e,(o=e.__P)&&(n=[],(i=d({},r)).__v=r.__v+1,C(o,r,i,e.__n,void 0!==o.ownerSVGElement,null!=r.__h?[s]:null,n,null==s?_(r):s,r.__h),P(n,r),r.__e!=s&&v(r)))}))}function k(t,e,n,i,r,s,o,c,d,h){var u,m,v,g,y,k,b,S=i&&i.__k||l,E=S.length;for(n.__k=[],u=0;u<e.length;u++)if(null!=(g=n.__k[u]=null==(g=e[u])||"boolean"==typeof g?null:"string"==typeof g||"number"==typeof g||"bigint"==typeof g?f(null,g,null,null,g):Array.isArray(g)?f(p,{children:g},null,null,null):g.__b>0?f(g.type,g.props,g.key,null,g.__v):g)){if(g.__=n,g.__b=n.__b+1,null===(v=S[u])||v&&g.key==v.key&&g.type===v.type)S[u]=void 0;else for(m=0;m<E;m++){if((v=S[m])&&g.key==v.key&&g.type===v.type){S[m]=void 0;break}v=null}C(t,g,v=v||a,r,s,o,c,d,h),y=g.__e,(m=g.ref)&&v.ref!=m&&(b||(b=[]),v.ref&&b.push(v.ref,null,g),b.push(m,g.__c||y,g)),null!=y?(null==k&&(k=y),"function"==typeof g.type&&g.__k===v.__k?g.__d=d=w(g,d,t):d=x(t,g,v,S,y,d),"function"==typeof n.type&&(n.__d=d)):d&&v.__e==d&&d.parentNode!=t&&(d=_(v))}for(n.__e=k,u=E;u--;)null!=S[u]&&("function"==typeof n.type&&null!=S[u].__e&&S[u].__e==n.__d&&(n.__d=_(i,u+1)),R(S[u],S[u]));if(b)for(u=0;u<b.length;u++)L(b[u],b[++u],b[++u])}function w(t,e,n){for(var i,r=t.__k,s=0;r&&s<r.length;s++)(i=r[s])&&(i.__=t,e="function"==typeof i.type?w(i,e,n):x(n,i,i,r,i.__e,e));return e}function x(t,e,n,i,r,s){var o,a,l;if(void 0!==e.__d)o=e.__d,e.__d=void 0;else if(null==n||r!=s||null==r.parentNode)t:if(null==s||s.parentNode!==t)t.appendChild(r),o=null;else{for(a=s,l=0;(a=a.nextSibling)&&l<i.length;l+=2)if(a==r)break t;t.insertBefore(r,s),o=s}return void 0!==o?o:r.nextSibling}function b(t,e,n){"-"===e[0]?t.setProperty(e,n):t[e]=null==n?"":"number"!=typeof n||c.test(e)?n:n+"px"}function S(t,e,n,i,r){var s;t:if("style"===e)if("string"==typeof n)t.style.cssText=n;else{if("string"==typeof i&&(t.style.cssText=i=""),i)for(e in i)n&&e in n||b(t.style,e,"");if(n)for(e in n)i&&n[e]===i[e]||b(t.style,e,n[e])}else if("o"===e[0]&&"n"===e[1])s=e!==(e=e.replace(/Capture$/,"")),e=e.toLowerCase()in t?e.toLowerCase().slice(2):e.slice(2),t.l||(t.l={}),t.l[e+s]=n,n?i||t.addEventListener(e,s?T:E,s):t.removeEventListener(e,s?T:E,s);else if("dangerouslySetInnerHTML"!==e){if(r)e=e.replace(/xlink[H:h]/,"h").replace(/sName$/,"s");else if("href"!==e&&"list"!==e&&"form"!==e&&"tabIndex"!==e&&"download"!==e&&e in t)try{t[e]=null==n?"":n;break t}catch(t){}"function"==typeof n||(null!=n&&(!1!==n||"a"===e[0]&&"r"===e[1])?t.setAttribute(e,n):t.removeAttribute(e))}}function E(t){this.l[t.type+!1](e.event?e.event(t):t)}function T(t){this.l[t.type+!0](e.event?e.event(t):t)}function C(t,n,i,r,s,o,a,l,c){var h,u,f,_,v,g,y,w,x,b,S,E=n.type;if(void 0!==n.constructor)return null;null!=i.__h&&(c=i.__h,l=n.__e=i.__e,n.__h=null,o=[l]),(h=e.__b)&&h(n);try{t:if("function"==typeof E){if(w=n.props,x=(h=E.contextType)&&r[h.__c],b=h?x?x.props.value:h.__:r,i.__c?y=(u=n.__c=i.__c).__=u.__E:("prototype"in E&&E.prototype.render?n.__c=u=new E(w,b):(n.__c=u=new m(w,b),u.constructor=E,u.render=O),x&&x.sub(u),u.props=w,u.state||(u.state={}),u.context=b,u.__n=r,f=u.__d=!0,u.__h=[]),null==u.__s&&(u.__s=u.state),null!=E.getDerivedStateFromProps&&(u.__s==u.state&&(u.__s=d({},u.__s)),d(u.__s,E.getDerivedStateFromProps(w,u.__s))),_=u.props,v=u.state,f)null==E.getDerivedStateFromProps&&null!=u.componentWillMount&&u.componentWillMount(),null!=u.componentDidMount&&u.__h.push(u.componentDidMount);else{if(null==E.getDerivedStateFromProps&&w!==_&&null!=u.componentWillReceiveProps&&u.componentWillReceiveProps(w,b),!u.__e&&null!=u.shouldComponentUpdate&&!1===u.shouldComponentUpdate(w,u.__s,b)||n.__v===i.__v){u.props=w,u.state=u.__s,n.__v!==i.__v&&(u.__d=!1),u.__v=n,n.__e=i.__e,n.__k=i.__k,n.__k.forEach((function(t){t&&(t.__=n)})),u.__h.length&&a.push(u);break t}null!=u.componentWillUpdate&&u.componentWillUpdate(w,u.__s,b),null!=u.componentDidUpdate&&u.__h.push((function(){u.componentDidUpdate(_,v,g)}))}u.context=b,u.props=w,u.state=u.__s,(h=e.__r)&&h(n),u.__d=!1,u.__v=n,u.__P=t,h=u.render(u.props,u.state,u.context),u.state=u.__s,null!=u.getChildContext&&(r=d(d({},r),u.getChildContext())),f||null==u.getSnapshotBeforeUpdate||(g=u.getSnapshotBeforeUpdate(_,v)),S=null!=h&&h.type===p&&null==h.key?h.props.children:h,k(t,Array.isArray(S)?S:[S],n,i,r,s,o,a,l,c),u.base=n.__e,n.__h=null,u.__h.length&&a.push(u),y&&(u.__E=u.__=null),u.__e=!1}else null==o&&n.__v===i.__v?(n.__k=i.__k,n.__e=i.__e):n.__e=A(i.__e,n,i,r,s,o,a,c);(h=e.diffed)&&h(n)}catch(t){n.__v=null,(c||null!=o)&&(n.__e=l,n.__h=!!c,o[o.indexOf(l)]=null),e.__e(t,n,i)}}function P(t,n){e.__c&&e.__c(n,t),t.some((function(n){try{t=n.__h,n.__h=[],t.some((function(t){t.call(n)}))}catch(t){e.__e(t,n.__v)}}))}function A(e,n,i,r,s,o,l,c){var d,u,f,p=i.props,m=n.props,v=n.type,g=0;if("svg"===v&&(s=!0),null!=o)for(;g<o.length;g++)if((d=o[g])&&"setAttribute"in d==!!v&&(v?d.localName===v:3===d.nodeType)){e=d,o[g]=null;break}if(null==e){if(null===v)return document.createTextNode(m);e=s?document.createElementNS("http://www.w3.org/2000/svg",v):document.createElement(v,m.is&&m),o=null,c=!1}if(null===v)p===m||c&&e.data===m||(e.data=m);else{if(o=o&&t.call(e.childNodes),u=(p=i.props||a).dangerouslySetInnerHTML,f=m.dangerouslySetInnerHTML,!c){if(null!=o)for(p={},g=0;g<e.attributes.length;g++)p[e.attributes[g].name]=e.attributes[g].value;(f||u)&&(f&&(u&&f.__html==u.__html||f.__html===e.innerHTML)||(e.innerHTML=f&&f.__html||""))}if(function(t,e,n,i,r){var s;for(s in n)"children"===s||"key"===s||s in e||S(t,s,null,n[s],i);for(s in e)r&&"function"!=typeof e[s]||"children"===s||"key"===s||"value"===s||"checked"===s||n[s]===e[s]||S(t,s,e[s],n[s],i)}(e,m,p,s,c),f)n.__k=[];else if(g=n.props.children,k(e,Array.isArray(g)?g:[g],n,i,r,s&&"foreignObject"!==v,o,l,o?o[0]:i.__k&&_(i,0),c),null!=o)for(g=o.length;g--;)null!=o[g]&&h(o[g]);c||("value"in m&&void 0!==(g=m.value)&&(g!==e.value||"progress"===v&&!g||"option"===v&&g!==p.value)&&S(e,"value",g,p.value,!1),"checked"in m&&void 0!==(g=m.checked)&&g!==e.checked&&S(e,"checked",g,p.checked,!1))}return e}function L(t,n,i){try{"function"==typeof t?t(n):t.current=n}catch(t){e.__e(t,i)}}function R(t,n,i){var r,s;if(e.unmount&&e.unmount(t),(r=t.ref)&&(r.current&&r.current!==t.__e||L(r,null,n)),null!=(r=t.__c)){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(t){e.__e(t,n)}r.base=r.__P=null}if(r=t.__k)for(s=0;s<r.length;s++)r[s]&&R(r[s],n,"function"!=typeof t.type);i||null==t.__e||h(t.__e),t.__e=t.__d=void 0}function O(t,e,n){return this.constructor(t,n)}function M(n,i,r){var s,o,l;e.__&&e.__(n,i),o=(s="function"==typeof r)?null:r&&r.__k||i.__k,l=[],C(i,n=(!s&&r||i).__k=u(p,null,[n]),o||a,a,void 0!==i.ownerSVGElement,!s&&r?[r]:o?null:i.firstChild?t.call(i.childNodes):null,l,!s&&r?r:o?o.__e:i.firstChild,s),P(l,n)}t=l.slice,e={__e:function(t,e){for(var n,i,r;e=e.__;)if((n=e.__c)&&!n.__)try{if((i=n.constructor)&&null!=i.getDerivedStateFromError&&(n.setState(i.getDerivedStateFromError(t)),r=n.__d),null!=n.componentDidCatch&&(n.componentDidCatch(t),r=n.__d),r)return n.__E=n}catch(e){t=e}throw t}},i=0,m.prototype.setState=function(t,e){var n;n=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=d({},this.state),"function"==typeof t&&(t=t(d({},n),this.props)),t&&d(n,t),null!=t&&this.__v&&(e&&this.__h.push(e),g(this))},m.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),g(this))},m.prototype.render=p,r=[],s="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,y.__r=0;const D=Symbol("Comlink.proxy"),I=Symbol("Comlink.endpoint"),U=Symbol("Comlink.releaseProxy"),F=Symbol("Comlink.thrown"),N=t=>"object"==typeof t&&null!==t||"function"==typeof t,H=new Map([["proxy",{canHandle:t=>N(t)&&t[D],serialize(t){const{port1:e,port2:n}=new MessageChannel;return B(t,e),[n,[n]]},deserialize:t=>(t.start(),z(t))}],["throw",{canHandle:t=>N(t)&&F in t,serialize({value:t}){let e;return e=t instanceof Error?{isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:{isError:!1,value:t},[e,[]]},deserialize(t){if(t.isError)throw Object.assign(new Error(t.value.message),t.value);throw t.value}}]]);function B(t,e=self){e.addEventListener("message",(function n(i){if(!i||!i.data)return;const{id:r,type:s,path:o}=Object.assign({path:[]},i.data),a=(i.data.argumentList||[]).map(K);let l;try{const e=o.slice(0,-1).reduce(((t,e)=>t[e]),t),n=o.reduce(((t,e)=>t[e]),t);switch(s){case"GET":l=n;break;case"SET":e[o.slice(-1)[0]]=K(i.data.value),l=!0;break;case"APPLY":l=n.apply(e,a);break;case"CONSTRUCT":l=G(new n(...a));break;case"ENDPOINT":{const{port1:e,port2:n}=new MessageChannel;B(t,n),l=function(t,e){return V.set(t,e),t}(e,[e])}break;case"RELEASE":l=void 0;break;default:return}}catch(t){l={value:t,[F]:0}}Promise.resolve(l).catch((t=>({value:t,[F]:0}))).then((t=>{const[i,o]=$(t);e.postMessage(Object.assign(Object.assign({},i),{id:r}),o),"RELEASE"===s&&(e.removeEventListener("message",n),W(e))}))})),e.start&&e.start()}function W(t){(function(t){return"MessagePort"===t.constructor.name})(t)&&t.close()}function z(t,e){return Y(t,[],e)}function X(t){if(t)throw new Error("Proxy has been released and is not useable")}function Y(t,e=[],n=function(){}){let i=!1;const r=new Proxy(n,{get(n,s){if(X(i),s===U)return()=>q(t,{type:"RELEASE",path:e.map((t=>t.toString()))}).then((()=>{W(t),i=!0}));if("then"===s){if(0===e.length)return{then:()=>r};const n=q(t,{type:"GET",path:e.map((t=>t.toString()))}).then(K);return n.then.bind(n)}return Y(t,[...e,s])},set(n,r,s){X(i);const[o,a]=$(s);return q(t,{type:"SET",path:[...e,r].map((t=>t.toString())),value:o},a).then(K)},apply(n,r,s){X(i);const o=e[e.length-1];if(o===I)return q(t,{type:"ENDPOINT"}).then(K);if("bind"===o)return Y(t,e.slice(0,-1));const[a,l]=j(s);return q(t,{type:"APPLY",path:e.map((t=>t.toString())),argumentList:a},l).then(K)},construct(n,r){X(i);const[s,o]=j(r);return q(t,{type:"CONSTRUCT",path:e.map((t=>t.toString())),argumentList:s},o).then(K)}});return r}function j(t){const e=t.map($);return[e.map((t=>t[0])),(n=e.map((t=>t[1])),Array.prototype.concat.apply([],n))];var n}const V=new WeakMap;function G(t){return Object.assign(t,{[D]:!0})}function $(t){for(const[e,n]of H)if(n.canHandle(t)){const[i,r]=n.serialize(t);return[{type:"HANDLER",name:e,value:i},r]}return[{type:"RAW",value:t},V.get(t)||[]]}function K(t){switch(t.type){case"HANDLER":return H.get(t.name).deserialize(t.value);case"RAW":return t.value}}function q(t,e,n){return new Promise((i=>{const r=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");t.addEventListener("message",(function e(n){n.data&&n.data.id&&n.data.id===r&&(t.removeEventListener("message",e),i(n.data))})),t.start&&t.start(),t.postMessage(Object.assign({id:r},e),n)}))}const Z=function(t){return!0},J={server:{wss:!1,host:"127.0.0.1",port:8080}},Q=async function(t,e={}){const n=e.allowCache??!1,i=e.guard??Z,r=await fetch(t,{method:"GET",cache:n?"default":"no-store"});if(!r.ok)return Promise.reject(`Request failed (${t})`);const s=await r.json();return i(s)?s:Promise.reject("Invalid data.")}("client-config.json",{guard:function(t){if(!t||!t.server)return!1;const e=t.server;return void 0!==e.wss&&e.host&&e.port}}).catch((t=>(console.warn("Loading client config failed: "+t),J))),tt=new Intl.NumberFormat("en-US",{maximumSignificantDigits:2});class et{constructor(t,e){this.x=t,this.y=e}static fromObject(t){return new et(t.x,t.y)}static distance(t,e){const n=t.x-e.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)}static lerp(t,e,n){const i=1-n;return new et(i*t.x+n*e.x,i*t.y+n*e.y)}static equals(t,e,n){const i=t.x-e.x,r=t.y-e.y;return i*i+r*r<n*n}addPolar(t,e){this.x+=e*Math.cos(t),this.y+=e*Math.sin(t)}createTransferable(){return this}set(t){this.x=t.x,this.y=t.y}clone(){return new et(this.x,this.y)}toString(){const t=tt.format;return`<${t(this.x)},${t(this.y)}>`}}class nt{constructor(t){if(this.data=new Float32Array(9),t)for(let t=0;t<3;t++)this.data[4*t]=1}setEntry(t,e,n){this.data[t+3*e]=n}getEntry(t,e){return this.data[t+3*e]}multiply(t,e=new et(0,0)){const n=this.data;return e.x=n[0]*t.x+n[3]*t.y+n[6],e.y=n[1]*t.x+n[4]*t.y+n[7],e}static compose(t,e,n){void 0===n&&(n=new nt(!1));for(let i=0;i<3;i++)for(let r=0;r<3;r++){let s=0;for(let n=0;n<3;n++)s+=t.data[i+3*n]*e.data[n+3*r];n.data[i+3*r]=s}return n}}class it{constructor(t,e,n,i){this.minX=t,this.maxX=e,this.minY=n,this.maxY=i}static fromTransferable(t){return new it(t.minX,t.maxX,t.minY,t.maxY)}static createAt(t,e,n){const i=.5*e,r=.5*n;return new it(t.x-i,t.x+i,t.y-r,t.y+r)}static distance2(t,e){let n=0,i=0;return t.maxX<e.minX?n=e.minX-t.maxX:e.maxX<t.minX&&(n=t.minX-e.maxX),t.maxY<e.minY?i=e.minY-t.maxY:e.maxY<t.minY&&(i=t.minY-e.maxY),n*n+i*i}get width(){return this.maxX-this.minX}get height(){return this.maxY-this.minY}createTransferable(t=0){return{minX:this.minX-t,maxX:this.maxX+t,minY:this.minY-t,maxY:this.maxY+t}}extendTo(t,e=Number.EPSILON){return new it(Math.min(this.minX,t.x-e),Math.max(this.maxX,t.x+e),Math.min(this.minY,t.y-e),Math.max(this.maxY,t.y+e))}contains(t){const e=this.minX<=t.x&&t.x<this.maxX,n=this.minY<=t.y&&t.y<this.maxY;return e&&n}}const rt=.042,st=new nt(!0);st.setEntry(0,0,rt),st.setEntry(1,1,rt);class ot{constructor(){this._position=new et(0,0),this._unstretch=new nt(!0),this._translation=new nt(!0),this._lastTransformMatrix=null}setRatio(t,e){this._unstretch.setEntry(0,0,e/t)}moveToSnake(t){this.moveTo(t.position)}moveTo(t){this._position.set(t),this._lastTransformMatrix=null}computeScreenCoordinates(t,e){const n=e.clientWidth,i=e.clientHeight,r=this.transformMatrix.multiply(t);return r.y*=-1,r.x+=1,r.x=.5*n*r.x,r.y+=1,r.y=.5*i*r.y,r}get position(){return this._position}get transformMatrix(){if(null===this._lastTransformMatrix){const t=this._position;this._translation.setEntry(0,2,-t.x),this._translation.setEntry(1,2,-t.y),this._lastTransformMatrix=nt.compose(nt.compose(this._unstretch,st),this._translation)}return this._lastTransformMatrix}get viewBox(){const t=this._position,e=2/(this._unstretch.getEntry(0,0)*rt),n=2/rt;return new it(t.x-.5*e,t.x+.5*e,t.y-.5*n,t.y+.5*n)}}let at=0;function lt(){return at}function ct(t=performance.now()){at=t}function dt(t){if(!Number.isFinite(t))return 0;for(;Math.abs(t)>Math.PI;)t-=2*Math.sign(t)*Math.PI;return t}const ht=2*Math.PI;function ut(t,e){const n=e-t,i=n-Math.sign(n)*ht;return Math.abs(i)<Math.abs(n)?i:n}function ft(t,e,n){return Math.max(t,Math.min(e,n))}class pt{constructor(t,e){this.target=!1,this.headChunk=null,this.chunks=new Map,this.id=t.id,this.skin=t.skin,this.gameConfig=e,this.lastPredictionTime=lt(),this.predictedHeadPosition=et.fromObject(t.headPosition),this.predictedDirection=t.headDirection[0],this.update(t,0)}update(t,e){this.lastUpdateTime=lt(),this._length=t.length,this.headChunkId=t.headChunkId,this.lastKnownHeadPosition=et.fromObject(t.headPosition),this.lastKnownDirection=t.headDirection[0],this.targetDirection=t.headDirection[1],this._fast=t.fast,this._width=t.width,this.updateChunkOffsets(e,t.fastHistory)}predict(){this.predictPosition(),this.predictDirection();for(const t of this.chunks.values())t.predict();const t=this.headChunk;t&&t.connectMeshToHead(),this.lastPredictionTime=lt()}registerSnakeChunk(t){this.chunks.set(t.id,t),t.id===this.headChunkId&&(null!==this.headChunk&&this.headChunk.resetMesh(),this.headChunk=t)}unregisterSnakeChunk(t){this.chunks.delete(t.id)}getSnakeChunksIterator(){return this.chunks.values()}hasChunks(){return this.chunks.size>0}toString(){return`Snake ${this.id} with ${this.chunks.size} chunks`}isVisible(t,e=0){for(const n of this.chunks.values())if(n.isVisible(t,e))return!0;return this.isHeadVisible(t,e)}isHeadVisible(t,e=0){const n=5*this._width,i=it.createAt(this.predictedHeadPosition,n,n);return it.distance2(i,t.viewBox)<=e*e}destroy(){}get name(){return"A Snake With No Name"}get fast(){return this._fast}get length(){return this._length}get speed(){const t=this.gameConfig;return(this._fast?t.snakes.fastSpeed:t.snakes.speed)/t.tickDuration}get position(){return this.predictedHeadPosition}get direction(){return this.predictedDirection}get width(){return this._width}predictPosition(){const t=this.speed,e=lt(),n=t*(e-this.lastPredictionTime)/1e3,i=t*(e-this.lastUpdateTime)/1e3;this.predictedHeadPosition.addPolar(this.predictedDirection,n);const r=this.lastKnownHeadPosition.clone();r.addPolar(this.predictedDirection,i),this.predictedHeadPosition=et.lerp(this.predictedHeadPosition,r,.15)}predictDirection(){const t=lt(),e=this.gameConfig.snakes.maxTurnDelta/this.gameConfig.tickDuration,n=ut(this.predictedDirection,this.targetDirection),i=ut(this.lastKnownDirection,this.targetDirection),r=e*(t-this.lastPredictionTime)/1e3,s=e*(t-this.lastUpdateTime)/1e3,o=dt(this.predictedDirection+ft(-r,n,r)),a=dt(this.lastKnownDirection+ft(-s,i,s));this.predictedDirection=dt(o+.15*ut(o,a))}updateChunkOffsets(t,e){if(0===t)return;const n=this.gameConfig.snakes.fastSpeed,i=this.gameConfig.snakes.speed;let r=0;for(let s=0;s<t;s++)r+=e[s]?n:i;for(const t of this.chunks.values())t.id!==this.headChunkId&&t.updateOffset(r)}}class mt{constructor(t,e){this._final=!1,this.creationTime=lt(),this.lastPredictionTime=lt(),this.snake=t,this.id=e.id,t.registerSnakeChunk(this),this.update(e),this.predictedOffset=e.offset}update(t){if(this._final=t.full,this.bounds=it.fromTransferable(t.boundingBox),this.gpuData={buffer:t.data,vertices:t.vertices},this.lastKnownOffset=t.offset,0===this.lastKnownOffset){const e=t.length-this.length;this.predictedOffset-=e}this.length=t.length,this.lastOffsetUpdateTime=lt(),this.lastUpdateTime=lt()}updateOffset(t){this.lastKnownOffset+=t,this.lastOffsetUpdateTime=lt()}predict(){const t=this.snake.speed,e=lt(),n=t*(e-this.lastPredictionTime)/1e3,i=t*(e-this.lastOffsetUpdateTime)/1e3,r=this.predictedOffset+n,s=this.lastKnownOffset+i;this.predictedOffset=.85*r+.15*s,this.lastPredictionTime=lt()}connectMeshToHead(){const t=this.snake.position,e=this.gpuData.buffer;let n=6*(this.gpuData.vertices-2);e[n+0]=t.x,e[n+1]=t.y,e[n+5]=-this.predictedOffset,n+=6,e[n+0]=t.x,e[n+1]=t.y,e[n+5]=-this.predictedOffset}resetMesh(){const t=this.gpuData.buffer;let e=6*(this.gpuData.vertices-2),n=e-12;t[e+0]=t[n+0],t[e+1]=t[n+1],t[e+5]=t[n+5],e+=6,n+=6,t[e+0]=t[n+0],t[e+1]=t[n+1],t[e+5]=t[n+5]}isVisible(t,e=0){const n=it.distance2(t.viewBox,this.bounds),i=.5*this.snake.width+e;return n<=i*i}destroy(){this.snake.unregisterSnakeChunk(this)}toString(){return`SnakeChunk ${this.id} of snake ${this.snake.id}`}get offset(){return this.predictedOffset}get boundingBox(){return this.bounds}get junk(){return this.lastKnownOffset>=this.snake.length}get final(){return this._final}get shortId(){return 65535&this.id}get clientAge(){return.001*(lt()-this.creationTime)}get debugInfo(){throw new Error}}class _t{constructor(t){this.listeners=new Set,this._deviceName=t}addListener(t){this.listeners.add(t)}set(t){this.notifyListeners(t)}notifyListeners(t){this.listeners.forEach((e=>e(t)))}getDeviceName(){return this._deviceName}}class vt extends _t{constructor(){super("pointer"),this.clickCatcher=null,this.pointerDownHandler=this.pointerDownHandler.bind(this),this.pointerUpHandler=this.pointerUpHandler.bind(this),window.addEventListener("pointermove",(t=>{const e=t.pageX-.5*window.innerWidth,n=.5*window.innerHeight-t.pageY;if(e*e+n*n>1){const t=Math.atan2(n,e);this.set({direction:t})}}))}pointerDownHandler(t){t.stopPropagation(),this.set({wantsFast:!0})}pointerUpHandler(t){t.stopPropagation(),this.set({wantsFast:!1})}setClickCatcher(t){null!==this.clickCatcher&&(this.clickCatcher.removeEventListener("pointerdown",this.pointerDownHandler),this.clickCatcher.removeEventListener("pointerup",this.pointerUpHandler),this.clickCatcher.removeEventListener("pointercancel",this.pointerUpHandler)),t.addEventListener("pointerdown",this.pointerDownHandler),t.addEventListener("pointerup",this.pointerUpHandler),t.addEventListener("pointercancel",this.pointerUpHandler),this.clickCatcher=t}}class gt extends _t{constructor(t){super("keyboard"),this.pressed=new Set,this.keyMappings=new Map,this.trackedKeys=new Set,this.previousTickAnyPressed=!1,this.lastTick=lt(),this.stateProvider=t,this.addMappings("left",["a","ArrowLeft"]),this.addMappings("right",["d","ArrowRight"]),this.addMappings("fast",["w","ArrowUp","Shift"," "]),window.addEventListener("keydown",(t=>{this.pressed.add(t.key.toLowerCase())})),window.addEventListener("keyup",(t=>{this.pressed.delete(t.key.toLowerCase())})),window.addEventListener("blur",(()=>{this.pressed.clear()}))}addMappings(t,e){const n=this.keyMappings.get(t)??new Set;e.forEach((t=>{const e=t.toLowerCase();n.add(e),this.trackedKeys.add(e)})),this.keyMappings.set(t,n)}tick(){const t=2.5*(lt()-this.lastTick)/1e3;this.lastTick=lt();const e=this.anyPressed();if(!e&&!this.previousTickAnyPressed)return;this.previousTickAnyPressed=e;const n=this.isPressed("fast"),i=this.stateProvider().direction;let r=0;this.isPressed("left")&&(r+=t),this.isPressed("right")&&(r-=t),this.set({wantsFast:n,direction:i+r})}isPressed(t){const e=this.keyMappings.get(t);if(void 0===e)return!1;for(const t of e)if(this.pressed.has(t.toLowerCase()))return!0;return!1}anyPressed(){for(const t of this.pressed)if(this.trackedKeys.has(t))return!0;return!1}}const yt=new Set,kt=new Set,wt=[];let xt,bt=!1,St=0;function Et(t){yt.add(t)}function Tt(t){var e;t instanceof gt&&wt.push(t),t.addListener((e=t,t=>{const n=void 0!==t.direction?dt(t.direction):St,i=t.wantsFast??bt;if(bt===i&&St===n)return;St=n,bt=i,yt.forEach((t=>t(i,n)));const r=e.getDeviceName();xt!==r&&(xt=r,kt.forEach((t=>t(r))))}))}class Ct{constructor(t,e,n){this._alive=!0,this.remote=t,this.snakeId=e,this.game=n,this.inputListener=(t,e)=>{this.alive&&this.remote.sendUserInput(e,t,this.game.camera.viewBox)},Et(this.inputListener),n.addEventListener("snakeDeath",(t=>{var e;t.id===this.snakeId&&(this._alive=!1,e=this.inputListener,yt.delete(e))}))}get alive(){return this._alive}}const Pt={alpha:!0,depth:!1,antialias:!0,preserveDrawingBuffer:!1,premultipliedAlpha:!1},At=new class{constructor(){this.flag=!1,this.promise=void 0,this.resolver=void 0}set(){if(this.flag=!0,this.resolver){const t=this.resolver;this.resolver=void 0,this.promise=void 0,t()}}clear(){this.flag=!1}isSet(){return this.flag}async wait(t=0){if(!this.flag)return void 0===this.promise&&(this.promise=new Promise((t=>this.resolver=t))),t>0?Promise.race([this.promise,new Promise(((e,n)=>{window.setTimeout(n,t)}))]):this.promise}};let Lt=null;function Rt(){if(!Lt)throw new Error("No WebGL context available");return Lt}async function Ot(){return At.isSet()||await At.wait(),Rt()}const Mt=[];function Dt(t){const e=t.createBuffer();if(null===e)throw new Error("Failed to create buffer.");return e}(async()=>{{const t=await Ot();for(let e=0;e<16;e++)Mt.push(Dt(t))}})();const It=[{snakeBody:[128,191,255],food:[0,128,255]},{snakeBody:[255,184,114],food:[255,134,14]},{snakeBody:[191,255,128],food:[25,255,42]},{snakeBody:[250,255,80],food:[255,255,22]},{snakeBody:[230,67,197],food:[255,0,255]},{snakeBody:[255,81,55],food:[255,25,12]},{snakeBody:[112,111,110],food:[128,182,222]}];function Ut(){return It}const Ft=(()=>{const t=Ut(),e=new Uint8Array(8*t.length);return t.forEach(((t,n)=>{const i=4*n,r=e.length/2+i;e[i]=t.snakeBody[0],e[i+1]=t.snakeBody[1],e[i+2]=t.snakeBody[2],e[i+3]=255,e[r]=t.food[0],e[r+1]=t.food[1],e[r+2]=t.food[2],e[r+3]=255})),e})();let Nt;function Ht(t,e,n){t.setUniform(e,Bt(n))}function Bt(t){const e=Ut();return(t%e.length+.5)/e.length}(async()=>{const t=await Ot();Nt=t.createTexture(),t.bindTexture(t.TEXTURE_2D,Nt),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST);const e=t.RGBA;t.texImage2D(t.TEXTURE_2D,0,e,Ut().length,2,0,e,t.UNSIGNED_BYTE,Ft)})();const Wt=[[-1,1],[1,1],[-1,-1],[-1,-1],[1,1],[1,-1]];class zt{constructor(t){this.gpuData=new Float32Array(32*Wt.length),this.id=t.id,this.box=it.fromTransferable(t.bounds),this.gpuBuffer=Mt.length>0?Mt.pop():Dt(Rt()),this.update(t)}update(t){this.numFoodItems=t.items.length,this.gpuData=function(t,e){const n=zt.FOOD_VERTEX_SIZE*Wt.length,i=t.length*n,r=zt.FOOD_VERTEX_SIZE;(void 0===e||e.length<i)&&(e=new Float32Array(i));for(let i=0;i<t.length;i++){const s=t[i],o=i*n,a=Bt(s.color);for(let t=0;t<Wt.length;t++){const[n,i]=Wt[t];e[o+r*t+0]=s.size*n+s.x,e[o+r*t+1]=s.size*i+s.y,e[o+r*t+2]=n,e[o+r*t+3]=i,e[o+r*t+4]=a}}return e}(t.items,this.gpuData),this.lastUpdateTime=lt()}destroy(){!function(t){Mt.length<128&&Mt.push(t)}(this.gpuBuffer)}useBuffer(t){t.bindBuffer(t.ARRAY_BUFFER,this.gpuBuffer),this.gpuData&&(t.bufferData(t.ARRAY_BUFFER,this.gpuData,t.STATIC_DRAW),this.gpuData=void 0)}isVisible(t,e=0){return it.distance2(this.box,t.viewBox)<=e*e}get numberOfVertices(){return this.numFoodItems*Wt.length}get age(){return.001*(lt()-this.lastUpdateTime)}}zt.FOOD_VERTEX_SIZE=5;class Xt{constructor(t){this.data=new Map,this.factory=t}add(t,e){const n=this.data.get(t.id);if(n)n.update(t,e);else{const e=this.factory(t);t.id,e.id,this.data.set(t.id,e)}}addMultiple(t,e){for(const n of t)this.add(n,e)}get(t){return this.data.get(t)}has(t){return this.data.has(t)}runIfPresent(t,e){const n=this.data.get(t);return n&&e(n),void 0!==n}remove(t){const e=this.data.get(t);return e&&(this.data.delete(t),e.destroy&&e.destroy()),e}removeIf(t){const e=[];for(const n of this.data.values())t(n)&&e.push(n);for(const t of e)t.destroy&&t.destroy(),this.data.delete(t.id);return e}values(){return this.data.values()}entries(){return this.data.entries()}clear(){this.data.clear()}get size(){return this.data.size}}class Yt{constructor(){this.listeners=new Set}addListener(t){this.listeners.add(t)}trigger(t){this.listeners.forEach((e=>e(t)))}}class jt{constructor(){this.camera=new ot,this.leaderboard={list:[]},this.updateAvailable=!1,this.stopped=!1,this.events={snakeDeath:new Yt},this.remote=z(new Worker("worker.bundle.js",{name:"SnakeWorker"})),this.snakes=new Xt((t=>new pt(t,this.config))),this.snakeChunks=new Xt((t=>{const e=this.snakes.get(t.snakeId);if(void 0===e)throw new Error(`SnakeChunk for unknown snake ${t.snakeId}.`);return new mt(e,t)})),this.foodChunks=new Xt((t=>new zt(t)))}static async joinAsPlayer(t){const e=await Q,n=new jt,i=n.remote,r=await i.init(t,e);n.config=r.config,n.camera.moveTo(et.fromObject(r.startPosition)),n.targetSnakeId=r.targetSnakeId,i.addEventListener("server-update",G((()=>{n.updateAvailable=!0}))),i.addEventListener("disconnect",G((()=>{n.stopped=!0})));const s=new Ct(i,r.targetSnakeId,n);return[n,s]}static async joinAsSpectator(){throw new Error("not implemented")}async update(){if(!this.updateAvailable)return;const t=await this.remote.getDataChanges();this.updateAvailable=t.moreUpdates;const e=t.ticksSinceLastUpdate;t.leaderboard&&(this.leaderboard=t.leaderboard),this.foodChunks.addMultiple(t.foodChunks),this.snakes.addMultiple(t.snakes,e),void 0!==this.targetSnakeId&&this.snakes.runIfPresent(this.targetSnakeId,(t=>t.target=!0)),this.snakeChunks.addMultiple(t.snakeChunks);for(const e of t.snakeDeaths){const t=this.snakes.get(e);if(t){this.events.snakeDeath.trigger(t);for(const e of t.getSnakeChunksIterator())this.snakeChunks.remove(e.id);this.snakes.remove(e),e===this.targetSnakeId&&(this.targetSnakeId=void 0)}}this.removeJunk()}predict(){if(!this.stopped){for(const t of this.snakes.values())t.predict();this.targetSnake&&this.camera.moveToSnake(this.targetSnake)}}quit(){this.remote.quit(),this.stopped=!0}addEventListener(t,e){this.events[t].addListener(e)}get targetSnake(){if(void 0!==this.targetSnakeId)return this.snakes.get(this.targetSnakeId)}removeJunk(){const t=this.camera,e=2*this.config.snakes.fastSpeed;this.snakeChunks.removeIf((n=>n.junk||!n.isVisible(t,e)&&n.clientAge>1)),this.foodChunks.removeIf((n=>!n.isVisible(t,e)&&n.age>1)),this.snakes.removeIf((n=>n.id!==this.targetSnakeId&&!n.hasChunks()&&!n.isVisible(t,e)))}}var Vt=0;function Gt(t,n,i,r,s){var o,a,l={};for(a in n)"ref"==a?o=n[a]:l[a]=n[a];var c={type:t,props:l,key:i,ref:o,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:--Vt,__source:r,__self:s};if("function"==typeof t&&(o=t.defaultProps))for(a in o)void 0===l[a]&&(l[a]=o[a]);return e.vnode&&e.vnode(c),c}class $t extends m{constructor(t){super(t),this.canvasRef={current:null},this.frameCountCanvas=0,this.frameCountText=0,this.maxFPS=t.maxFPS??60}componentDidMount(){const t=this.canvasRef.current.getContext("2d",{alpha:!1});this.ctx=t,this.lastCanvasUpdate=performance.now(),this.lastTextUpdate=this.lastCanvasUpdate,t.fillStyle="black",t.fillRect(0,0,t.canvas.width,t.canvas.height),this.rafHandle=window.requestAnimationFrame(this.beforeFrame.bind(this))}beforeFrame(){const t=performance.now(),e=t-this.lastCanvasUpdate,n=t-this.lastTextUpdate,i=1e3/3;if(e>=i&&(this.updateCanvas(),this.lastCanvasUpdate=t-(e-i),this.frameCountCanvas=0),n>=1e3){const e=this.frameCountText;this.frameCountText=0,this.lastTextUpdate=t-(n-1e3),this.setState({fps:e})}this.frameCountCanvas++,this.frameCountText++,this.rafHandle=window.requestAnimationFrame(this.beforeFrame.bind(this))}updateCanvas(){const t=this.ctx,e=t.canvas,n=3*this.frameCountCanvas;if(n>this.maxFPS){const i=Math.round(e.height*this.maxFPS/n);t.drawImage(e,0,e.height-i,e.width,i),t.fillStyle="black",t.fillRect(0,0,e.width,e.height-i),this.maxFPS=n}const i=e.width-2;t.drawImage(e,2,0,i,e.height,0,0,i,e.height),t.fillStyle="black",t.fillRect(e.width-2,e.height,2,e.height);const r=Math.floor(e.height*n/this.maxFPS);t.fillStyle="white",t.fillRect(e.width-2,e.height-r,2,r)}componentWillUnmount(){window.cancelAnimationFrame(this.rafHandle)}render(){return Gt("div",{id:"fps-stats",children:[Gt("canvas",{ref:this.canvasRef,width:100,height:42},void 0),Gt("div",{id:"fps-text",children:`FPS: ${this.state.fps??"-"}`},void 0)]},void 0)}}class Kt extends m{render(){const t=this.props.data;return t?Gt("div",{id:"leaderboard",children:t.list.map(((t,e)=>Gt(qt,{data:t,index:e},t.name)))},void 0):null}}function qt(t){const e=t.data;return Gt("div",{class:"entry",children:[t.index+1,". ",e.name,": ",e.score]},void 0)}class Zt extends m{render(){const t=this.props.snake;return t?Gt("div",{id:"snake-info",children:[Gt("div",{id:"snake-name",children:t.name},void 0),Gt("div",{id:"snake-length",children:[Gt("span",{class:"label",children:"Length:"},void 0),Gt("span",{class:"value",children:Math.round(t.length)},void 0)]},void 0)]},void 0):null}}class Jt extends m{componentDidMount(){this.timer=window.setInterval((()=>{this.forceUpdate()}),500)}componentWillUnmount(){window.clearInterval(this.timer)}render(){const t=this.props.game;return Gt(p,{children:[Gt(Kt,{data:t.leaderboard},void 0),Gt($t,{},void 0),Gt(Zt,{snake:t.targetSnake},void 0)]},void 0)}}function Qt(t){return Gt(p,{children:t.texts.map((t=>{let e=`top:${t.y}px;left:${t.x}px;color:${t.color};`;return t.minWidth&&(e+=`min-width:${t.minWidth};`),t.color&&(e+=`color:${t.color};`),Gt("div",{class:t.debug?"text debug":"text",style:e,children:t.text},t.key)}))},void 0)}let te=null;const ee=[];function ne(t,e,n){ee.push({text:t,key:e,size:12,...n})}class ie{constructor(t,e,n,i){this.uniforms=new Map,this.attribs=new Map,this.autoStride=0,this.gl=t;const r=se(t,t.VERTEX_SHADER,e),s=se(t,t.FRAGMENT_SHADER,n),o=t.createProgram();if(t.attachShader(o,r),t.attachShader(o,s),t.linkProgram(o),!t.getProgramParameter(o,t.LINK_STATUS))throw new Error("Shader linking failed: "+t.getProgramInfoLog(o));this.program=o;const a=t.getProgramParameter(o,t.ACTIVE_ATTRIBUTES),l=[];for(let e=0;e<a;e++){const n=t.getActiveAttrib(o,e),i=t.getAttribLocation(o,n.name);this.attribs.set(n.name,new re(n,i)),l.push(n.name)}this.attribOrder=void 0!==i?[...i]:l,this.computeStride();const c=t.getProgramParameter(o,t.ACTIVE_UNIFORMS);for(let e=0;e<c;e++){const n=t.getActiveUniform(o,e),i=t.getUniformLocation(o,n.name);this.uniforms.set(n.name,new re(n,i))}}computeStride(){const t=Array.from(this.attribs.values()).filter((t=>null===t.value)).reduce(((t,e)=>t+e.size),0);this.autoStride=t*Float32Array.BYTES_PER_ELEMENT}use(){this.gl.useProgram(this.program)}run(t,e){const n=this.gl,{mode:i,start:r,stride:s}=Object.assign({mode:this.gl.TRIANGLES,start:0,stride:this.autoStride},e);let o=0;for(const t of this.attribOrder){const e=this.attribs.get(t);if(null===e.value)n.enableVertexAttribArray(e.location),n.vertexAttribPointer(e.location,e.size,n.FLOAT,!1,s,o*Float32Array.BYTES_PER_ELEMENT),o+=e.size;else{if(e.type!==n.FLOAT)throw new Error("Constant values for attributes not yet implemented!");n.vertexAttrib1f(e.location,e.value)}}this.uniforms.forEach((t=>{if(null!==t.value)if(t.type===n.FLOAT)n.uniform1f(t.location,t.value);else if(t.type===n.SAMPLER_2D)n.uniform1i(t.location,t.value);else if(t.type===n.FLOAT_VEC2)n.uniform2fv(t.location,t.value);else if(t.type===n.FLOAT_VEC3)n.uniform3fv(t.location,t.value);else if(t.type===n.FLOAT_VEC4)n.uniform4fv(t.location,t.value);else if(t.type===n.FLOAT_MAT3)n.uniformMatrix3fv(t.location,!1,t.value);else{if(t.type!==n.FLOAT_MAT4)throw new Error(`Uniform type ${t.type} not implemented.`);n.uniformMatrix4fv(t.location,!1,t.value)}})),n.drawArrays(i,r,t)}get context(){return this.gl}setAttribute(t,e){const n=this.attribs.get(t);if(void 0===n)throw new Error(`Attribute ${t} does not exist.`);const i=null===n.value!=(null===e);n.value=e,i&&this.computeStride()}setUniform(t,e){const n=this.uniforms.get(t);if(void 0===n)throw new Error(`Uniform ${t} does not exist.`);n.value=e}}class re{constructor(t,e){this.value=null,this.name=t.name,this.type=t.type,this.size=oe.get(t.type)*t.size,this.location=e}}function se(t,e,n){const i=t.createShader(e);if(t.shaderSource(i,n),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS))throw new Error("Shader compile error "+t.getShaderInfoLog(i));return i}const oe=new Map([[WebGLRenderingContext.FLOAT,1],[WebGLRenderingContext.FLOAT_VEC2,2],[WebGLRenderingContext.FLOAT_VEC3,3],[WebGLRenderingContext.FLOAT_VEC4,4],[WebGLRenderingContext.FLOAT_MAT3,9],[WebGLRenderingContext.FLOAT_MAT4,16]]);let ae,le;const ce=function(t){const e=new Float32Array(2*t.length*2);let n=0;for(const[i,r]of t)e[n++]=-i,e[n++]=r,e[n++]=i,e[n++]=r;return e}([[.5,-1],[1,0],[.4,2]]),de=-.5*Math.PI;let he,ue,fe,pe,me;(async()=>{const t=await Ot();ae=t.createBuffer(),le=new ie(t,"precision mediump float;\n\nattribute vec2 vRelPosition;\n\nuniform mat3 uTransform;\nuniform float uSnakeWidth;\nuniform vec2 uHeadPosition;\nuniform float uHeadRotation;\n\nvoid main(void) {\n    float c = cos(uHeadRotation);\n    float s = sin(uHeadRotation);\n    mat2 rotate = mat2(c,s,-s,c);\n    float size = 0.5 * uSnakeWidth;\n    vec2 position = uHeadPosition + size * rotate * vRelPosition;\n    gl_Position = vec4(uTransform * vec3(position, 1.0), 1.0);\n}","precision mediump float;\n\nuniform sampler2D uColorSampler;\nuniform lowp float uSkin;\n\nvoid main(void) {\n\tgl_FragColor = texture2D(uColorSampler, vec2(uSkin, 0.25));\n}"),le.use(),t.bindBuffer(t.ARRAY_BUFFER,ae),t.bufferData(t.ARRAY_BUFFER,ce,t.STATIC_DRAW)})(),new Float32Array(8),(async()=>{const t=await Ot();he=new ie(t,"precision mediump float;\n\nattribute vec2 vPosition;\n\nuniform mediump mat3 uTransform;\n\nvoid main(void) {\n    gl_Position = vec4(uTransform * vec3(vPosition, 1.0), 1.0);\n}","uniform lowp vec4 uColor;\n\nvoid main(void) {\n\tgl_FragColor = uColor;\n}"),ue=t.createBuffer()})(),(async()=>{const t=await Ot();fe=new ie(t,"precision mediump float;\n\nattribute vec2 aPosition;\nattribute vec2 aNormal;\nattribute float aNormalOffset;\nattribute float aRelativePathOffset;\n\nuniform mat3 uTransform;\nuniform highp float uSnakeMaxWidth;\nuniform highp float uChunkPathOffset;\nuniform highp float uSnakeLength;\nuniform highp float uSnakeThinningStart;\n\nvarying highp float vPathOffset;\nvarying float vNormalOffset;\n\nvoid main(void) {\n    vNormalOffset = aNormalOffset;\n\n    // distance from the snake head (along the snake path)\n    vPathOffset = uChunkPathOffset + aRelativePathOffset;\n\n    // thinning parameter t: 0 -> full width, 1 -> zero width\n    float t = min(1.0, max(0.0, vPathOffset - uSnakeThinningStart) / (uSnakeLength - uSnakeThinningStart));\n    float u = (aRelativePathOffset < 0.0) ? 0.9 : 1.0 - (t * t * t);\n\n    float size = 0.5 * u * uSnakeMaxWidth;\n    vec2 position = aPosition + (aNormalOffset * size) * aNormal;\n    gl_Position = vec4(uTransform * vec3(position, 1.0), 1.0);\n}","precision mediump float;\n\nuniform sampler2D uColorSampler;\nuniform lowp float uSkin;\nuniform highp float uSnakeLength;\n\nvarying float vPathOffset;\nvarying float vNormalOffset;\n\nconst vec3 darkGrey = vec3(0.1, 0.1, 0.1);\n\nvoid main(void) {\n\tvec3 skinColor = texture2D(uColorSampler, vec2(uSkin, 0.25)).rgb;\n\tvec3 darkColor = mix(skinColor, darkGrey, 0.5);\n\n\tfloat co = abs(vNormalOffset);\n\tco = co * co;\n\tco = co * (1.0 + 0.25*sin(2.0*vPathOffset));\n\n\tvec3 color = mix(skinColor, darkColor, co);\n\n\tgl_FragColor = vec4(color, vPathOffset < uSnakeLength ? 1.0 : 0.0);\n}",["aPosition","aNormal","aNormalOffset","aRelativePathOffset"]),pe=t.createBuffer()})();const _e=zt.FOOD_VERTEX_SIZE,ve=new et(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);(async()=>{const t=await Ot();me=new ie(t,"precision mediump float;\n\nattribute vec2 aPosition;\nattribute vec2 aLocalPos;\nattribute float aColorIndex;\n\nuniform mat3 uTransform;\nuniform sampler2D uColorSampler;\nuniform vec2 uAttractorPosition;\n\nvarying vec2 varPos;\nvarying lowp vec3 vColor;\nvarying lowp float vOpacity;\n\nconst float cMoveDist = 7.5;\n\nvoid main(void) {\n    varPos = aLocalPos;\n    vColor = texture2D(uColorSampler, vec2(aColorIndex, 0.75)).rgb;\n\n    float d = distance(aPosition, uAttractorPosition);\n    float s = min(1.0, d * 0.25);\n    vOpacity = min(1.0, d * 0.375);\n\n    vec2 pos = (d < cMoveDist) ? mix(aPosition, uAttractorPosition, 1.0 - s) : aPosition;\n\n    gl_Position = vec4(uTransform * vec3(pos, 1.0), 1.0);\n}","precision mediump float;\n\nvarying vec2 varPos;\nvarying lowp vec3 vColor;\nvarying lowp float vOpacity;\n\nconst vec3 centerColor = vec3(1.0, 1.0, 1.0);\n\nfloat norm_clamp(float x) {\n\treturn min(1.0, max(0.0, x));\n}\n\nvoid main(void) {\n\tfloat d2 = dot(varPos, varPos);\n\tfloat alpha = norm_clamp(1.0 - 1.5*(d2 - 0.333));\n\talpha = alpha * alpha * vOpacity * vOpacity;\n\tvec3 color = mix(centerColor, vColor, 0.5 + 0.666 * d2);\n\tgl_FragColor = vec4(color, alpha);\n}",["aPosition","aLocalPos","aColorIndex"])})();const ge=document.createElement("canvas").getContext("2d");function ye(t,e){return ge.font=`sans-serif ${e}px`,ge.measureText(t).width}const ke=document.createElement("div"),we=document.createElement("div"),xe=document.createElement("div");var be;we.appendChild(xe),ke.appendChild(we),ke.id="input-container",we.id="input-viz-ring",we.classList.add("hide"),xe.id="input-viz-marker",Et(((t,e)=>{xe.style.transform=`rotate(${-e}rad)`})),be=t=>{"keyboard"===t?we.classList.remove("hide"):we.classList.add("hide")},kt.add(be);var Se=n(379),Ee=n.n(Se),Te=n(145);Ee()(Te.Z,{insert:"head",singleton:!1}),Te.Z.locals;const Ce=document.createElement("canvas");Ce.id="mainCanvas",document.body.appendChild(Ce),function(t){const e=t.getContext("webgl",Pt);if(null===e)throw new Error("Failed to create WebGL context.");e.disable(WebGLRenderingContext.DEPTH_TEST),e.enable(WebGLRenderingContext.BLEND),Lt=e,At.set()}(Ce);const Pe=document.createElement("div");Pe.id="textLayer",document.body.appendChild(Pe),function(t){te=t}(Pe),document.body.appendChild(ke);const Ae=document.createElement("div");Ae.id="root",document.body.appendChild(Ae),function(t){wt.length=0;const e=new vt;e.setClickCatcher(t),Tt(e),Tt(new gt((()=>({wantsFast:bt,direction:St}))))}(Ae),document.title="Ring of Snakes 0.2.2",(async()=>{ct(performance.now());const[t,e]=await jt.joinAsPlayer("SnakeForceOne");window.requestAnimationFrame((function n(i){ct(i),t.predict(),function(t){const e=Rt();!function(t){const e=t.canvas,n=e.clientWidth,i=e.clientHeight;e.width===n&&e.height===i||(e.width=n,e.height=i,t.viewport(0,0,n,i))}(e);const n=e.canvas;t.camera.setRatio(n.clientWidth,n.clientHeight),e.clearColor(.1,.1,.1,1),e.clear(e.COLOR_BUFFER_BIT);const i=t.camera.transformMatrix;!function(){const t=Rt(),e=WebGLRenderingContext.TEXTURE0;t.activeTexture(e),t.bindTexture(t.TEXTURE_2D,Nt)}(),function(t,e){const n=Rt(),i=t.targetSnake;me.use(),n.blendFunc(n.SRC_ALPHA,n.ONE),me.setUniform("uColorSampler",0),me.setUniform("uTransform",e.data);const r=i?i.position:ve;me.setUniform("uAttractorPosition",[r.x,r.y]);for(const e of t.foodChunks.values())e.isVisible(t.camera)&&(e.useBuffer(n),me.run(e.numberOfVertices,{stride:_e*Float32Array.BYTES_PER_ELEMENT}))}(t,i),function(t,e){const n=Rt(),i=t.camera,r=fe;r.use(),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),n.bindBuffer(n.ARRAY_BUFFER,pe),r.setUniform("uTransform",e.data),r.setUniform("uColorSampler",0);for(const e of t.snakeChunks.values()){if(!e.isVisible(i))continue;const t=e.snake,s=e.gpuData;Ht(r,"uSkin",t.skin),r.setUniform("uChunkPathOffset",e.offset),r.setUniform("uSnakeLength",t.length),r.setUniform("uSnakeMaxWidth",t.width),r.setUniform("uSnakeThinningStart",Math.min(.75,.025*t.length)*t.length),n.bufferData(n.ARRAY_BUFFER,s.buffer,n.STREAM_DRAW),r.run(s.vertices,{mode:n.TRIANGLE_STRIP})}}(t,i),function(t,e){const n=Rt();le.use(),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),n.bindBuffer(n.ARRAY_BUFFER,ae),le.setUniform("uTransform",e.data);for(const e of t.snakes.values()){if(!e.hasChunks()||!e.isHeadVisible(t.camera))continue;const{x:i,y:r}=e.position;le.setUniform("uSnakeWidth",1.25*e.width),le.setUniform("uHeadPosition",[i,r]),le.setUniform("uHeadRotation",e.direction+de),Ht(le,"uSkin",e.skin),le.run(ce.length/2,{mode:n.TRIANGLE_STRIP})}}(t,i),function(t){const e=Rt().canvas;for(const r of t.snakes.values()){if(r.target||!r.hasChunks()||(n=t.camera,i=r.position,!n.viewBox.contains(i)))continue;const s=t.camera.computeScreenCoordinates(r.position,e),o=10+.5*r.width,a=`Snake ${r.id}`;ne(a,`snake${r.id}`,{color:"white",x:s.x,y:s.y+o,size:12,minWidth:ye(a,12)})}var n,i}(t),function(){if(null===te)throw new Error("Text renderer not initialized.");M(u(Qt,{texts:ee}),te),ee.length=0}()}(t),wt.forEach((t=>t.tick())),e.alive?(setTimeout((()=>t.update())),window.requestAnimationFrame(n)):(t.quit(),console.log("Game stopped."))})),M(u(Jt,{game:t}),Ae),window.addEventListener("error",(e=>{t.quit(),console.error("Stopped due to unhandled error.",e)}))})(),"https:"===window.location.protocol&&(document.body.innerHTML="<b>HTTPS</b> is not yet supported.")})()})();